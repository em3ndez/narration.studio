var app=function(){"use strict";function g(){}const I=g=>g;function t(g,I){for(const t in I)g[t]=I[t];return g}function e(g){return g()}function n(){return Object.create(null)}function C(g){g.forEach(e)}function c(g){return"function"==typeof g}function i(g,I){return g!=g?I==I:g!==I||g&&"object"==typeof g||"function"==typeof g}function l(I,t,e){I.$$.on_destroy.push(function(I,...t){if(null==I)return g;const e=I.subscribe(...t);return e.unsubscribe?()=>e.unsubscribe():e}(t,e))}const A="undefined"!=typeof window;let b=A?()=>window.performance.now():()=>Date.now(),s=A?g=>requestAnimationFrame(g):g;const d=new Set;function u(g){d.forEach(I=>{I.c(g)||(d.delete(I),I.f())}),0!==d.size&&s(u)}function r(g){let I;return 0===d.size&&s(u),{promise:new Promise(t=>{d.add(I={c:g,f:t})}),abort(){d.delete(I)}}}function a(g,I){g.appendChild(I)}function o(g,I,t){g.insertBefore(I,t||null)}function G(g){g.parentNode.removeChild(g)}function Z(g){return document.createElement(g)}function m(g){return document.createTextNode(g)}function X(){return m(" ")}function B(){return m("")}function h(g,I,t,e){return g.addEventListener(I,t,e),()=>g.removeEventListener(I,t,e)}function V(g){return function(I){return I.preventDefault(),g.call(this,I)}}function p(g){return function(I){I.target===this&&g.call(this,I)}}function W(g,I,t){null==t?g.removeAttribute(I):g.getAttribute(I)!==t&&g.setAttribute(I,t)}function x(g,I){I=""+I,g.wholeText!==I&&(g.data=I)}function F(g,I){g.value=null==I?"":I}let R;function y(){if(void 0===R){R=!1;try{"undefined"!=typeof window&&window.parent&&window.parent.document}catch(g){R=!0}}return R}function f(g,I){const t=getComputedStyle(g),e=(parseInt(t.zIndex)||0)-1;"static"===t.position&&(g.style.position="relative");const n=Z("iframe");n.setAttribute("style",`display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow: hidden; border: 0; opacity: 0; pointer-events: none; z-index: ${e};`),n.setAttribute("aria-hidden","true"),n.tabIndex=-1;const C=y();let c;return C?(n.src="data:text/html,<script>onresize=function(){parent.postMessage(0,'*')}<\/script>",c=h(window,"message",g=>{g.source===n.contentWindow&&I()})):(n.src="about:blank",n.onload=()=>{c=h(n.contentWindow,"resize",I)}),a(g,n),()=>{(C||c&&n.contentWindow)&&c(),G(n)}}function Y(g,I,t){g.classList[t?"add":"remove"](I)}function k(g,I){const t=document.createEvent("CustomEvent");return t.initCustomEvent(g,!1,!1,I),t}const v=new Set;let H,N=0;function S(g,I,t,e,n,C,c,i=0){const l=16.666/e;let A="{\n";for(let g=0;g<=1;g+=l){const e=I+(t-I)*C(g);A+=100*g+`%{${c(e,1-e)}}\n`}const b=A+`100% {${c(t,1-t)}}\n}`,s=`__svelte_${function(g){let I=5381,t=g.length;for(;t--;)I=(I<<5)-I^g.charCodeAt(t);return I>>>0}(b)}_${i}`,d=g.ownerDocument;v.add(d);const u=d.__svelte_stylesheet||(d.__svelte_stylesheet=d.head.appendChild(Z("style")).sheet),r=d.__svelte_rules||(d.__svelte_rules={});r[s]||(r[s]=!0,u.insertRule(`@keyframes ${s} ${b}`,u.cssRules.length));const a=g.style.animation||"";return g.style.animation=`${a?a+", ":""}${s} ${e}ms linear ${n}ms 1 both`,N+=1,s}function U(g,I){const t=(g.style.animation||"").split(", "),e=t.filter(I?g=>g.indexOf(I)<0:g=>-1===g.indexOf("__svelte")),n=t.length-e.length;n&&(g.style.animation=e.join(", "),N-=n,N||s(()=>{N||(v.forEach(g=>{const I=g.__svelte_stylesheet;let t=I.cssRules.length;for(;t--;)I.deleteRule(t);g.__svelte_rules={}}),v.clear())}))}function Q(g){H=g}function J(){if(!H)throw new Error("Function called outside component initialization");return H}function w(g){J().$$.on_mount.push(g)}function L(){const g=J();return(I,t)=>{const e=g.$$.callbacks[I];if(e){const n=k(I,t);e.slice().forEach(I=>{I.call(g,n)})}}}const z=[],T=[],K=[],E=[],j=Promise.resolve();let M=!1;function P(g){K.push(g)}function D(g){E.push(g)}let O=!1;const $=new Set;function _(){if(!O){O=!0;do{for(let g=0;g<z.length;g+=1){const I=z[g];Q(I),q(I.$$)}for(Q(null),z.length=0;T.length;)T.pop()();for(let g=0;g<K.length;g+=1){const I=K[g];$.has(I)||($.add(I),I())}K.length=0}while(z.length);for(;E.length;)E.pop()();M=!1,O=!1,$.clear()}}function q(g){if(null!==g.fragment){g.update(),C(g.before_update);const I=g.dirty;g.dirty=[-1],g.fragment&&g.fragment.p(g.ctx,I),g.after_update.forEach(P)}}let gg;function Ig(g,I,t){g.dispatchEvent(k(`${I?"intro":"outro"}${t}`))}const tg=new Set;let eg;function ng(){eg={r:0,c:[],p:eg}}function Cg(){eg.r||C(eg.c),eg=eg.p}function cg(g,I){g&&g.i&&(tg.delete(g),g.i(I))}function ig(g,I,t,e){if(g&&g.o){if(tg.has(g))return;tg.add(g),eg.c.push(()=>{tg.delete(g),e&&(t&&g.d(1),e())}),g.o(I)}}const lg={duration:0};function Ag(t,e,n,i){let l=e(t,n),A=i?0:1,s=null,d=null,u=null;function a(){u&&U(t,u)}function o(g,I){const t=g.b-A;return I*=Math.abs(t),{a:A,b:g.b,d:t,duration:I,start:g.start,end:g.start+I,group:g.group}}function G(e){const{delay:n=0,duration:c=300,easing:i=I,tick:G=g,css:Z}=l||lg,m={start:b()+n,b:e};e||(m.group=eg,eg.r+=1),s||d?d=m:(Z&&(a(),u=S(t,A,e,c,n,i,Z)),e&&G(0,1),s=o(m,c),P(()=>Ig(t,e,"start")),r(g=>{if(d&&g>d.start&&(s=o(d,c),d=null,Ig(t,s.b,"start"),Z&&(a(),u=S(t,A,s.b,s.duration,0,i,l.css))),s)if(g>=s.end)G(A=s.b,1-A),Ig(t,s.b,"end"),d||(s.b?a():--s.group.r||C(s.group.c)),s=null;else if(g>=s.start){const I=g-s.start;A=s.a+s.d*i(I/s.duration),G(A,1-A)}return!(!s&&!d)}))}return{run(g){c(l)?(gg||(gg=Promise.resolve(),gg.then(()=>{gg=null})),gg).then(()=>{l=l(),G(g)}):G(g)},end(){a(),s=d=null}}}function bg(g,I){const t=I.token={};function e(g,e,n,C){if(I.token!==t)return;I.resolved=C;let c=I.ctx;void 0!==n&&(c=c.slice(),c[n]=C);const i=g&&(I.current=g)(c);let l=!1;I.block&&(I.blocks?I.blocks.forEach((g,t)=>{t!==e&&g&&(ng(),ig(g,1,1,()=>{I.blocks[t]=null}),Cg())}):I.block.d(1),i.c(),cg(i,1),i.m(I.mount(),I.anchor),l=!0),I.block=i,I.blocks&&(I.blocks[e]=i),l&&_()}if((n=g)&&"object"==typeof n&&"function"==typeof n.then){const t=J();if(g.then(g=>{Q(t),e(I.then,1,I.value,g),Q(null)},g=>{if(Q(t),e(I.catch,2,I.error,g),Q(null),!I.hasCatch)throw g}),I.current!==I.pending)return e(I.pending,0),!0}else{if(I.current!==I.then)return e(I.then,1,I.value,g),!0;I.resolved=g}var n}function sg(g,I){ig(g,1,1,()=>{I.delete(g.key)})}function dg(g,I,t,e,n,C,c,i,l,A,b,s){let d=g.length,u=C.length,r=d;const a={};for(;r--;)a[g[r].key]=r;const o=[],G=new Map,Z=new Map;for(r=u;r--;){const g=s(n,C,r),i=t(g);let l=c.get(i);l?e&&l.p(g,I):(l=A(i,g),l.c()),G.set(i,o[r]=l),i in a&&Z.set(i,Math.abs(r-a[i]))}const m=new Set,X=new Set;function B(g){cg(g,1),g.m(i,b),c.set(g.key,g),b=g.first,u--}for(;d&&u;){const I=o[u-1],t=g[d-1],e=I.key,n=t.key;I===t?(b=I.first,d--,u--):G.has(n)?!c.has(e)||m.has(e)?B(I):X.has(n)?d--:Z.get(e)>Z.get(n)?(X.add(e),B(I)):(m.add(n),d--):(l(t,c),d--)}for(;d--;){const I=g[d];G.has(I.key)||l(I,c)}for(;u;)B(o[u-1]);return o}function ug(g,I,t){const e=g.$$.props[I];void 0!==e&&(g.$$.bound[e]=t,t(g.$$.ctx[e]))}function rg(g){g&&g.c()}function ag(g,I,t){const{fragment:n,on_mount:i,on_destroy:l,after_update:A}=g.$$;n&&n.m(I,t),P(()=>{const I=i.map(e).filter(c);l?l.push(...I):C(I),g.$$.on_mount=[]}),A.forEach(P)}function og(g,I){const t=g.$$;null!==t.fragment&&(C(t.on_destroy),t.fragment&&t.fragment.d(I),t.on_destroy=t.fragment=null,t.ctx=[])}function Gg(g,I){-1===g.$$.dirty[0]&&(z.push(g),M||(M=!0,j.then(_)),g.$$.dirty.fill(0)),g.$$.dirty[I/31|0]|=1<<I%31}function Zg(I,t,e,c,i,l,A=[-1]){const b=H;Q(I);const s=t.props||{},d=I.$$={fragment:null,ctx:null,props:l,update:g,not_equal:i,bound:n(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(b?b.$$.context:[]),callbacks:n(),dirty:A,skip_bound:!1};let u=!1;if(d.ctx=e?e(I,s,(g,t,...e)=>{const n=e.length?e[0]:t;return d.ctx&&i(d.ctx[g],d.ctx[g]=n)&&(!d.skip_bound&&d.bound[g]&&d.bound[g](n),u&&Gg(I,g)),t}):[],d.update(),u=!0,C(d.before_update),d.fragment=!!c&&c(d.ctx),t.target){if(t.hydrate){const g=function(g){return Array.from(g.childNodes)}(t.target);d.fragment&&d.fragment.l(g),g.forEach(G)}else d.fragment&&d.fragment.c();t.intro&&cg(I.$$.fragment),ag(I,t.target,t.anchor),_()}Q(b)}class mg{$destroy(){og(this,1),this.$destroy=g}$on(g,I){const t=this.$$.callbacks[g]||(this.$$.callbacks[g]=[]);return t.push(I),()=>{const g=t.indexOf(I);-1!==g&&t.splice(g,1)}}$set(g){var I;this.$$set&&(I=g,0!==Object.keys(I).length)&&(this.$$.skip_bound=!0,this.$$set(g),this.$$.skip_bound=!1)}}var Xg=function(g,I){I=I||{};var t,e=g.numberOfChannels,n=g.sampleRate,C=I.float32?3:1,c=3===C?32:16;t=2===e?function(g,I){var t=g.length+I.length,e=new Float32Array(t),n=0,C=0;for(;n<t;)e[n++]=g[C],e[n++]=I[C],C++;return e}(g.getChannelData(0),g.getChannelData(1)):g.getChannelData(0);return function(g,I,t,e,n){var C=n/8,c=e*C,i=new ArrayBuffer(44+g.length*C),l=new DataView(i);Bg(l,0,"RIFF"),l.setUint32(4,36+g.length*C,!0),Bg(l,8,"WAVE"),Bg(l,12,"fmt "),l.setUint32(16,16,!0),l.setUint16(20,I,!0),l.setUint16(22,e,!0),l.setUint32(24,t,!0),l.setUint32(28,t*c,!0),l.setUint16(32,c,!0),l.setUint16(34,n,!0),Bg(l,36,"data"),l.setUint32(40,g.length*C,!0),1===I?function(g,I,t){for(var e=0;e<t.length;e++,I+=2){var n=Math.max(-1,Math.min(1,t[e]));g.setInt16(I,n<0?32768*n:32767*n,!0)}}(l,44,g):function(g,I,t){for(var e=0;e<t.length;e++,I+=4)g.setFloat32(I,t[e],!0)}(l,44,g);return i}(t,C,n,e,c)};function Bg(g,I,t){for(var e=0;e<t.length;e++)g.setUint8(I+e,t.charCodeAt(e))}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function hg(g,I,t){return g(t={path:I,exports:{},require:function(g,I){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==I&&t.path)}},t.exports),t.exports}var Vg=hg((function(g,I){g.exports=function g(I,t,e){var n,C,c=window,i="application/octet-stream",l=e||i,A=I,b=!t&&!e&&A,s=document.createElement("a"),d=function(g){return String(g)},u=c.Blob||c.MozBlob||c.WebKitBlob||d,r=t||"download";if(u=u.call?u.bind(c):Blob,"true"===String(this)&&(l=(A=[A,l])[0],A=A[1]),b&&b.length<2048&&(r=b.split("/").pop().split("?")[0],s.href=b,-1!==s.href.indexOf(b))){var a=new XMLHttpRequest;return a.open("GET",b,!0),a.responseType="blob",a.onload=function(I){g(I.target.response,r,i)},setTimeout((function(){a.send()}),0),a}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(A)){if(!(A.length>2096103.424&&u!==d))return navigator.msSaveBlob?navigator.msSaveBlob(m(A),r):X(A);l=(A=m(A)).type||i}else if(/([\x80-\xff])/.test(A)){for(var o=0,G=new Uint8Array(A.length),Z=G.length;o<Z;++o)G[o]=A.charCodeAt(o);A=new u([G],{type:l})}function m(g){for(var I=g.split(/[:;,]/),t=I[1],e=("base64"==I[2]?atob:decodeURIComponent)(I.pop()),n=e.length,C=0,c=new Uint8Array(n);C<n;++C)c[C]=e.charCodeAt(C);return new u([c],{type:t})}function X(g,I){if("download"in s)return s.href=g,s.setAttribute("download",r),s.className="download-js-link",s.innerHTML="downloading...",s.style.display="none",document.body.appendChild(s),setTimeout((function(){s.click(),document.body.removeChild(s),!0===I&&setTimeout((function(){c.URL.revokeObjectURL(s.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(g)&&(g="data:"+g.replace(/^data:([\w\/\-\+]+)/,i)),window.open(g)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=g),!0;var t=document.createElement("iframe");document.body.appendChild(t),!I&&/^data:/.test(g)&&(g="data:"+g.replace(/^data:([\w\/\-\+]+)/,i)),t.src=g,setTimeout((function(){document.body.removeChild(t)}),333)}if(n=A instanceof u?A:new u([A],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(n,r);if(c.URL)X(c.URL.createObjectURL(n),!0);else{if("string"==typeof n||n.constructor===d)try{return X("data:"+l+";base64,"+c.btoa(n))}catch(g){return X("data:"+l+","+encodeURIComponent(n))}(C=new FileReader).onload=function(g){X(this.result)},C.readAsDataURL(n)}return!0}}));const pg=[];function Wg(I,t=g){let e;const n=[];function C(g){if(i(I,g)&&(I=g,e)){const g=!pg.length;for(let g=0;g<n.length;g+=1){const t=n[g];t[1](),pg.push(t,I)}if(g){for(let g=0;g<pg.length;g+=2)pg[g][0](pg[g+1]);pg.length=0}}}return{set:C,update:function(g){C(g(I))},subscribe:function(c,i=g){const l=[c,i];return n.push(l),1===n.length&&(e=t(C)||g),c(I),()=>{const g=n.indexOf(l);-1!==g&&n.splice(g,1),0===n.length&&(e(),e=null)}}}}let xg=null;function Fg(){return xg||(xg=new AudioContext({sampleRate:44100})),xg}async function Rg(g,I){const t=(await async function(g){const I=new OfflineAudioContext({sampleRate:44100,length:g.length,numberOfChannels:1});await I.audioWorklet.addModule("customAudio.js");const t=I.createBufferSource();t.buffer=g,t.start();const e=I.createBiquadFilter();e.type="bandpass",e.frequency.value=1650,e.Q.value=.351364184463,t.connect(e);const n=new AudioWorkletNode(I,"absolute");e.connect(n);const C=new AudioWorkletNode(I,"mean");return n.connect(C),C.connect(I.destination),await I.startRendering()}(I)).getChannelData(0);return g.map(g=>{if("TIMING"!==g.type)return g;const e=g.timings.start/1e3;let n=Math.max(0,Math.round(44100*(e-.5)));const C=g.timings.end/1e3;let c=Math.min(t.length,Math.round(44100*(C+.5))),i=0;for(let g=n;g<c;g++)i=Math.max(i,t[g]);const l=.2*i,A=.03*i;{let g=0;for(let I=n;I>=0;I--){if(t[I]<=A){if(g++,g>4410){n=I;break}}else g=0}}{let g=0;for(let I=c;I<t.length;I++){if(t[I]<=A){if(g++,g>4410){c=I;break}}else g=0}}let b=null;for(let g=n;g<=c;g++){if(t[g]>=l){b=g;break}}let s=null;for(let g=c;g>=n;g--){if(t[g]>=l){s=g;break}}if(b){let g=0;for(let I=b;I>=n;I--){if(t[I]<=A){if(g++,g>4410){b=I;break}}else g=0}}if(s){let g=0;for(let I=s;I<=c;I++){if(t[I]<=A){if(g++,g>4410){s=I;break}}else g=0}}const d=null===b?e-.5:b/44100,u=(null===s?C-.25:s/44100+.05)-d;return{type:"AUDIO",idx:g.idx,start:d,duration:u,buffer:I,stop:()=>{}}})}const yg=Wg({type:"STOPPED"});let fg;function Yg(g,I=0){kg(g);const t=Fg(),e=t.currentTime;let n=0;g.forEach(g=>{if("PAUSE"===g.type||"PARAGRAPH"===g.type)n+=g.duration;else if("AUDIO"===g.type){const C=n+g.duration;if(n>=I)Sg(t,e+n-I,g);else if(C>I){Sg(t,void 0,g,I-n)}n=C}}),yg.set({type:"PLAYING",offset:I,ctxStartTime:e})}function kg(g){g.forEach(g=>{"AUDIO"===g.type&&g.stop()}),yg.set({type:"STOPPED"})}function vg(g){let I=0;g.forEach(g=>{"AUDIO"===g.type&&g.stop(),"NOTHING"!==g.type&&(I+=g.duration)});const t=("PLAYING"===fg.type?fg.offset:0)+("PLAYING"===fg.type?Fg().currentTime-fg.ctxStartTime:-1);t>=I?yg.set({type:"STOPPED"}):yg.set({type:"PAUSED",offset:t})}function Hg(g){"STOPPED"===fg.type?Yg(g):"PAUSED"===fg.type?Yg(g,fg.offset):"PLAYING"===fg.type&&vg(g)}async function Ng(g){const I=Fg(),t=await g.arrayBuffer(),e=await I.decodeAudioData(t);return await async function(g){let I=0;for(let t=0;t<g.numberOfChannels;t++){const e=g.getChannelData(t);for(let g=0;g<e.length;g++)I=Math.max(I,Math.abs(e[g]))}const t=.8/I,e=new OfflineAudioContext({sampleRate:44100,length:g.length}),n=e.createBufferSource();n.buffer=g,n.start();const C=e.createBiquadFilter();C.type="lowshelf",C.frequency.value=10,C.gain.value=-100,n.connect(C);const c=e.createGain();return c.gain.value=t,C.connect(c),c.connect(e.destination),await e.startRendering()}(e)}function Sg(g,I,t,e=0){const n=t.duration-e,C=g.createBufferSource();C.buffer=t.buffer,C.start(I,t.start+e,n);const c=g.createGain();void 0===I?c.gain.value=1:(c.gain.value=0,c.gain.setValueAtTime(0,I),c.gain.linearRampToValueAtTime(1,I+.05),c.gain.linearRampToValueAtTime(1,I+n-.05),c.gain.linearRampToValueAtTime(0,I+n)),C.connect(c),c.connect(g.destination),t.stop=()=>C.stop()}yg.subscribe(g=>{fg=g});async function Ug(g){const I=await Tg();await async function(g,I){return new Promise((t,e)=>{const n=g.transaction(["audio"],"readwrite");n.oncomplete=()=>t(),n.onabort=()=>e("Saving audio aborted"),n.onerror=()=>e("Saving audio error");n.objectStore("audio").put(I,"singleton")})}(I,g)}async function Qg(g){const I=await Tg(),t=g.map(zg);await async function(g,I){return new Promise((t,e)=>{const n=g.transaction(["tokens"],"readwrite");n.oncomplete=()=>t(),n.onabort=()=>e("Saving audio token aborted"),n.onerror=()=>e("Saving audio token error");const C=n.objectStore("tokens");C.clear(),I.forEach(g=>C.put(g))})}(I,t)}async function Jg(g){const I=await Tg(),t=zg(g);await async function(g,I){return new Promise((t,e)=>{const n=g.transaction(["tokens"],"readwrite");n.oncomplete=()=>t(),n.onabort=()=>e("Saving audio token aborted"),n.onerror=()=>e("Saving audio token error");n.objectStore("tokens").put(I)})}(I,t)}async function wg(){const g=await Tg();return await async function(g){return new Promise(async(I,t)=>{const e=g.transaction(["audio"],"readonly");e.onabort=()=>t("Counting audio aborted"),e.onerror=()=>t("Counting audio transaction error");const n=e.objectStore("audio").count();n.onsuccess=()=>I(n.result>0),n.onerror=()=>t("Counting audio error")})}(g)}async function Lg(){const g=await Tg(),I=await async function(g){return new Promise(async(I,t)=>{const e=g.transaction(["audio"],"readonly");e.oncomplete=()=>I(),e.onabort=()=>t("Getting audio aborted"),e.onerror=()=>t("Getting audio transaction error");const n=e.objectStore("audio").get("singleton");n.onsuccess=()=>I(n.result),n.onerror=()=>t("Getting audio error")})}(g),t=await Ng(I),e=(await async function(g){return new Promise(async(I,t)=>{const e=g.transaction(["tokens"],"readonly");e.oncomplete=()=>I(),e.onabort=()=>t("Getting audio aborted"),e.onerror=()=>t("Getting audio error");const n=e.objectStore("tokens"),C=await async function(g){return new Promise((I,t)=>{const e=[],n=g.openCursor();n.onsuccess=()=>{const g=n.result;g?(e.push(g.value),g.continue()):I(e)},n.onerror=()=>t("Opening cursor error")})}(n);I(C)})}(g)).map(g=>function(g,I){if("AUDIO"===g.type)return{...g,buffer:I,stop:()=>{}};return g}(g,t)).sort((g,I)=>g.idx-I.idx);return{audio:t,tokens:e}}function zg(g){return"AUDIO"===g.type?{idx:g.idx,type:g.type,start:g.start,duration:g.duration}:g}async function Tg(){return new Promise((g,I)=>{const t=indexedDB.open("narration.studio",2);t.onupgradeneeded=()=>{!async function(g){const I=new Promise((I,t)=>{const e=g.createObjectStore("audio");e.transaction.oncomplete=()=>I(e),e.transaction.onabort=()=>t("Aborted creating audio store"),e.transaction.onerror=()=>t("Error creating audio store")}),t=new Promise((I,t)=>{const e=g.createObjectStore("tokens",{keyPath:"idx"});e.transaction.oncomplete=()=>I(e),e.transaction.onabort=()=>t("Aborted creating tokens store"),e.transaction.onerror=()=>t("Error creating tokens store")});Promise.all([I,t]).then(([g,I])=>({audio:g,tokens:I}))}(t.result)},t.onsuccess=()=>g(t.result),t.onerror=()=>I("Error opening DB")})}var Kg=null;try{var Eg="undefined"!=typeof module&&"function"==typeof module.require&&module.require("worker_threads")||"function"==typeof __non_webpack_require__&&__non_webpack_require__("worker_threads")||"function"==typeof require&&require("worker_threads");Kg=Eg.Worker}catch(g){}function jg(g,I,t){var e=void 0===I?null:I,n=function(g,I){return Buffer.from(g,"base64").toString(I?"utf16":"utf8")}(g,void 0!==t&&t),C=n.indexOf("\n",10)+1,c=n.substring(C)+(e?"//# sourceMappingURL="+e:"");return function(g){return new Kg(c,Object.assign({},g,{eval:!0}))}}function Mg(g,I,t){var e=void 0===I?null:I,n=function(g,I){var t=atob(g);if(I){for(var e=new Uint8Array(t.length),n=0,C=t.length;n<C;++n)e[n]=t.charCodeAt(n);return String.fromCharCode.apply(null,new Uint16Array(e.buffer))}return t}(g,void 0!==t&&t),C=n.indexOf("\n",10)+1,c=n.substring(C)+(e?"//# sourceMappingURL="+e:""),i=new Blob([c],{type:"application/javascript"});return URL.createObjectURL(i)}var Pg,Dg,Og,$g="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0);const _g=new(Pg="Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwohZnVuY3Rpb24oKXsidXNlIHN0cmljdCI7InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6InVuZGVmaW5lZCIhPXR5cGVvZiB3aW5kb3c/d2luZG93OiJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGYmJnNlbGY7IWZ1bmN0aW9uKGUsdCxuKXtlKG49e3BhdGg6dCxleHBvcnRzOnt9LHJlcXVpcmU6ZnVuY3Rpb24oZSx0KXtyZXR1cm4gZnVuY3Rpb24oKXt0aHJvdyBuZXcgRXJyb3IoIkR5bmFtaWMgcmVxdWlyZXMgYXJlIG5vdCBjdXJyZW50bHkgc3VwcG9ydGVkIGJ5IEByb2xsdXAvcGx1Z2luLWNvbW1vbmpzIil9KG51bGw9PXQmJm4ucGF0aCl9fSxuLmV4cG9ydHMpLG4uZXhwb3J0c30oKGZ1bmN0aW9uKGUsdCl7ZS5leHBvcnRzPWZ1bmN0aW9uIGUodCxuLG8pe3ZhciByLGEsaT13aW5kb3cscz0iYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtIixjPW98fHMsbD10LGY9IW4mJiFvJiZsLHU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiYSIpLGQ9ZnVuY3Rpb24oZSl7cmV0dXJuIFN0cmluZyhlKX0saD1pLkJsb2J8fGkuTW96QmxvYnx8aS5XZWJLaXRCbG9ifHxkLHA9bnx8ImRvd25sb2FkIjtpZihoPWguY2FsbD9oLmJpbmQoaSk6QmxvYiwidHJ1ZSI9PT1TdHJpbmcodGhpcykmJihjPShsPVtsLGNdKVswXSxsPWxbMV0pLGYmJmYubGVuZ3RoPDIwNDgmJihwPWYuc3BsaXQoIi8iKS5wb3AoKS5zcGxpdCgiPyIpWzBdLHUuaHJlZj1mLC0xIT09dS5ocmVmLmluZGV4T2YoZikpKXt2YXIgZz1uZXcgWE1MSHR0cFJlcXVlc3Q7cmV0dXJuIGcub3BlbigiR0VUIixmLCEwKSxnLnJlc3BvbnNlVHlwZT0iYmxvYiIsZy5vbmxvYWQ9ZnVuY3Rpb24odCl7ZSh0LnRhcmdldC5yZXNwb25zZSxwLHMpfSxzZXRUaW1lb3V0KChmdW5jdGlvbigpe2cuc2VuZCgpfSksMCksZ31pZigvXmRhdGE6KFtcdystXStcL1tcdysuLV0rKT9bLDtdLy50ZXN0KGwpKXtpZighKGwubGVuZ3RoPjIwOTYxMDMuNDI0JiZoIT09ZCkpcmV0dXJuIG5hdmlnYXRvci5tc1NhdmVCbG9iP25hdmlnYXRvci5tc1NhdmVCbG9iKHkobCkscCk6QShsKTtjPShsPXkobCkpLnR5cGV8fHN9ZWxzZSBpZigvKFtceDgwLVx4ZmZdKS8udGVzdChsKSl7Zm9yKHZhciBtPTAsdz1uZXcgVWludDhBcnJheShsLmxlbmd0aCksYj13Lmxlbmd0aDttPGI7KyttKXdbbV09bC5jaGFyQ29kZUF0KG0pO2w9bmV3IGgoW3ddLHt0eXBlOmN9KX1mdW5jdGlvbiB5KGUpe2Zvcih2YXIgdD1lLnNwbGl0KC9bOjssXS8pLG49dFsxXSxvPSgiYmFzZTY0Ij09dFsyXT9hdG9iOmRlY29kZVVSSUNvbXBvbmVudCkodC5wb3AoKSkscj1vLmxlbmd0aCxhPTAsaT1uZXcgVWludDhBcnJheShyKTthPHI7KythKWlbYV09by5jaGFyQ29kZUF0KGEpO3JldHVybiBuZXcgaChbaV0se3R5cGU6bn0pfWZ1bmN0aW9uIEEoZSx0KXtpZigiZG93bmxvYWQiaW4gdSlyZXR1cm4gdS5ocmVmPWUsdS5zZXRBdHRyaWJ1dGUoImRvd25sb2FkIixwKSx1LmNsYXNzTmFtZT0iZG93bmxvYWQtanMtbGluayIsdS5pbm5lckhUTUw9ImRvd25sb2FkaW5nLi4uIix1LnN0eWxlLmRpc3BsYXk9Im5vbmUiLGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodSksc2V0VGltZW91dCgoZnVuY3Rpb24oKXt1LmNsaWNrKCksZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh1KSwhMD09PXQmJnNldFRpbWVvdXQoKGZ1bmN0aW9uKCl7aS5VUkwucmV2b2tlT2JqZWN0VVJMKHUuaHJlZil9KSwyNTApfSksNjYpLCEwO2lmKC8oVmVyc2lvbilcLyhcZCspXC4oXGQrKSg/OlwuKFxkKykpPy4qU2FmYXJpXC8vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpcmV0dXJuL15kYXRhOi8udGVzdChlKSYmKGU9ImRhdGE6IitlLnJlcGxhY2UoL15kYXRhOihbXHdcL1wtXCtdKykvLHMpKSx3aW5kb3cub3BlbihlKXx8Y29uZmlybSgiRGlzcGxheWluZyBOZXcgRG9jdW1lbnRcblxuVXNlIFNhdmUgQXMuLi4gdG8gZG93bmxvYWQsIHRoZW4gY2xpY2sgYmFjayB0byByZXR1cm4gdG8gdGhpcyBwYWdlLiIpJiYobG9jYXRpb24uaHJlZj1lKSwhMDt2YXIgbj1kb2N1bWVudC5jcmVhdGVFbGVtZW50KCJpZnJhbWUiKTtkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG4pLCF0JiYvXmRhdGE6Ly50ZXN0KGUpJiYoZT0iZGF0YToiK2UucmVwbGFjZSgvXmRhdGE6KFtcd1wvXC1cK10rKS8scykpLG4uc3JjPWUsc2V0VGltZW91dCgoZnVuY3Rpb24oKXtkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKG4pfSksMzMzKX1pZihyPWwgaW5zdGFuY2VvZiBoP2w6bmV3IGgoW2xdLHt0eXBlOmN9KSxuYXZpZ2F0b3IubXNTYXZlQmxvYilyZXR1cm4gbmF2aWdhdG9yLm1zU2F2ZUJsb2IocixwKTtpZihpLlVSTClBKGkuVVJMLmNyZWF0ZU9iamVjdFVSTChyKSwhMCk7ZWxzZXtpZigic3RyaW5nIj09dHlwZW9mIHJ8fHIuY29uc3RydWN0b3I9PT1kKXRyeXtyZXR1cm4gQSgiZGF0YToiK2MrIjtiYXNlNjQsIitpLmJ0b2EocikpfWNhdGNoKGUpe3JldHVybiBBKCJkYXRhOiIrYysiLCIrZW5jb2RlVVJJQ29tcG9uZW50KHIpKX0oYT1uZXcgRmlsZVJlYWRlcikub25sb2FkPWZ1bmN0aW9uKGUpe0EodGhpcy5yZXN1bHQpfSxhLnJlYWRBc0RhdGFVUkwocil9cmV0dXJuITB9fSkpO2Z1bmN0aW9uIGUoKXt9Y29uc3QgdD1bXTtsZXQgbixvLHIsYTsoZnVuY3Rpb24obixvPWUpe2xldCByO2NvbnN0IGE9W107ZnVuY3Rpb24gaShlKXtpZihpPWUsKChvPW4pIT1vP2k9PWk6byE9PWl8fG8mJiJvYmplY3QiPT10eXBlb2Ygb3x8ImZ1bmN0aW9uIj09dHlwZW9mIG8pJiYobj1lLHIpKXtjb25zdCBlPSF0Lmxlbmd0aDtmb3IobGV0IGU9MDtlPGEubGVuZ3RoO2UrPTEpe2NvbnN0IG89YVtlXTtvWzFdKCksdC5wdXNoKG8sbil9aWYoZSl7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKz0yKXRbZV1bMF0odFtlKzFdKTt0Lmxlbmd0aD0wfX12YXIgbyxpfXJldHVybntzZXQ6aSx1cGRhdGU6ZnVuY3Rpb24oZSl7aShlKG4pKX0sc3Vic2NyaWJlOmZ1bmN0aW9uKHQscz1lKXtjb25zdCBjPVt0LHNdO3JldHVybiBhLnB1c2goYyksMT09PWEubGVuZ3RoJiYocj1vKGkpfHxlKSx0KG4pLCgpPT57Y29uc3QgZT1hLmluZGV4T2YoYyk7LTEhPT1lJiZhLnNwbGljZShlLDEpLDA9PT1hLmxlbmd0aCYmKHIoKSxyPW51bGwpfX19fSkoe3R5cGU6IlNUT1BQRUQifSkuc3Vic2NyaWJlKGU9Pnt9KTtsZXQgaT1udWxsLHM9ITE7ZnVuY3Rpb24gYyhlKXtjb25zdCB0PXIubGVuZ3RoLzIsaT10LzQ0MTAwLHM9dC8obi53aWR0aC8yKS9pKihlLzQ0MTAwKSxjPW8uZ2V0VW5pZm9ybUxvY2F0aW9uKGEsInVfc2NhbGUiKTtvLnVuaWZvcm00ZnYoYyxbcywxLDEsMV0pfWZ1bmN0aW9uIGwoZSx0LG4saSl7Y29uc3Qgcz1NYXRoLnJvdW5kKDQ0MTAwKnQpLGM9ZS1yWzIqc10taSxsPW8uZ2V0VW5pZm9ybUxvY2F0aW9uKGEsInVfb2Zmc2V0Iik7by51bmlmb3JtNGZ2KGwsW2MsMCwwLDBdKTtjb25zdCBmPU1hdGgucm91bmQoNDQxMDAqbiksdT1NYXRoLm1heCgwLHMtMSksZD1NYXRoLm1pbihyLmxlbmd0aC8yLHUrZisyKTtvLmRyYXdBcnJheXMoby5MSU5FX1NUUklQLHUsZC11KX1mdW5jdGlvbiBmKGUsdCxuKXtjb25zdCBpPW8uZ2V0VW5pZm9ybUxvY2F0aW9uKGEsInVfb2Zmc2V0Iik7by51bmlmb3JtNGZ2KGksW2UtbiwwLDAsMF0pO2NvbnN0IHM9bmV3IEZsb2F0MzJBcnJheShbMCwtMSwwLDEsdCwxLHQsLTFdKTtvLmJ1ZmZlclN1YkRhdGEoby5BUlJBWV9CVUZGRVIsci5sZW5ndGgqci5CWVRFU19QRVJfRUxFTUVOVCxzKSxvLmRyYXdBcnJheXMoby5MSU5FX0xPT1Asci5sZW5ndGgvMiw0KX1zZWxmLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLCh7ZGF0YTplfSk9PntpZigiY3JlYXRlIj09PWUudHlwZSkhZnVuY3Rpb24oe2NhbnZhczplLGNoYW5uZWw6dCxpbml0aWFsVmFsdWVzOnN9KXtpPXMsbj1lLG89ZS5nZXRDb250ZXh0KCJ3ZWJnbDIiLHtwcmVzZXJ2ZURyYXdpbmdCdWZmZXI6ITAsZGVzeW5jaHJvbml6ZWQ6ITB9KSxyPWZ1bmN0aW9uKGUpe2NvbnN0IHQ9MiplLmxlbmd0aCxuPW5ldyBGbG9hdDMyQXJyYXkodCk7Zm9yKGxldCB0PTA7dDxlLmxlbmd0aDt0Kyspe2NvbnN0IG89Mip0O25bb109dC80NDEwMCxuW28rMV09ZVt0XX1yZXR1cm4gbn0odCksZnVuY3Rpb24oKXthPWZ1bmN0aW9uKGUsdCxuKXtjb25zdCBvPXUoZSx0LGUuVkVSVEVYX1NIQURFUikscj11KGUsbixlLkZSQUdNRU5UX1NIQURFUiksYT1lLmNyZWF0ZVByb2dyYW0oKTtpZighYSl0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBjcmVhdGUgcHJvZ3JhbSIpO2lmKGUuYXR0YWNoU2hhZGVyKGEsbyksZS5hdHRhY2hTaGFkZXIoYSxyKSxlLmxpbmtQcm9ncmFtKGEpLCFlLmdldFByb2dyYW1QYXJhbWV0ZXIoYSxlLkxJTktfU1RBVFVTKSl0aHJvdyBhbGVydCgiVW5hYmxlIHRvIGluaXRpYWxpemUgdGhlIHNoYWRlciBwcm9ncmFtOiAiK2UuZ2V0UHJvZ3JhbUluZm9Mb2coYSkpLG5ldyBFcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBwcm9ncmFtIik7cmV0dXJuIGF9KG8sIlxuICB1bmlmb3JtIHZlYzQgdV9vZmZzZXQ7XG4gIHVuaWZvcm0gdmVjNCB1X3NjYWxlO1xuICBhdHRyaWJ1dGUgdmVjNCBhX1Bvc2l0aW9uO1xuICB2b2lkIG1haW4oKSB7XG4gICAgZ2xfUG9zaXRpb24gPSB1X3NjYWxlICogKGFfUG9zaXRpb24gKyB1X29mZnNldCk7XG4gIH1cbiIsIlxuICB2b2lkIG1haW4oKSB7XG4gICAgZ2xfRnJhZ0NvbG9yID0gdmVjNCgwLjAsIDAuMCwgMC4wLCAxLjApO1xuICB9XG4iKTtjb25zdCBlPWZ1bmN0aW9uKGUsdCl7Y29uc3Qgbj1lLmNyZWF0ZUJ1ZmZlcigpO2UuYmluZEJ1ZmZlcihlLkFSUkFZX0JVRkZFUixuKTtjb25zdCBvPWUuZ2V0QXR0cmliTG9jYXRpb24odCwiYV9Qb3NpdGlvbiIpO2UudmVydGV4QXR0cmliUG9pbnRlcihvLDIsZS5GTE9BVCwhMSwwLDApLGUuZW5hYmxlVmVydGV4QXR0cmliQXJyYXkobyksZS5idWZmZXJEYXRhKGUuQVJSQVlfQlVGRkVSLChyLmxlbmd0aCs4KSpyLkJZVEVTX1BFUl9FTEVNRU5ULGUuU1RBVElDX0RSQVcpLGUuYnVmZmVyU3ViRGF0YShlLkFSUkFZX0JVRkZFUiwwLHIpfShvLGEpO28udXNlUHJvZ3JhbShhKX0oKX0oZSkscz0hMDtlbHNlIGlmKHMpe2lmKCJ1cGRhdGVfc2Nyb2xsIj09PWUudHlwZSlpLnNjcm9sbD1lLnNjcm9sbDtlbHNlIGlmKCJ1cGRhdGVfem9vbSI9PT1lLnR5cGUpaS5waXhlbHNQZXJTZWNvbmQ9ZS5waXhlbHNQZXJTZWNvbmQsaS5zY3JvbGw9ZS5zY3JvbGw7ZWxzZSBpZigidXBkYXRlX3NpemUiPT09ZS50eXBlKWkud2lkdGg9ZS53aWR0aCxpLmhlaWdodD1lLmhlaWdodDtlbHNle2NvbnN0e2lkeDp0LHN0YXJ0Om4sZHVyYXRpb246b309ZS50b2tlbixyPWkudG9rZW5zW3RdO3IuZHVyYXRpb249bywiQVVESU8iPT09ci50eXBlJiZ2b2lkIDAhPT1uJiYoci5zdGFydD1uKX0hZnVuY3Rpb24oKXtjb25zdHt0b2tlbnM6ZSxwaXhlbHNQZXJTZWNvbmQ6dCxzY3JvbGw6cix3aWR0aDphLGhlaWdodDpzfT1pO24ud2lkdGg9YSxuLmhlaWdodD1zLG8udmlld3BvcnQoMCwwLGEscyksby5jbGVhckNvbG9yKDEsMSwxLDEpLG8uY2xlYXIoby5DT0xPUl9CVUZGRVJfQklUKTtjb25zdCB1PWEvMi90LGQ9ci11LGg9cit1O2xldCBwPTA7Y29uc3QgZz1lLmZpbHRlcihlPT4iTk9USElORyIhPT1lLnR5cGUpO2Zvcihjb25zdCBlIG9mIGcpe2NvbnN0IG49TWF0aC5tYXgoZCxwKSxvPW4tcCxhPWUuZHVyYXRpb24tbyxpPWgtbixzPU1hdGgubWluKGksYSk7aWYocz4wKXtpZihjKHQpLCJBVURJTyI9PT1lLnR5cGUpe2NvbnN0IHQ9ZS5zdGFydCtvO2wobix0LHMscil9ZihuLHMscil9cCs9ZS5kdXJhdGlvbn19KCl9fSk7ZnVuY3Rpb24gdShlLHQsbil7Y29uc3Qgbz1lLmNyZWF0ZVNoYWRlcihuKTtpZighbyl0aHJvdyBuZXcgRXJyb3IoIkZhaWxlZCB0byBjcmVhdGUgc2hhZGVyIik7aWYoZS5zaGFkZXJTb3VyY2Uobyx0KSxlLmNvbXBpbGVTaGFkZXIobyksIWUuZ2V0U2hhZGVyUGFyYW1ldGVyKG8sZS5DT01QSUxFX1NUQVRVUykpdGhyb3cgYWxlcnQoIkFuIGVycm9yIG9jY3VycmVkIGNvbXBpbGluZyB0aGUgc2hhZGVyczogIitlLmdldFNoYWRlckluZm9Mb2cobykpLGUuZGVsZXRlU2hhZGVyKG8pLG5ldyBFcnJvcigiRmFpbGVkIHRvIGNyZWF0ZSBzaGFkZXIiKTtyZXR1cm4gb319KCk7Cgo=",Dg="data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVuZGVyLmpzIiwic291cmNlcyI6WyJ3b3JrZXI6Ly93ZWItd29ya2VyL25vZGVfbW9kdWxlcy9kb3dubG9hZGpzL2Rvd25sb2FkLmpzIiwid29ya2VyOi8vd2ViLXdvcmtlci9ub2RlX21vZHVsZXMvc3ZlbHRlL2ludGVybmFsL2luZGV4Lm1qcyIsIndvcmtlcjovL3dlYi13b3JrZXIvbm9kZV9tb2R1bGVzL3N2ZWx0ZS9zdG9yZS9pbmRleC5tanMiLCJ3b3JrZXI6Ly93ZWItd29ya2VyL3NyYy9lZGl0aW5nL2NhbnZhcy9yZW5kZXIudHMiLCJ3b3JrZXI6Ly93ZWItd29ya2VyL3NyYy9lZGl0aW5nL3Byb2Nlc3Nvci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvL2Rvd25sb2FkLmpzIHY0LjIsIGJ5IGRhbmRhdmlzOyAyMDA4LTIwMTYuIFtNSVRdIHNlZSBodHRwOi8vZGFubWwuY29tL2Rvd25sb2FkLmh0bWwgZm9yIHRlc3RzL3VzYWdlXG4vLyB2MSBsYW5kZWQgYSBGRitDaHJvbWUgY29tcGF0IHdheSBvZiBkb3dubG9hZGluZyBzdHJpbmdzIHRvIGxvY2FsIHVuLW5hbWVkIGZpbGVzLCB1cGdyYWRlZCB0byB1c2UgYSBoaWRkZW4gZnJhbWUgYW5kIG9wdGlvbmFsIG1pbWVcbi8vIHYyIGFkZGVkIG5hbWVkIGZpbGVzIHZpYSBhW2Rvd25sb2FkXSwgbXNTYXZlQmxvYiwgSUUgKDEwKykgc3VwcG9ydCwgYW5kIHdpbmRvdy5VUkwgc3VwcG9ydCBmb3IgbGFyZ2VyK2Zhc3RlciBzYXZlcyB0aGFuIGRhdGFVUkxzXG4vLyB2MyBhZGRlZCBkYXRhVVJMIGFuZCBCbG9iIElucHV0LCBiaW5kLXRvZ2dsZSBhcml0eSwgYW5kIGxlZ2FjeSBkYXRhVVJMIGZhbGxiYWNrIHdhcyBpbXByb3ZlZCB3aXRoIGZvcmNlLWRvd25sb2FkIG1pbWUgYW5kIGJhc2U2NCBzdXBwb3J0LiAzLjEgaW1wcm92ZWQgc2FmYXJpIGhhbmRsaW5nLlxuLy8gdjQgYWRkcyBBTUQvVU1ELCBjb21tb25KUywgYW5kIHBsYWluIGJyb3dzZXIgc3VwcG9ydFxuLy8gdjQuMSBhZGRzIHVybCBkb3dubG9hZCBjYXBhYmlsaXR5IHZpYSBzb2xvIFVSTCBhcmd1bWVudCAoc2FtZSBkb21haW4vQ09SUyBvbmx5KVxuLy8gdjQuMiBhZGRzIHNlbWFudGljIHZhcmlhYmxlIG5hbWVzLCBsb25nIChvdmVyIDJNQikgZGF0YVVSTCBzdXBwb3J0LCBhbmQgaGlkZGVuIGJ5IGRlZmF1bHQgdGVtcCBhbmNob3JzXG4vLyBodHRwczovL2dpdGh1Yi5jb20vcm5kbWUvZG93bmxvYWRcblxuKGZ1bmN0aW9uIChyb290LCBmYWN0b3J5KSB7XG5cdGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcblx0XHQvLyBBTUQuIFJlZ2lzdGVyIGFzIGFuIGFub255bW91cyBtb2R1bGUuXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0fSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcblx0XHQvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcblx0XHQvLyBvbmx5IENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cyxcblx0XHQvLyBsaWtlIE5vZGUuXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdH0gZWxzZSB7XG5cdFx0Ly8gQnJvd3NlciBnbG9iYWxzIChyb290IGlzIHdpbmRvdylcblx0XHRyb290LmRvd25sb2FkID0gZmFjdG9yeSgpO1xuICB9XG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcblxuXHRyZXR1cm4gZnVuY3Rpb24gZG93bmxvYWQoZGF0YSwgc3RyRmlsZU5hbWUsIHN0ck1pbWVUeXBlKSB7XG5cblx0XHR2YXIgc2VsZiA9IHdpbmRvdywgLy8gdGhpcyBzY3JpcHQgaXMgb25seSBmb3IgYnJvd3NlcnMgYW55d2F5Li4uXG5cdFx0XHRkZWZhdWx0TWltZSA9IFwiYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtXCIsIC8vIHRoaXMgZGVmYXVsdCBtaW1lIGFsc28gdHJpZ2dlcnMgaWZyYW1lIGRvd25sb2Fkc1xuXHRcdFx0bWltZVR5cGUgPSBzdHJNaW1lVHlwZSB8fCBkZWZhdWx0TWltZSxcblx0XHRcdHBheWxvYWQgPSBkYXRhLFxuXHRcdFx0dXJsID0gIXN0ckZpbGVOYW1lICYmICFzdHJNaW1lVHlwZSAmJiBwYXlsb2FkLFxuXHRcdFx0YW5jaG9yID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImFcIiksXG5cdFx0XHR0b1N0cmluZyA9IGZ1bmN0aW9uKGEpe3JldHVybiBTdHJpbmcoYSk7fSxcblx0XHRcdG15QmxvYiA9IChzZWxmLkJsb2IgfHwgc2VsZi5Nb3pCbG9iIHx8IHNlbGYuV2ViS2l0QmxvYiB8fCB0b1N0cmluZyksXG5cdFx0XHRmaWxlTmFtZSA9IHN0ckZpbGVOYW1lIHx8IFwiZG93bmxvYWRcIixcblx0XHRcdGJsb2IsXG5cdFx0XHRyZWFkZXI7XG5cdFx0XHRteUJsb2I9IG15QmxvYi5jYWxsID8gbXlCbG9iLmJpbmQoc2VsZikgOiBCbG9iIDtcblx0ICBcblx0XHRpZihTdHJpbmcodGhpcyk9PT1cInRydWVcIil7IC8vcmV2ZXJzZSBhcmd1bWVudHMsIGFsbG93aW5nIGRvd25sb2FkLmJpbmQodHJ1ZSwgXCJ0ZXh0L3htbFwiLCBcImV4cG9ydC54bWxcIikgdG8gYWN0IGFzIGEgY2FsbGJhY2tcblx0XHRcdHBheWxvYWQ9W3BheWxvYWQsIG1pbWVUeXBlXTtcblx0XHRcdG1pbWVUeXBlPXBheWxvYWRbMF07XG5cdFx0XHRwYXlsb2FkPXBheWxvYWRbMV07XG5cdFx0fVxuXG5cblx0XHRpZih1cmwgJiYgdXJsLmxlbmd0aDwgMjA0OCl7IC8vIGlmIG5vIGZpbGVuYW1lIGFuZCBubyBtaW1lLCBhc3N1bWUgYSB1cmwgd2FzIHBhc3NlZCBhcyB0aGUgb25seSBhcmd1bWVudFxuXHRcdFx0ZmlsZU5hbWUgPSB1cmwuc3BsaXQoXCIvXCIpLnBvcCgpLnNwbGl0KFwiP1wiKVswXTtcblx0XHRcdGFuY2hvci5ocmVmID0gdXJsOyAvLyBhc3NpZ24gaHJlZiBwcm9wIHRvIHRlbXAgYW5jaG9yXG5cdFx0ICBcdGlmKGFuY2hvci5ocmVmLmluZGV4T2YodXJsKSAhPT0gLTEpeyAvLyBpZiB0aGUgYnJvd3NlciBkZXRlcm1pbmVzIHRoYXQgaXQncyBhIHBvdGVudGlhbGx5IHZhbGlkIHVybCBwYXRoOlxuICAgICAgICBcdFx0dmFyIGFqYXg9bmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG4gICAgICAgIFx0XHRhamF4Lm9wZW4oIFwiR0VUXCIsIHVybCwgdHJ1ZSk7XG4gICAgICAgIFx0XHRhamF4LnJlc3BvbnNlVHlwZSA9ICdibG9iJztcbiAgICAgICAgXHRcdGFqYXgub25sb2FkPSBmdW5jdGlvbihlKXsgXG5cdFx0XHRcdCAgZG93bmxvYWQoZS50YXJnZXQucmVzcG9uc2UsIGZpbGVOYW1lLCBkZWZhdWx0TWltZSk7XG5cdFx0XHRcdH07XG4gICAgICAgIFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGFqYXguc2VuZCgpO30sIDApOyAvLyBhbGxvd3Mgc2V0dGluZyBjdXN0b20gYWpheCBoZWFkZXJzIHVzaW5nIHRoZSByZXR1cm46XG5cdFx0XHQgICAgcmV0dXJuIGFqYXg7XG5cdFx0XHR9IC8vIGVuZCBpZiB2YWxpZCB1cmw/XG5cdFx0fSAvLyBlbmQgaWYgdXJsP1xuXG5cblx0XHQvL2dvIGFoZWFkIGFuZCBkb3dubG9hZCBkYXRhVVJMcyByaWdodCBhd2F5XG5cdFx0aWYoL15kYXRhOihbXFx3Ky1dK1xcL1tcXHcrLi1dKyk/Wyw7XS8udGVzdChwYXlsb2FkKSl7XG5cdFx0XG5cdFx0XHRpZihwYXlsb2FkLmxlbmd0aCA+ICgxMDI0KjEwMjQqMS45OTkpICYmIG15QmxvYiAhPT0gdG9TdHJpbmcgKXtcblx0XHRcdFx0cGF5bG9hZD1kYXRhVXJsVG9CbG9iKHBheWxvYWQpO1xuXHRcdFx0XHRtaW1lVHlwZT1wYXlsb2FkLnR5cGUgfHwgZGVmYXVsdE1pbWU7XG5cdFx0XHR9ZWxzZXtcdFx0XHRcblx0XHRcdFx0cmV0dXJuIG5hdmlnYXRvci5tc1NhdmVCbG9iID8gIC8vIElFMTAgY2FuJ3QgZG8gYVtkb3dubG9hZF0sIG9ubHkgQmxvYnM6XG5cdFx0XHRcdFx0bmF2aWdhdG9yLm1zU2F2ZUJsb2IoZGF0YVVybFRvQmxvYihwYXlsb2FkKSwgZmlsZU5hbWUpIDpcblx0XHRcdFx0XHRzYXZlcihwYXlsb2FkKSA7IC8vIGV2ZXJ5b25lIGVsc2UgY2FuIHNhdmUgZGF0YVVSTHMgdW4tcHJvY2Vzc2VkXG5cdFx0XHR9XG5cdFx0XHRcblx0XHR9ZWxzZXsvL25vdCBkYXRhIHVybCwgaXMgaXQgYSBzdHJpbmcgd2l0aCBzcGVjaWFsIG5lZWRzP1xuXHRcdFx0aWYoLyhbXFx4ODAtXFx4ZmZdKS8udGVzdChwYXlsb2FkKSl7XHRcdFx0ICBcblx0XHRcdFx0dmFyIGk9MCwgdGVtcFVpQXJyPSBuZXcgVWludDhBcnJheShwYXlsb2FkLmxlbmd0aCksIG14PXRlbXBVaUFyci5sZW5ndGg7XG5cdFx0XHRcdGZvcihpO2k8bXg7KytpKSB0ZW1wVWlBcnJbaV09IHBheWxvYWQuY2hhckNvZGVBdChpKTtcblx0XHRcdCBcdHBheWxvYWQ9bmV3IG15QmxvYihbdGVtcFVpQXJyXSwge3R5cGU6IG1pbWVUeXBlfSk7XG5cdFx0XHR9XHRcdCAgXG5cdFx0fVxuXHRcdGJsb2IgPSBwYXlsb2FkIGluc3RhbmNlb2YgbXlCbG9iID9cblx0XHRcdHBheWxvYWQgOlxuXHRcdFx0bmV3IG15QmxvYihbcGF5bG9hZF0sIHt0eXBlOiBtaW1lVHlwZX0pIDtcblxuXG5cdFx0ZnVuY3Rpb24gZGF0YVVybFRvQmxvYihzdHJVcmwpIHtcblx0XHRcdHZhciBwYXJ0cz0gc3RyVXJsLnNwbGl0KC9bOjssXS8pLFxuXHRcdFx0dHlwZT0gcGFydHNbMV0sXG5cdFx0XHRkZWNvZGVyPSBwYXJ0c1syXSA9PSBcImJhc2U2NFwiID8gYXRvYiA6IGRlY29kZVVSSUNvbXBvbmVudCxcblx0XHRcdGJpbkRhdGE9IGRlY29kZXIoIHBhcnRzLnBvcCgpICksXG5cdFx0XHRteD0gYmluRGF0YS5sZW5ndGgsXG5cdFx0XHRpPSAwLFxuXHRcdFx0dWlBcnI9IG5ldyBVaW50OEFycmF5KG14KTtcblxuXHRcdFx0Zm9yKGk7aTxteDsrK2kpIHVpQXJyW2ldPSBiaW5EYXRhLmNoYXJDb2RlQXQoaSk7XG5cblx0XHRcdHJldHVybiBuZXcgbXlCbG9iKFt1aUFycl0sIHt0eXBlOiB0eXBlfSk7XG5cdFx0IH1cblxuXHRcdGZ1bmN0aW9uIHNhdmVyKHVybCwgd2luTW9kZSl7XG5cblx0XHRcdGlmICgnZG93bmxvYWQnIGluIGFuY2hvcikgeyAvL2h0bWw1IEFbZG93bmxvYWRdXG5cdFx0XHRcdGFuY2hvci5ocmVmID0gdXJsO1xuXHRcdFx0XHRhbmNob3Iuc2V0QXR0cmlidXRlKFwiZG93bmxvYWRcIiwgZmlsZU5hbWUpO1xuXHRcdFx0XHRhbmNob3IuY2xhc3NOYW1lID0gXCJkb3dubG9hZC1qcy1saW5rXCI7XG5cdFx0XHRcdGFuY2hvci5pbm5lckhUTUwgPSBcImRvd25sb2FkaW5nLi4uXCI7XG5cdFx0XHRcdGFuY2hvci5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XG5cdFx0XHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoYW5jaG9yKTtcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRhbmNob3IuY2xpY2soKTtcblx0XHRcdFx0XHRkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGFuY2hvcik7XG5cdFx0XHRcdFx0aWYod2luTW9kZT09PXRydWUpe3NldFRpbWVvdXQoZnVuY3Rpb24oKXsgc2VsZi5VUkwucmV2b2tlT2JqZWN0VVJMKGFuY2hvci5ocmVmKTt9LCAyNTAgKTt9XG5cdFx0XHRcdH0sIDY2KTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vIGhhbmRsZSBub24tYVtkb3dubG9hZF0gc2FmYXJpIGFzIGJlc3Qgd2UgY2FuOlxuXHRcdFx0aWYoLyhWZXJzaW9uKVxcLyhcXGQrKVxcLihcXGQrKSg/OlxcLihcXGQrKSk/LipTYWZhcmlcXC8vLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkpIHtcblx0XHRcdFx0aWYoL15kYXRhOi8udGVzdCh1cmwpKVx0dXJsPVwiZGF0YTpcIit1cmwucmVwbGFjZSgvXmRhdGE6KFtcXHdcXC9cXC1cXCtdKykvLCBkZWZhdWx0TWltZSk7XG5cdFx0XHRcdGlmKCF3aW5kb3cub3Blbih1cmwpKXsgLy8gcG9wdXAgYmxvY2tlZCwgb2ZmZXIgZGlyZWN0IGRvd25sb2FkOlxuXHRcdFx0XHRcdGlmKGNvbmZpcm0oXCJEaXNwbGF5aW5nIE5ldyBEb2N1bWVudFxcblxcblVzZSBTYXZlIEFzLi4uIHRvIGRvd25sb2FkLCB0aGVuIGNsaWNrIGJhY2sgdG8gcmV0dXJuIHRvIHRoaXMgcGFnZS5cIikpeyBsb2NhdGlvbi5ocmVmPXVybDsgfVxuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvL2RvIGlmcmFtZSBkYXRhVVJMIGRvd25sb2FkIChvbGQgY2grRkYpOlxuXHRcdFx0dmFyIGYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiaWZyYW1lXCIpO1xuXHRcdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmKTtcblxuXHRcdFx0aWYoIXdpbk1vZGUgJiYgL15kYXRhOi8udGVzdCh1cmwpKXsgLy8gZm9yY2UgYSBtaW1lIHRoYXQgd2lsbCBkb3dubG9hZDpcblx0XHRcdFx0dXJsPVwiZGF0YTpcIit1cmwucmVwbGFjZSgvXmRhdGE6KFtcXHdcXC9cXC1cXCtdKykvLCBkZWZhdWx0TWltZSk7XG5cdFx0XHR9XG5cdFx0XHRmLnNyYz11cmw7XG5cdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZik7IH0sIDMzMyk7XG5cblx0XHR9Ly9lbmQgc2F2ZXJcblxuXG5cblxuXHRcdGlmIChuYXZpZ2F0b3IubXNTYXZlQmxvYikgeyAvLyBJRTEwKyA6IChoYXMgQmxvYiwgYnV0IG5vdCBhW2Rvd25sb2FkXSBvciBVUkwpXG5cdFx0XHRyZXR1cm4gbmF2aWdhdG9yLm1zU2F2ZUJsb2IoYmxvYiwgZmlsZU5hbWUpO1xuXHRcdH1cblxuXHRcdGlmKHNlbGYuVVJMKXsgLy8gc2ltcGxlIGZhc3QgYW5kIG1vZGVybiB3YXkgdXNpbmcgQmxvYiBhbmQgVVJMOlxuXHRcdFx0c2F2ZXIoc2VsZi5VUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpLCB0cnVlKTtcblx0XHR9ZWxzZXtcblx0XHRcdC8vIGhhbmRsZSBub24tQmxvYigpK25vbi1VUkwgYnJvd3NlcnM6XG5cdFx0XHRpZih0eXBlb2YgYmxvYiA9PT0gXCJzdHJpbmdcIiB8fCBibG9iLmNvbnN0cnVjdG9yPT09dG9TdHJpbmcgKXtcblx0XHRcdFx0dHJ5e1xuXHRcdFx0XHRcdHJldHVybiBzYXZlciggXCJkYXRhOlwiICsgIG1pbWVUeXBlICAgKyBcIjtiYXNlNjQsXCIgICsgIHNlbGYuYnRvYShibG9iKSAgKTtcblx0XHRcdFx0fWNhdGNoKHkpe1xuXHRcdFx0XHRcdHJldHVybiBzYXZlciggXCJkYXRhOlwiICsgIG1pbWVUeXBlICAgKyBcIixcIiArIGVuY29kZVVSSUNvbXBvbmVudChibG9iKSAgKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBCbG9iIGJ1dCBub3QgVVJMIHN1cHBvcnQ6XG5cdFx0XHRyZWFkZXI9bmV3IEZpbGVSZWFkZXIoKTtcblx0XHRcdHJlYWRlci5vbmxvYWQ9ZnVuY3Rpb24oZSl7XG5cdFx0XHRcdHNhdmVyKHRoaXMucmVzdWx0KTtcblx0XHRcdH07XG5cdFx0XHRyZWFkZXIucmVhZEFzRGF0YVVSTChibG9iKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRydWU7XG5cdH07IC8qIGVuZCBkb3dubG9hZCgpICovXG59KSk7XG4iLCJmdW5jdGlvbiBub29wKCkgeyB9XG5jb25zdCBpZGVudGl0eSA9IHggPT4geDtcbmZ1bmN0aW9uIGFzc2lnbih0YXIsIHNyYykge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBmb3IgKGNvbnN0IGsgaW4gc3JjKVxuICAgICAgICB0YXJba10gPSBzcmNba107XG4gICAgcmV0dXJuIHRhcjtcbn1cbmZ1bmN0aW9uIGlzX3Byb21pc2UodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdmFsdWUudGhlbiA9PT0gJ2Z1bmN0aW9uJztcbn1cbmZ1bmN0aW9uIGFkZF9sb2NhdGlvbihlbGVtZW50LCBmaWxlLCBsaW5lLCBjb2x1bW4sIGNoYXIpIHtcbiAgICBlbGVtZW50Ll9fc3ZlbHRlX21ldGEgPSB7XG4gICAgICAgIGxvYzogeyBmaWxlLCBsaW5lLCBjb2x1bW4sIGNoYXIgfVxuICAgIH07XG59XG5mdW5jdGlvbiBydW4oZm4pIHtcbiAgICByZXR1cm4gZm4oKTtcbn1cbmZ1bmN0aW9uIGJsYW5rX29iamVjdCgpIHtcbiAgICByZXR1cm4gT2JqZWN0LmNyZWF0ZShudWxsKTtcbn1cbmZ1bmN0aW9uIHJ1bl9hbGwoZm5zKSB7XG4gICAgZm5zLmZvckVhY2gocnVuKTtcbn1cbmZ1bmN0aW9uIGlzX2Z1bmN0aW9uKHRoaW5nKSB7XG4gICAgcmV0dXJuIHR5cGVvZiB0aGluZyA9PT0gJ2Z1bmN0aW9uJztcbn1cbmZ1bmN0aW9uIHNhZmVfbm90X2VxdWFsKGEsIGIpIHtcbiAgICByZXR1cm4gYSAhPSBhID8gYiA9PSBiIDogYSAhPT0gYiB8fCAoKGEgJiYgdHlwZW9mIGEgPT09ICdvYmplY3QnKSB8fCB0eXBlb2YgYSA9PT0gJ2Z1bmN0aW9uJyk7XG59XG5mdW5jdGlvbiBub3RfZXF1YWwoYSwgYikge1xuICAgIHJldHVybiBhICE9IGEgPyBiID09IGIgOiBhICE9PSBiO1xufVxuZnVuY3Rpb24gaXNfZW1wdHkob2JqKSB7XG4gICAgcmV0dXJuIE9iamVjdC5rZXlzKG9iaikubGVuZ3RoID09PSAwO1xufVxuZnVuY3Rpb24gdmFsaWRhdGVfc3RvcmUoc3RvcmUsIG5hbWUpIHtcbiAgICBpZiAoc3RvcmUgIT0gbnVsbCAmJiB0eXBlb2Ygc3RvcmUuc3Vic2NyaWJlICE9PSAnZnVuY3Rpb24nKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJyR7bmFtZX0nIGlzIG5vdCBhIHN0b3JlIHdpdGggYSAnc3Vic2NyaWJlJyBtZXRob2RgKTtcbiAgICB9XG59XG5mdW5jdGlvbiBzdWJzY3JpYmUoc3RvcmUsIC4uLmNhbGxiYWNrcykge1xuICAgIGlmIChzdG9yZSA9PSBudWxsKSB7XG4gICAgICAgIHJldHVybiBub29wO1xuICAgIH1cbiAgICBjb25zdCB1bnN1YiA9IHN0b3JlLnN1YnNjcmliZSguLi5jYWxsYmFja3MpO1xuICAgIHJldHVybiB1bnN1Yi51bnN1YnNjcmliZSA/ICgpID0+IHVuc3ViLnVuc3Vic2NyaWJlKCkgOiB1bnN1Yjtcbn1cbmZ1bmN0aW9uIGdldF9zdG9yZV92YWx1ZShzdG9yZSkge1xuICAgIGxldCB2YWx1ZTtcbiAgICBzdWJzY3JpYmUoc3RvcmUsIF8gPT4gdmFsdWUgPSBfKSgpO1xuICAgIHJldHVybiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIGNvbXBvbmVudF9zdWJzY3JpYmUoY29tcG9uZW50LCBzdG9yZSwgY2FsbGJhY2spIHtcbiAgICBjb21wb25lbnQuJCQub25fZGVzdHJveS5wdXNoKHN1YnNjcmliZShzdG9yZSwgY2FsbGJhY2spKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZV9zbG90KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pIHtcbiAgICBpZiAoZGVmaW5pdGlvbikge1xuICAgICAgICBjb25zdCBzbG90X2N0eCA9IGdldF9zbG90X2NvbnRleHQoZGVmaW5pdGlvbiwgY3R4LCAkJHNjb3BlLCBmbik7XG4gICAgICAgIHJldHVybiBkZWZpbml0aW9uWzBdKHNsb3RfY3R4KTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRfc2xvdF9jb250ZXh0KGRlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZm4pIHtcbiAgICByZXR1cm4gZGVmaW5pdGlvblsxXSAmJiBmblxuICAgICAgICA/IGFzc2lnbigkJHNjb3BlLmN0eC5zbGljZSgpLCBkZWZpbml0aW9uWzFdKGZuKGN0eCkpKVxuICAgICAgICA6ICQkc2NvcGUuY3R4O1xufVxuZnVuY3Rpb24gZ2V0X3Nsb3RfY2hhbmdlcyhkZWZpbml0aW9uLCAkJHNjb3BlLCBkaXJ0eSwgZm4pIHtcbiAgICBpZiAoZGVmaW5pdGlvblsyXSAmJiBmbikge1xuICAgICAgICBjb25zdCBsZXRzID0gZGVmaW5pdGlvblsyXShmbihkaXJ0eSkpO1xuICAgICAgICBpZiAoJCRzY29wZS5kaXJ0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gbGV0cztcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGxldHMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBjb25zdCBtZXJnZWQgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IGxlbiA9IE1hdGgubWF4KCQkc2NvcGUuZGlydHkubGVuZ3RoLCBsZXRzLmxlbmd0aCk7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxlbjsgaSArPSAxKSB7XG4gICAgICAgICAgICAgICAgbWVyZ2VkW2ldID0gJCRzY29wZS5kaXJ0eVtpXSB8IGxldHNbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gbWVyZ2VkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAkJHNjb3BlLmRpcnR5IHwgbGV0cztcbiAgICB9XG4gICAgcmV0dXJuICQkc2NvcGUuZGlydHk7XG59XG5mdW5jdGlvbiB1cGRhdGVfc2xvdChzbG90LCBzbG90X2RlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZGlydHksIGdldF9zbG90X2NoYW5nZXNfZm4sIGdldF9zbG90X2NvbnRleHRfZm4pIHtcbiAgICBjb25zdCBzbG90X2NoYW5nZXMgPSBnZXRfc2xvdF9jaGFuZ2VzKHNsb3RfZGVmaW5pdGlvbiwgJCRzY29wZSwgZGlydHksIGdldF9zbG90X2NoYW5nZXNfZm4pO1xuICAgIGlmIChzbG90X2NoYW5nZXMpIHtcbiAgICAgICAgY29uc3Qgc2xvdF9jb250ZXh0ID0gZ2V0X3Nsb3RfY29udGV4dChzbG90X2RlZmluaXRpb24sIGN0eCwgJCRzY29wZSwgZ2V0X3Nsb3RfY29udGV4dF9mbik7XG4gICAgICAgIHNsb3QucChzbG90X2NvbnRleHQsIHNsb3RfY2hhbmdlcyk7XG4gICAgfVxufVxuZnVuY3Rpb24gZXhjbHVkZV9pbnRlcm5hbF9wcm9wcyhwcm9wcykge1xuICAgIGNvbnN0IHJlc3VsdCA9IHt9O1xuICAgIGZvciAoY29uc3QgayBpbiBwcm9wcylcbiAgICAgICAgaWYgKGtbMF0gIT09ICckJylcbiAgICAgICAgICAgIHJlc3VsdFtrXSA9IHByb3BzW2tdO1xuICAgIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBjb21wdXRlX3Jlc3RfcHJvcHMocHJvcHMsIGtleXMpIHtcbiAgICBjb25zdCByZXN0ID0ge307XG4gICAga2V5cyA9IG5ldyBTZXQoa2V5cyk7XG4gICAgZm9yIChjb25zdCBrIGluIHByb3BzKVxuICAgICAgICBpZiAoIWtleXMuaGFzKGspICYmIGtbMF0gIT09ICckJylcbiAgICAgICAgICAgIHJlc3Rba10gPSBwcm9wc1trXTtcbiAgICByZXR1cm4gcmVzdDtcbn1cbmZ1bmN0aW9uIGNvbXB1dGVfc2xvdHMoc2xvdHMpIHtcbiAgICBjb25zdCByZXN1bHQgPSB7fTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBzbG90cykge1xuICAgICAgICByZXN1bHRba2V5XSA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5mdW5jdGlvbiBvbmNlKGZuKSB7XG4gICAgbGV0IHJhbiA9IGZhbHNlO1xuICAgIHJldHVybiBmdW5jdGlvbiAoLi4uYXJncykge1xuICAgICAgICBpZiAocmFuKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICByYW4gPSB0cnVlO1xuICAgICAgICBmbi5jYWxsKHRoaXMsIC4uLmFyZ3MpO1xuICAgIH07XG59XG5mdW5jdGlvbiBudWxsX3RvX2VtcHR5KHZhbHVlKSB7XG4gICAgcmV0dXJuIHZhbHVlID09IG51bGwgPyAnJyA6IHZhbHVlO1xufVxuZnVuY3Rpb24gc2V0X3N0b3JlX3ZhbHVlKHN0b3JlLCByZXQsIHZhbHVlID0gcmV0KSB7XG4gICAgc3RvcmUuc2V0KHZhbHVlKTtcbiAgICByZXR1cm4gcmV0O1xufVxuY29uc3QgaGFzX3Byb3AgPSAob2JqLCBwcm9wKSA9PiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBwcm9wKTtcbmZ1bmN0aW9uIGFjdGlvbl9kZXN0cm95ZXIoYWN0aW9uX3Jlc3VsdCkge1xuICAgIHJldHVybiBhY3Rpb25fcmVzdWx0ICYmIGlzX2Z1bmN0aW9uKGFjdGlvbl9yZXN1bHQuZGVzdHJveSkgPyBhY3Rpb25fcmVzdWx0LmRlc3Ryb3kgOiBub29wO1xufVxuXG5jb25zdCBpc19jbGllbnQgPSB0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJztcbmxldCBub3cgPSBpc19jbGllbnRcbiAgICA/ICgpID0+IHdpbmRvdy5wZXJmb3JtYW5jZS5ub3coKVxuICAgIDogKCkgPT4gRGF0ZS5ub3coKTtcbmxldCByYWYgPSBpc19jbGllbnQgPyBjYiA9PiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoY2IpIDogbm9vcDtcbi8vIHVzZWQgaW50ZXJuYWxseSBmb3IgdGVzdGluZ1xuZnVuY3Rpb24gc2V0X25vdyhmbikge1xuICAgIG5vdyA9IGZuO1xufVxuZnVuY3Rpb24gc2V0X3JhZihmbikge1xuICAgIHJhZiA9IGZuO1xufVxuXG5jb25zdCB0YXNrcyA9IG5ldyBTZXQoKTtcbmZ1bmN0aW9uIHJ1bl90YXNrcyhub3cpIHtcbiAgICB0YXNrcy5mb3JFYWNoKHRhc2sgPT4ge1xuICAgICAgICBpZiAoIXRhc2suYyhub3cpKSB7XG4gICAgICAgICAgICB0YXNrcy5kZWxldGUodGFzayk7XG4gICAgICAgICAgICB0YXNrLmYoKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmICh0YXNrcy5zaXplICE9PSAwKVxuICAgICAgICByYWYocnVuX3Rhc2tzKTtcbn1cbi8qKlxuICogRm9yIHRlc3RpbmcgcHVycG9zZXMgb25seSFcbiAqL1xuZnVuY3Rpb24gY2xlYXJfbG9vcHMoKSB7XG4gICAgdGFza3MuY2xlYXIoKTtcbn1cbi8qKlxuICogQ3JlYXRlcyBhIG5ldyB0YXNrIHRoYXQgcnVucyBvbiBlYWNoIHJhZiBmcmFtZVxuICogdW50aWwgaXQgcmV0dXJucyBhIGZhbHN5IHZhbHVlIG9yIGlzIGFib3J0ZWRcbiAqL1xuZnVuY3Rpb24gbG9vcChjYWxsYmFjaykge1xuICAgIGxldCB0YXNrO1xuICAgIGlmICh0YXNrcy5zaXplID09PSAwKVxuICAgICAgICByYWYocnVuX3Rhc2tzKTtcbiAgICByZXR1cm4ge1xuICAgICAgICBwcm9taXNlOiBuZXcgUHJvbWlzZShmdWxmaWxsID0+IHtcbiAgICAgICAgICAgIHRhc2tzLmFkZCh0YXNrID0geyBjOiBjYWxsYmFjaywgZjogZnVsZmlsbCB9KTtcbiAgICAgICAgfSksXG4gICAgICAgIGFib3J0KCkge1xuICAgICAgICAgICAgdGFza3MuZGVsZXRlKHRhc2spO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZnVuY3Rpb24gYXBwZW5kKHRhcmdldCwgbm9kZSkge1xuICAgIHRhcmdldC5hcHBlbmRDaGlsZChub2RlKTtcbn1cbmZ1bmN0aW9uIGluc2VydCh0YXJnZXQsIG5vZGUsIGFuY2hvcikge1xuICAgIHRhcmdldC5pbnNlcnRCZWZvcmUobm9kZSwgYW5jaG9yIHx8IG51bGwpO1xufVxuZnVuY3Rpb24gZGV0YWNoKG5vZGUpIHtcbiAgICBub2RlLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobm9kZSk7XG59XG5mdW5jdGlvbiBkZXN0cm95X2VhY2goaXRlcmF0aW9ucywgZGV0YWNoaW5nKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVyYXRpb25zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGlmIChpdGVyYXRpb25zW2ldKVxuICAgICAgICAgICAgaXRlcmF0aW9uc1tpXS5kKGRldGFjaGluZyk7XG4gICAgfVxufVxuZnVuY3Rpb24gZWxlbWVudChuYW1lKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQobmFtZSk7XG59XG5mdW5jdGlvbiBlbGVtZW50X2lzKG5hbWUsIGlzKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQobmFtZSwgeyBpcyB9KTtcbn1cbmZ1bmN0aW9uIG9iamVjdF93aXRob3V0X3Byb3BlcnRpZXMob2JqLCBleGNsdWRlKSB7XG4gICAgY29uc3QgdGFyZ2V0ID0ge307XG4gICAgZm9yIChjb25zdCBrIGluIG9iaikge1xuICAgICAgICBpZiAoaGFzX3Byb3Aob2JqLCBrKVxuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgJiYgZXhjbHVkZS5pbmRleE9mKGspID09PSAtMSkge1xuICAgICAgICAgICAgLy8gQHRzLWlnbm9yZVxuICAgICAgICAgICAgdGFyZ2V0W2tdID0gb2JqW2tdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0YXJnZXQ7XG59XG5mdW5jdGlvbiBzdmdfZWxlbWVudChuYW1lKSB7XG4gICAgcmV0dXJuIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnROUygnaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnLCBuYW1lKTtcbn1cbmZ1bmN0aW9uIHRleHQoZGF0YSkge1xuICAgIHJldHVybiBkb2N1bWVudC5jcmVhdGVUZXh0Tm9kZShkYXRhKTtcbn1cbmZ1bmN0aW9uIHNwYWNlKCkge1xuICAgIHJldHVybiB0ZXh0KCcgJyk7XG59XG5mdW5jdGlvbiBlbXB0eSgpIHtcbiAgICByZXR1cm4gdGV4dCgnJyk7XG59XG5mdW5jdGlvbiBsaXN0ZW4obm9kZSwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpIHtcbiAgICBub2RlLmFkZEV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpO1xuICAgIHJldHVybiAoKSA9PiBub2RlLnJlbW92ZUV2ZW50TGlzdGVuZXIoZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMpO1xufVxuZnVuY3Rpb24gcHJldmVudF9kZWZhdWx0KGZuKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIHJldHVybiBmbi5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICB9O1xufVxuZnVuY3Rpb24gc3RvcF9wcm9wYWdhdGlvbihmbikge1xuICAgIHJldHVybiBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgcmV0dXJuIGZuLmNhbGwodGhpcywgZXZlbnQpO1xuICAgIH07XG59XG5mdW5jdGlvbiBzZWxmKGZuKSB7XG4gICAgcmV0dXJuIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgIGlmIChldmVudC50YXJnZXQgPT09IHRoaXMpXG4gICAgICAgICAgICBmbi5jYWxsKHRoaXMsIGV2ZW50KTtcbiAgICB9O1xufVxuZnVuY3Rpb24gYXR0cihub2RlLCBhdHRyaWJ1dGUsIHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlID09IG51bGwpXG4gICAgICAgIG5vZGUucmVtb3ZlQXR0cmlidXRlKGF0dHJpYnV0ZSk7XG4gICAgZWxzZSBpZiAobm9kZS5nZXRBdHRyaWJ1dGUoYXR0cmlidXRlKSAhPT0gdmFsdWUpXG4gICAgICAgIG5vZGUuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgdmFsdWUpO1xufVxuZnVuY3Rpb24gc2V0X2F0dHJpYnV0ZXMobm9kZSwgYXR0cmlidXRlcykge1xuICAgIC8vIEB0cy1pZ25vcmVcbiAgICBjb25zdCBkZXNjcmlwdG9ycyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzKG5vZGUuX19wcm90b19fKTtcbiAgICBmb3IgKGNvbnN0IGtleSBpbiBhdHRyaWJ1dGVzKSB7XG4gICAgICAgIGlmIChhdHRyaWJ1dGVzW2tleV0gPT0gbnVsbCkge1xuICAgICAgICAgICAgbm9kZS5yZW1vdmVBdHRyaWJ1dGUoa2V5KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdzdHlsZScpIHtcbiAgICAgICAgICAgIG5vZGUuc3R5bGUuY3NzVGV4dCA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChrZXkgPT09ICdfX3ZhbHVlJykge1xuICAgICAgICAgICAgbm9kZS52YWx1ZSA9IG5vZGVba2V5XSA9IGF0dHJpYnV0ZXNba2V5XTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkZXNjcmlwdG9yc1trZXldICYmIGRlc2NyaXB0b3JzW2tleV0uc2V0KSB7XG4gICAgICAgICAgICBub2RlW2tleV0gPSBhdHRyaWJ1dGVzW2tleV07XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhdHRyKG5vZGUsIGtleSwgYXR0cmlidXRlc1trZXldKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIHNldF9zdmdfYXR0cmlidXRlcyhub2RlLCBhdHRyaWJ1dGVzKSB7XG4gICAgZm9yIChjb25zdCBrZXkgaW4gYXR0cmlidXRlcykge1xuICAgICAgICBhdHRyKG5vZGUsIGtleSwgYXR0cmlidXRlc1trZXldKTtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRfY3VzdG9tX2VsZW1lbnRfZGF0YShub2RlLCBwcm9wLCB2YWx1ZSkge1xuICAgIGlmIChwcm9wIGluIG5vZGUpIHtcbiAgICAgICAgbm9kZVtwcm9wXSA9IHZhbHVlO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgYXR0cihub2RlLCBwcm9wLCB2YWx1ZSk7XG4gICAgfVxufVxuZnVuY3Rpb24geGxpbmtfYXR0cihub2RlLCBhdHRyaWJ1dGUsIHZhbHVlKSB7XG4gICAgbm9kZS5zZXRBdHRyaWJ1dGVOUygnaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluaycsIGF0dHJpYnV0ZSwgdmFsdWUpO1xufVxuZnVuY3Rpb24gZ2V0X2JpbmRpbmdfZ3JvdXBfdmFsdWUoZ3JvdXAsIF9fdmFsdWUsIGNoZWNrZWQpIHtcbiAgICBjb25zdCB2YWx1ZSA9IG5ldyBTZXQoKTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGdyb3VwLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGlmIChncm91cFtpXS5jaGVja2VkKVxuICAgICAgICAgICAgdmFsdWUuYWRkKGdyb3VwW2ldLl9fdmFsdWUpO1xuICAgIH1cbiAgICBpZiAoIWNoZWNrZWQpIHtcbiAgICAgICAgdmFsdWUuZGVsZXRlKF9fdmFsdWUpO1xuICAgIH1cbiAgICByZXR1cm4gQXJyYXkuZnJvbSh2YWx1ZSk7XG59XG5mdW5jdGlvbiB0b19udW1iZXIodmFsdWUpIHtcbiAgICByZXR1cm4gdmFsdWUgPT09ICcnID8gbnVsbCA6ICt2YWx1ZTtcbn1cbmZ1bmN0aW9uIHRpbWVfcmFuZ2VzX3RvX2FycmF5KHJhbmdlcykge1xuICAgIGNvbnN0IGFycmF5ID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYW5nZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgYXJyYXkucHVzaCh7IHN0YXJ0OiByYW5nZXMuc3RhcnQoaSksIGVuZDogcmFuZ2VzLmVuZChpKSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xufVxuZnVuY3Rpb24gY2hpbGRyZW4oZWxlbWVudCkge1xuICAgIHJldHVybiBBcnJheS5mcm9tKGVsZW1lbnQuY2hpbGROb2Rlcyk7XG59XG5mdW5jdGlvbiBjbGFpbV9lbGVtZW50KG5vZGVzLCBuYW1lLCBhdHRyaWJ1dGVzLCBzdmcpIHtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIGNvbnN0IG5vZGUgPSBub2Rlc1tpXTtcbiAgICAgICAgaWYgKG5vZGUubm9kZU5hbWUgPT09IG5hbWUpIHtcbiAgICAgICAgICAgIGxldCBqID0gMDtcbiAgICAgICAgICAgIGNvbnN0IHJlbW92ZSA9IFtdO1xuICAgICAgICAgICAgd2hpbGUgKGogPCBub2RlLmF0dHJpYnV0ZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgYXR0cmlidXRlID0gbm9kZS5hdHRyaWJ1dGVzW2orK107XG4gICAgICAgICAgICAgICAgaWYgKCFhdHRyaWJ1dGVzW2F0dHJpYnV0ZS5uYW1lXSkge1xuICAgICAgICAgICAgICAgICAgICByZW1vdmUucHVzaChhdHRyaWJ1dGUubmFtZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCByZW1vdmUubGVuZ3RoOyBrKyspIHtcbiAgICAgICAgICAgICAgICBub2RlLnJlbW92ZUF0dHJpYnV0ZShyZW1vdmVba10pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG5vZGVzLnNwbGljZShpLCAxKVswXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gc3ZnID8gc3ZnX2VsZW1lbnQobmFtZSkgOiBlbGVtZW50KG5hbWUpO1xufVxuZnVuY3Rpb24gY2xhaW1fdGV4dChub2RlcywgZGF0YSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgICBpZiAobm9kZS5ub2RlVHlwZSA9PT0gMykge1xuICAgICAgICAgICAgbm9kZS5kYXRhID0gJycgKyBkYXRhO1xuICAgICAgICAgICAgcmV0dXJuIG5vZGVzLnNwbGljZShpLCAxKVswXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGV4dChkYXRhKTtcbn1cbmZ1bmN0aW9uIGNsYWltX3NwYWNlKG5vZGVzKSB7XG4gICAgcmV0dXJuIGNsYWltX3RleHQobm9kZXMsICcgJyk7XG59XG5mdW5jdGlvbiBzZXRfZGF0YSh0ZXh0LCBkYXRhKSB7XG4gICAgZGF0YSA9ICcnICsgZGF0YTtcbiAgICBpZiAodGV4dC53aG9sZVRleHQgIT09IGRhdGEpXG4gICAgICAgIHRleHQuZGF0YSA9IGRhdGE7XG59XG5mdW5jdGlvbiBzZXRfaW5wdXRfdmFsdWUoaW5wdXQsIHZhbHVlKSB7XG4gICAgaW5wdXQudmFsdWUgPSB2YWx1ZSA9PSBudWxsID8gJycgOiB2YWx1ZTtcbn1cbmZ1bmN0aW9uIHNldF9pbnB1dF90eXBlKGlucHV0LCB0eXBlKSB7XG4gICAgdHJ5IHtcbiAgICAgICAgaW5wdXQudHlwZSA9IHR5cGU7XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgICAgIC8vIGRvIG5vdGhpbmdcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRfc3R5bGUobm9kZSwga2V5LCB2YWx1ZSwgaW1wb3J0YW50KSB7XG4gICAgbm9kZS5zdHlsZS5zZXRQcm9wZXJ0eShrZXksIHZhbHVlLCBpbXBvcnRhbnQgPyAnaW1wb3J0YW50JyA6ICcnKTtcbn1cbmZ1bmN0aW9uIHNlbGVjdF9vcHRpb24oc2VsZWN0LCB2YWx1ZSkge1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc2VsZWN0Lm9wdGlvbnMubGVuZ3RoOyBpICs9IDEpIHtcbiAgICAgICAgY29uc3Qgb3B0aW9uID0gc2VsZWN0Lm9wdGlvbnNbaV07XG4gICAgICAgIGlmIChvcHRpb24uX192YWx1ZSA9PT0gdmFsdWUpIHtcbiAgICAgICAgICAgIG9wdGlvbi5zZWxlY3RlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICB9XG59XG5mdW5jdGlvbiBzZWxlY3Rfb3B0aW9ucyhzZWxlY3QsIHZhbHVlKSB7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzZWxlY3Qub3B0aW9ucy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICBjb25zdCBvcHRpb24gPSBzZWxlY3Qub3B0aW9uc1tpXTtcbiAgICAgICAgb3B0aW9uLnNlbGVjdGVkID0gfnZhbHVlLmluZGV4T2Yob3B0aW9uLl9fdmFsdWUpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNlbGVjdF92YWx1ZShzZWxlY3QpIHtcbiAgICBjb25zdCBzZWxlY3RlZF9vcHRpb24gPSBzZWxlY3QucXVlcnlTZWxlY3RvcignOmNoZWNrZWQnKSB8fCBzZWxlY3Qub3B0aW9uc1swXTtcbiAgICByZXR1cm4gc2VsZWN0ZWRfb3B0aW9uICYmIHNlbGVjdGVkX29wdGlvbi5fX3ZhbHVlO1xufVxuZnVuY3Rpb24gc2VsZWN0X211bHRpcGxlX3ZhbHVlKHNlbGVjdCkge1xuICAgIHJldHVybiBbXS5tYXAuY2FsbChzZWxlY3QucXVlcnlTZWxlY3RvckFsbCgnOmNoZWNrZWQnKSwgb3B0aW9uID0+IG9wdGlvbi5fX3ZhbHVlKTtcbn1cbi8vIHVuZm9ydHVuYXRlbHkgdGhpcyBjYW4ndCBiZSBhIGNvbnN0YW50IGFzIHRoYXQgd291bGRuJ3QgYmUgdHJlZS1zaGFrZWFibGVcbi8vIHNvIHdlIGNhY2hlIHRoZSByZXN1bHQgaW5zdGVhZFxubGV0IGNyb3Nzb3JpZ2luO1xuZnVuY3Rpb24gaXNfY3Jvc3NvcmlnaW4oKSB7XG4gICAgaWYgKGNyb3Nzb3JpZ2luID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgY3Jvc3NvcmlnaW4gPSBmYWxzZTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cucGFyZW50KSB7XG4gICAgICAgICAgICAgICAgdm9pZCB3aW5kb3cucGFyZW50LmRvY3VtZW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgY3Jvc3NvcmlnaW4gPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBjcm9zc29yaWdpbjtcbn1cbmZ1bmN0aW9uIGFkZF9yZXNpemVfbGlzdGVuZXIobm9kZSwgZm4pIHtcbiAgICBjb25zdCBjb21wdXRlZF9zdHlsZSA9IGdldENvbXB1dGVkU3R5bGUobm9kZSk7XG4gICAgY29uc3Qgel9pbmRleCA9IChwYXJzZUludChjb21wdXRlZF9zdHlsZS56SW5kZXgpIHx8IDApIC0gMTtcbiAgICBpZiAoY29tcHV0ZWRfc3R5bGUucG9zaXRpb24gPT09ICdzdGF0aWMnKSB7XG4gICAgICAgIG5vZGUuc3R5bGUucG9zaXRpb24gPSAncmVsYXRpdmUnO1xuICAgIH1cbiAgICBjb25zdCBpZnJhbWUgPSBlbGVtZW50KCdpZnJhbWUnKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdzdHlsZScsIGBkaXNwbGF5OiBibG9jazsgcG9zaXRpb246IGFic29sdXRlOyB0b3A6IDA7IGxlZnQ6IDA7IHdpZHRoOiAxMDAlOyBoZWlnaHQ6IDEwMCU7IGAgK1xuICAgICAgICBgb3ZlcmZsb3c6IGhpZGRlbjsgYm9yZGVyOiAwOyBvcGFjaXR5OiAwOyBwb2ludGVyLWV2ZW50czogbm9uZTsgei1pbmRleDogJHt6X2luZGV4fTtgKTtcbiAgICBpZnJhbWUuc2V0QXR0cmlidXRlKCdhcmlhLWhpZGRlbicsICd0cnVlJyk7XG4gICAgaWZyYW1lLnRhYkluZGV4ID0gLTE7XG4gICAgY29uc3QgY3Jvc3NvcmlnaW4gPSBpc19jcm9zc29yaWdpbigpO1xuICAgIGxldCB1bnN1YnNjcmliZTtcbiAgICBpZiAoY3Jvc3NvcmlnaW4pIHtcbiAgICAgICAgaWZyYW1lLnNyYyA9IGBkYXRhOnRleHQvaHRtbCw8c2NyaXB0Pm9ucmVzaXplPWZ1bmN0aW9uKCl7cGFyZW50LnBvc3RNZXNzYWdlKDAsJyonKX08L3NjcmlwdD5gO1xuICAgICAgICB1bnN1YnNjcmliZSA9IGxpc3Rlbih3aW5kb3csICdtZXNzYWdlJywgKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICBpZiAoZXZlbnQuc291cmNlID09PSBpZnJhbWUuY29udGVudFdpbmRvdylcbiAgICAgICAgICAgICAgICBmbigpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGlmcmFtZS5zcmMgPSAnYWJvdXQ6YmxhbmsnO1xuICAgICAgICBpZnJhbWUub25sb2FkID0gKCkgPT4ge1xuICAgICAgICAgICAgdW5zdWJzY3JpYmUgPSBsaXN0ZW4oaWZyYW1lLmNvbnRlbnRXaW5kb3csICdyZXNpemUnLCBmbik7XG4gICAgICAgIH07XG4gICAgfVxuICAgIGFwcGVuZChub2RlLCBpZnJhbWUpO1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgIGlmIChjcm9zc29yaWdpbikge1xuICAgICAgICAgICAgdW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh1bnN1YnNjcmliZSAmJiBpZnJhbWUuY29udGVudFdpbmRvdykge1xuICAgICAgICAgICAgdW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBkZXRhY2goaWZyYW1lKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gdG9nZ2xlX2NsYXNzKGVsZW1lbnQsIG5hbWUsIHRvZ2dsZSkge1xuICAgIGVsZW1lbnQuY2xhc3NMaXN0W3RvZ2dsZSA/ICdhZGQnIDogJ3JlbW92ZSddKG5hbWUpO1xufVxuZnVuY3Rpb24gY3VzdG9tX2V2ZW50KHR5cGUsIGRldGFpbCkge1xuICAgIGNvbnN0IGUgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnQ3VzdG9tRXZlbnQnKTtcbiAgICBlLmluaXRDdXN0b21FdmVudCh0eXBlLCBmYWxzZSwgZmFsc2UsIGRldGFpbCk7XG4gICAgcmV0dXJuIGU7XG59XG5mdW5jdGlvbiBxdWVyeV9zZWxlY3Rvcl9hbGwoc2VsZWN0b3IsIHBhcmVudCA9IGRvY3VtZW50LmJvZHkpIHtcbiAgICByZXR1cm4gQXJyYXkuZnJvbShwYXJlbnQucXVlcnlTZWxlY3RvckFsbChzZWxlY3RvcikpO1xufVxuY2xhc3MgSHRtbFRhZyB7XG4gICAgY29uc3RydWN0b3IoYW5jaG9yID0gbnVsbCkge1xuICAgICAgICB0aGlzLmEgPSBhbmNob3I7XG4gICAgICAgIHRoaXMuZSA9IHRoaXMubiA9IG51bGw7XG4gICAgfVxuICAgIG0oaHRtbCwgdGFyZ2V0LCBhbmNob3IgPSBudWxsKSB7XG4gICAgICAgIGlmICghdGhpcy5lKSB7XG4gICAgICAgICAgICB0aGlzLmUgPSBlbGVtZW50KHRhcmdldC5ub2RlTmFtZSk7XG4gICAgICAgICAgICB0aGlzLnQgPSB0YXJnZXQ7XG4gICAgICAgICAgICB0aGlzLmgoaHRtbCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pKGFuY2hvcik7XG4gICAgfVxuICAgIGgoaHRtbCkge1xuICAgICAgICB0aGlzLmUuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgICAgdGhpcy5uID0gQXJyYXkuZnJvbSh0aGlzLmUuY2hpbGROb2Rlcyk7XG4gICAgfVxuICAgIGkoYW5jaG9yKSB7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5uLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBpbnNlcnQodGhpcy50LCB0aGlzLm5baV0sIGFuY2hvcik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcChodG1sKSB7XG4gICAgICAgIHRoaXMuZCgpO1xuICAgICAgICB0aGlzLmgoaHRtbCk7XG4gICAgICAgIHRoaXMuaSh0aGlzLmEpO1xuICAgIH1cbiAgICBkKCkge1xuICAgICAgICB0aGlzLm4uZm9yRWFjaChkZXRhY2gpO1xuICAgIH1cbn1cblxuY29uc3QgYWN0aXZlX2RvY3MgPSBuZXcgU2V0KCk7XG5sZXQgYWN0aXZlID0gMDtcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9kYXJrc2t5YXBwL3N0cmluZy1oYXNoL2Jsb2IvbWFzdGVyL2luZGV4LmpzXG5mdW5jdGlvbiBoYXNoKHN0cikge1xuICAgIGxldCBoYXNoID0gNTM4MTtcbiAgICBsZXQgaSA9IHN0ci5sZW5ndGg7XG4gICAgd2hpbGUgKGktLSlcbiAgICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpIF4gc3RyLmNoYXJDb2RlQXQoaSk7XG4gICAgcmV0dXJuIGhhc2ggPj4+IDA7XG59XG5mdW5jdGlvbiBjcmVhdGVfcnVsZShub2RlLCBhLCBiLCBkdXJhdGlvbiwgZGVsYXksIGVhc2UsIGZuLCB1aWQgPSAwKSB7XG4gICAgY29uc3Qgc3RlcCA9IDE2LjY2NiAvIGR1cmF0aW9uO1xuICAgIGxldCBrZXlmcmFtZXMgPSAne1xcbic7XG4gICAgZm9yIChsZXQgcCA9IDA7IHAgPD0gMTsgcCArPSBzdGVwKSB7XG4gICAgICAgIGNvbnN0IHQgPSBhICsgKGIgLSBhKSAqIGVhc2UocCk7XG4gICAgICAgIGtleWZyYW1lcyArPSBwICogMTAwICsgYCV7JHtmbih0LCAxIC0gdCl9fVxcbmA7XG4gICAgfVxuICAgIGNvbnN0IHJ1bGUgPSBrZXlmcmFtZXMgKyBgMTAwJSB7JHtmbihiLCAxIC0gYil9fVxcbn1gO1xuICAgIGNvbnN0IG5hbWUgPSBgX19zdmVsdGVfJHtoYXNoKHJ1bGUpfV8ke3VpZH1gO1xuICAgIGNvbnN0IGRvYyA9IG5vZGUub3duZXJEb2N1bWVudDtcbiAgICBhY3RpdmVfZG9jcy5hZGQoZG9jKTtcbiAgICBjb25zdCBzdHlsZXNoZWV0ID0gZG9jLl9fc3ZlbHRlX3N0eWxlc2hlZXQgfHwgKGRvYy5fX3N2ZWx0ZV9zdHlsZXNoZWV0ID0gZG9jLmhlYWQuYXBwZW5kQ2hpbGQoZWxlbWVudCgnc3R5bGUnKSkuc2hlZXQpO1xuICAgIGNvbnN0IGN1cnJlbnRfcnVsZXMgPSBkb2MuX19zdmVsdGVfcnVsZXMgfHwgKGRvYy5fX3N2ZWx0ZV9ydWxlcyA9IHt9KTtcbiAgICBpZiAoIWN1cnJlbnRfcnVsZXNbbmFtZV0pIHtcbiAgICAgICAgY3VycmVudF9ydWxlc1tuYW1lXSA9IHRydWU7XG4gICAgICAgIHN0eWxlc2hlZXQuaW5zZXJ0UnVsZShgQGtleWZyYW1lcyAke25hbWV9ICR7cnVsZX1gLCBzdHlsZXNoZWV0LmNzc1J1bGVzLmxlbmd0aCk7XG4gICAgfVxuICAgIGNvbnN0IGFuaW1hdGlvbiA9IG5vZGUuc3R5bGUuYW5pbWF0aW9uIHx8ICcnO1xuICAgIG5vZGUuc3R5bGUuYW5pbWF0aW9uID0gYCR7YW5pbWF0aW9uID8gYCR7YW5pbWF0aW9ufSwgYCA6IGBgfSR7bmFtZX0gJHtkdXJhdGlvbn1tcyBsaW5lYXIgJHtkZWxheX1tcyAxIGJvdGhgO1xuICAgIGFjdGl2ZSArPSAxO1xuICAgIHJldHVybiBuYW1lO1xufVxuZnVuY3Rpb24gZGVsZXRlX3J1bGUobm9kZSwgbmFtZSkge1xuICAgIGNvbnN0IHByZXZpb3VzID0gKG5vZGUuc3R5bGUuYW5pbWF0aW9uIHx8ICcnKS5zcGxpdCgnLCAnKTtcbiAgICBjb25zdCBuZXh0ID0gcHJldmlvdXMuZmlsdGVyKG5hbWVcbiAgICAgICAgPyBhbmltID0+IGFuaW0uaW5kZXhPZihuYW1lKSA8IDAgLy8gcmVtb3ZlIHNwZWNpZmljIGFuaW1hdGlvblxuICAgICAgICA6IGFuaW0gPT4gYW5pbS5pbmRleE9mKCdfX3N2ZWx0ZScpID09PSAtMSAvLyByZW1vdmUgYWxsIFN2ZWx0ZSBhbmltYXRpb25zXG4gICAgKTtcbiAgICBjb25zdCBkZWxldGVkID0gcHJldmlvdXMubGVuZ3RoIC0gbmV4dC5sZW5ndGg7XG4gICAgaWYgKGRlbGV0ZWQpIHtcbiAgICAgICAgbm9kZS5zdHlsZS5hbmltYXRpb24gPSBuZXh0LmpvaW4oJywgJyk7XG4gICAgICAgIGFjdGl2ZSAtPSBkZWxldGVkO1xuICAgICAgICBpZiAoIWFjdGl2ZSlcbiAgICAgICAgICAgIGNsZWFyX3J1bGVzKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gY2xlYXJfcnVsZXMoKSB7XG4gICAgcmFmKCgpID0+IHtcbiAgICAgICAgaWYgKGFjdGl2ZSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgYWN0aXZlX2RvY3MuZm9yRWFjaChkb2MgPT4ge1xuICAgICAgICAgICAgY29uc3Qgc3R5bGVzaGVldCA9IGRvYy5fX3N2ZWx0ZV9zdHlsZXNoZWV0O1xuICAgICAgICAgICAgbGV0IGkgPSBzdHlsZXNoZWV0LmNzc1J1bGVzLmxlbmd0aDtcbiAgICAgICAgICAgIHdoaWxlIChpLS0pXG4gICAgICAgICAgICAgICAgc3R5bGVzaGVldC5kZWxldGVSdWxlKGkpO1xuICAgICAgICAgICAgZG9jLl9fc3ZlbHRlX3J1bGVzID0ge307XG4gICAgICAgIH0pO1xuICAgICAgICBhY3RpdmVfZG9jcy5jbGVhcigpO1xuICAgIH0pO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVfYW5pbWF0aW9uKG5vZGUsIGZyb20sIGZuLCBwYXJhbXMpIHtcbiAgICBpZiAoIWZyb20pXG4gICAgICAgIHJldHVybiBub29wO1xuICAgIGNvbnN0IHRvID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICBpZiAoZnJvbS5sZWZ0ID09PSB0by5sZWZ0ICYmIGZyb20ucmlnaHQgPT09IHRvLnJpZ2h0ICYmIGZyb20udG9wID09PSB0by50b3AgJiYgZnJvbS5ib3R0b20gPT09IHRvLmJvdHRvbSlcbiAgICAgICAgcmV0dXJuIG5vb3A7XG4gICAgY29uc3QgeyBkZWxheSA9IDAsIGR1cmF0aW9uID0gMzAwLCBlYXNpbmcgPSBpZGVudGl0eSwgXG4gICAgLy8gQHRzLWlnbm9yZSB0b2RvOiBzaG91bGQgdGhpcyBiZSBzZXBhcmF0ZWQgZnJvbSBkZXN0cnVjdHVyaW5nPyBPciBzdGFydC9lbmQgYWRkZWQgdG8gcHVibGljIGFwaSBhbmQgZG9jdW1lbnRhdGlvbj9cbiAgICBzdGFydDogc3RhcnRfdGltZSA9IG5vdygpICsgZGVsYXksIFxuICAgIC8vIEB0cy1pZ25vcmUgdG9kbzpcbiAgICBlbmQgPSBzdGFydF90aW1lICsgZHVyYXRpb24sIHRpY2sgPSBub29wLCBjc3MgfSA9IGZuKG5vZGUsIHsgZnJvbSwgdG8gfSwgcGFyYW1zKTtcbiAgICBsZXQgcnVubmluZyA9IHRydWU7XG4gICAgbGV0IHN0YXJ0ZWQgPSBmYWxzZTtcbiAgICBsZXQgbmFtZTtcbiAgICBmdW5jdGlvbiBzdGFydCgpIHtcbiAgICAgICAgaWYgKGNzcykge1xuICAgICAgICAgICAgbmFtZSA9IGNyZWF0ZV9ydWxlKG5vZGUsIDAsIDEsIGR1cmF0aW9uLCBkZWxheSwgZWFzaW5nLCBjc3MpO1xuICAgICAgICB9XG4gICAgICAgIGlmICghZGVsYXkpIHtcbiAgICAgICAgICAgIHN0YXJ0ZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICAgIGlmIChjc3MpXG4gICAgICAgICAgICBkZWxldGVfcnVsZShub2RlLCBuYW1lKTtcbiAgICAgICAgcnVubmluZyA9IGZhbHNlO1xuICAgIH1cbiAgICBsb29wKG5vdyA9PiB7XG4gICAgICAgIGlmICghc3RhcnRlZCAmJiBub3cgPj0gc3RhcnRfdGltZSkge1xuICAgICAgICAgICAgc3RhcnRlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHN0YXJ0ZWQgJiYgbm93ID49IGVuZCkge1xuICAgICAgICAgICAgdGljaygxLCAwKTtcbiAgICAgICAgICAgIHN0b3AoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJ1bm5pbmcpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhcnRlZCkge1xuICAgICAgICAgICAgY29uc3QgcCA9IG5vdyAtIHN0YXJ0X3RpbWU7XG4gICAgICAgICAgICBjb25zdCB0ID0gMCArIDEgKiBlYXNpbmcocCAvIGR1cmF0aW9uKTtcbiAgICAgICAgICAgIHRpY2sodCwgMSAtIHQpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICAgIHN0YXJ0KCk7XG4gICAgdGljaygwLCAxKTtcbiAgICByZXR1cm4gc3RvcDtcbn1cbmZ1bmN0aW9uIGZpeF9wb3NpdGlvbihub2RlKSB7XG4gICAgY29uc3Qgc3R5bGUgPSBnZXRDb21wdXRlZFN0eWxlKG5vZGUpO1xuICAgIGlmIChzdHlsZS5wb3NpdGlvbiAhPT0gJ2Fic29sdXRlJyAmJiBzdHlsZS5wb3NpdGlvbiAhPT0gJ2ZpeGVkJykge1xuICAgICAgICBjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHN0eWxlO1xuICAgICAgICBjb25zdCBhID0gbm9kZS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICAgICAgbm9kZS5zdHlsZS5wb3NpdGlvbiA9ICdhYnNvbHV0ZSc7XG4gICAgICAgIG5vZGUuc3R5bGUud2lkdGggPSB3aWR0aDtcbiAgICAgICAgbm9kZS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIGFkZF90cmFuc2Zvcm0obm9kZSwgYSk7XG4gICAgfVxufVxuZnVuY3Rpb24gYWRkX3RyYW5zZm9ybShub2RlLCBhKSB7XG4gICAgY29uc3QgYiA9IG5vZGUuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7XG4gICAgaWYgKGEubGVmdCAhPT0gYi5sZWZ0IHx8IGEudG9wICE9PSBiLnRvcCkge1xuICAgICAgICBjb25zdCBzdHlsZSA9IGdldENvbXB1dGVkU3R5bGUobm9kZSk7XG4gICAgICAgIGNvbnN0IHRyYW5zZm9ybSA9IHN0eWxlLnRyYW5zZm9ybSA9PT0gJ25vbmUnID8gJycgOiBzdHlsZS50cmFuc2Zvcm07XG4gICAgICAgIG5vZGUuc3R5bGUudHJhbnNmb3JtID0gYCR7dHJhbnNmb3JtfSB0cmFuc2xhdGUoJHthLmxlZnQgLSBiLmxlZnR9cHgsICR7YS50b3AgLSBiLnRvcH1weClgO1xuICAgIH1cbn1cblxubGV0IGN1cnJlbnRfY29tcG9uZW50O1xuZnVuY3Rpb24gc2V0X2N1cnJlbnRfY29tcG9uZW50KGNvbXBvbmVudCkge1xuICAgIGN1cnJlbnRfY29tcG9uZW50ID0gY29tcG9uZW50O1xufVxuZnVuY3Rpb24gZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkge1xuICAgIGlmICghY3VycmVudF9jb21wb25lbnQpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRnVuY3Rpb24gY2FsbGVkIG91dHNpZGUgY29tcG9uZW50IGluaXRpYWxpemF0aW9uYCk7XG4gICAgcmV0dXJuIGN1cnJlbnRfY29tcG9uZW50O1xufVxuZnVuY3Rpb24gYmVmb3JlVXBkYXRlKGZuKSB7XG4gICAgZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkuJCQuYmVmb3JlX3VwZGF0ZS5wdXNoKGZuKTtcbn1cbmZ1bmN0aW9uIG9uTW91bnQoZm4pIHtcbiAgICBnZXRfY3VycmVudF9jb21wb25lbnQoKS4kJC5vbl9tb3VudC5wdXNoKGZuKTtcbn1cbmZ1bmN0aW9uIGFmdGVyVXBkYXRlKGZuKSB7XG4gICAgZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkuJCQuYWZ0ZXJfdXBkYXRlLnB1c2goZm4pO1xufVxuZnVuY3Rpb24gb25EZXN0cm95KGZuKSB7XG4gICAgZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkuJCQub25fZGVzdHJveS5wdXNoKGZuKTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZUV2ZW50RGlzcGF0Y2hlcigpIHtcbiAgICBjb25zdCBjb21wb25lbnQgPSBnZXRfY3VycmVudF9jb21wb25lbnQoKTtcbiAgICByZXR1cm4gKHR5cGUsIGRldGFpbCkgPT4ge1xuICAgICAgICBjb25zdCBjYWxsYmFja3MgPSBjb21wb25lbnQuJCQuY2FsbGJhY2tzW3R5cGVdO1xuICAgICAgICBpZiAoY2FsbGJhY2tzKSB7XG4gICAgICAgICAgICAvLyBUT0RPIGFyZSB0aGVyZSBzaXR1YXRpb25zIHdoZXJlIGV2ZW50cyBjb3VsZCBiZSBkaXNwYXRjaGVkXG4gICAgICAgICAgICAvLyBpbiBhIHNlcnZlciAobm9uLURPTSkgZW52aXJvbm1lbnQ/XG4gICAgICAgICAgICBjb25zdCBldmVudCA9IGN1c3RvbV9ldmVudCh0eXBlLCBkZXRhaWwpO1xuICAgICAgICAgICAgY2FsbGJhY2tzLnNsaWNlKCkuZm9yRWFjaChmbiA9PiB7XG4gICAgICAgICAgICAgICAgZm4uY2FsbChjb21wb25lbnQsIGV2ZW50KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIHNldENvbnRleHQoa2V5LCBjb250ZXh0KSB7XG4gICAgZ2V0X2N1cnJlbnRfY29tcG9uZW50KCkuJCQuY29udGV4dC5zZXQoa2V5LCBjb250ZXh0KTtcbn1cbmZ1bmN0aW9uIGdldENvbnRleHQoa2V5KSB7XG4gICAgcmV0dXJuIGdldF9jdXJyZW50X2NvbXBvbmVudCgpLiQkLmNvbnRleHQuZ2V0KGtleSk7XG59XG4vLyBUT0RPIGZpZ3VyZSBvdXQgaWYgd2Ugc3RpbGwgd2FudCB0byBzdXBwb3J0XG4vLyBzaG9ydGhhbmQgZXZlbnRzLCBvciBpZiB3ZSB3YW50IHRvIGltcGxlbWVudFxuLy8gYSByZWFsIGJ1YmJsaW5nIG1lY2hhbmlzbVxuZnVuY3Rpb24gYnViYmxlKGNvbXBvbmVudCwgZXZlbnQpIHtcbiAgICBjb25zdCBjYWxsYmFja3MgPSBjb21wb25lbnQuJCQuY2FsbGJhY2tzW2V2ZW50LnR5cGVdO1xuICAgIGlmIChjYWxsYmFja3MpIHtcbiAgICAgICAgY2FsbGJhY2tzLnNsaWNlKCkuZm9yRWFjaChmbiA9PiBmbihldmVudCkpO1xuICAgIH1cbn1cblxuY29uc3QgZGlydHlfY29tcG9uZW50cyA9IFtdO1xuY29uc3QgaW50cm9zID0geyBlbmFibGVkOiBmYWxzZSB9O1xuY29uc3QgYmluZGluZ19jYWxsYmFja3MgPSBbXTtcbmNvbnN0IHJlbmRlcl9jYWxsYmFja3MgPSBbXTtcbmNvbnN0IGZsdXNoX2NhbGxiYWNrcyA9IFtdO1xuY29uc3QgcmVzb2x2ZWRfcHJvbWlzZSA9IFByb21pc2UucmVzb2x2ZSgpO1xubGV0IHVwZGF0ZV9zY2hlZHVsZWQgPSBmYWxzZTtcbmZ1bmN0aW9uIHNjaGVkdWxlX3VwZGF0ZSgpIHtcbiAgICBpZiAoIXVwZGF0ZV9zY2hlZHVsZWQpIHtcbiAgICAgICAgdXBkYXRlX3NjaGVkdWxlZCA9IHRydWU7XG4gICAgICAgIHJlc29sdmVkX3Byb21pc2UudGhlbihmbHVzaCk7XG4gICAgfVxufVxuZnVuY3Rpb24gdGljaygpIHtcbiAgICBzY2hlZHVsZV91cGRhdGUoKTtcbiAgICByZXR1cm4gcmVzb2x2ZWRfcHJvbWlzZTtcbn1cbmZ1bmN0aW9uIGFkZF9yZW5kZXJfY2FsbGJhY2soZm4pIHtcbiAgICByZW5kZXJfY2FsbGJhY2tzLnB1c2goZm4pO1xufVxuZnVuY3Rpb24gYWRkX2ZsdXNoX2NhbGxiYWNrKGZuKSB7XG4gICAgZmx1c2hfY2FsbGJhY2tzLnB1c2goZm4pO1xufVxubGV0IGZsdXNoaW5nID0gZmFsc2U7XG5jb25zdCBzZWVuX2NhbGxiYWNrcyA9IG5ldyBTZXQoKTtcbmZ1bmN0aW9uIGZsdXNoKCkge1xuICAgIGlmIChmbHVzaGluZylcbiAgICAgICAgcmV0dXJuO1xuICAgIGZsdXNoaW5nID0gdHJ1ZTtcbiAgICBkbyB7XG4gICAgICAgIC8vIGZpcnN0LCBjYWxsIGJlZm9yZVVwZGF0ZSBmdW5jdGlvbnNcbiAgICAgICAgLy8gYW5kIHVwZGF0ZSBjb21wb25lbnRzXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgZGlydHlfY29tcG9uZW50cy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgY29uc3QgY29tcG9uZW50ID0gZGlydHlfY29tcG9uZW50c1tpXTtcbiAgICAgICAgICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpO1xuICAgICAgICAgICAgdXBkYXRlKGNvbXBvbmVudC4kJCk7XG4gICAgICAgIH1cbiAgICAgICAgc2V0X2N1cnJlbnRfY29tcG9uZW50KG51bGwpO1xuICAgICAgICBkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCA9IDA7XG4gICAgICAgIHdoaWxlIChiaW5kaW5nX2NhbGxiYWNrcy5sZW5ndGgpXG4gICAgICAgICAgICBiaW5kaW5nX2NhbGxiYWNrcy5wb3AoKSgpO1xuICAgICAgICAvLyB0aGVuLCBvbmNlIGNvbXBvbmVudHMgYXJlIHVwZGF0ZWQsIGNhbGxcbiAgICAgICAgLy8gYWZ0ZXJVcGRhdGUgZnVuY3Rpb25zLiBUaGlzIG1heSBjYXVzZVxuICAgICAgICAvLyBzdWJzZXF1ZW50IHVwZGF0ZXMuLi5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZW5kZXJfY2FsbGJhY2tzLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgICAgICBjb25zdCBjYWxsYmFjayA9IHJlbmRlcl9jYWxsYmFja3NbaV07XG4gICAgICAgICAgICBpZiAoIXNlZW5fY2FsbGJhY2tzLmhhcyhjYWxsYmFjaykpIHtcbiAgICAgICAgICAgICAgICAvLyAuLi5zbyBndWFyZCBhZ2FpbnN0IGluZmluaXRlIGxvb3BzXG4gICAgICAgICAgICAgICAgc2Vlbl9jYWxsYmFja3MuYWRkKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICBjYWxsYmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJlbmRlcl9jYWxsYmFja3MubGVuZ3RoID0gMDtcbiAgICB9IHdoaWxlIChkaXJ0eV9jb21wb25lbnRzLmxlbmd0aCk7XG4gICAgd2hpbGUgKGZsdXNoX2NhbGxiYWNrcy5sZW5ndGgpIHtcbiAgICAgICAgZmx1c2hfY2FsbGJhY2tzLnBvcCgpKCk7XG4gICAgfVxuICAgIHVwZGF0ZV9zY2hlZHVsZWQgPSBmYWxzZTtcbiAgICBmbHVzaGluZyA9IGZhbHNlO1xuICAgIHNlZW5fY2FsbGJhY2tzLmNsZWFyKCk7XG59XG5mdW5jdGlvbiB1cGRhdGUoJCQpIHtcbiAgICBpZiAoJCQuZnJhZ21lbnQgIT09IG51bGwpIHtcbiAgICAgICAgJCQudXBkYXRlKCk7XG4gICAgICAgIHJ1bl9hbGwoJCQuYmVmb3JlX3VwZGF0ZSk7XG4gICAgICAgIGNvbnN0IGRpcnR5ID0gJCQuZGlydHk7XG4gICAgICAgICQkLmRpcnR5ID0gWy0xXTtcbiAgICAgICAgJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQucCgkJC5jdHgsIGRpcnR5KTtcbiAgICAgICAgJCQuYWZ0ZXJfdXBkYXRlLmZvckVhY2goYWRkX3JlbmRlcl9jYWxsYmFjayk7XG4gICAgfVxufVxuXG5sZXQgcHJvbWlzZTtcbmZ1bmN0aW9uIHdhaXQoKSB7XG4gICAgaWYgKCFwcm9taXNlKSB7XG4gICAgICAgIHByb21pc2UgPSBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgICAgcHJvbWlzZS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIHByb21pc2UgPSBudWxsO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHByb21pc2U7XG59XG5mdW5jdGlvbiBkaXNwYXRjaChub2RlLCBkaXJlY3Rpb24sIGtpbmQpIHtcbiAgICBub2RlLmRpc3BhdGNoRXZlbnQoY3VzdG9tX2V2ZW50KGAke2RpcmVjdGlvbiA/ICdpbnRybycgOiAnb3V0cm8nfSR7a2luZH1gKSk7XG59XG5jb25zdCBvdXRyb2luZyA9IG5ldyBTZXQoKTtcbmxldCBvdXRyb3M7XG5mdW5jdGlvbiBncm91cF9vdXRyb3MoKSB7XG4gICAgb3V0cm9zID0ge1xuICAgICAgICByOiAwLFxuICAgICAgICBjOiBbXSxcbiAgICAgICAgcDogb3V0cm9zIC8vIHBhcmVudCBncm91cFxuICAgIH07XG59XG5mdW5jdGlvbiBjaGVja19vdXRyb3MoKSB7XG4gICAgaWYgKCFvdXRyb3Mucikge1xuICAgICAgICBydW5fYWxsKG91dHJvcy5jKTtcbiAgICB9XG4gICAgb3V0cm9zID0gb3V0cm9zLnA7XG59XG5mdW5jdGlvbiB0cmFuc2l0aW9uX2luKGJsb2NrLCBsb2NhbCkge1xuICAgIGlmIChibG9jayAmJiBibG9jay5pKSB7XG4gICAgICAgIG91dHJvaW5nLmRlbGV0ZShibG9jayk7XG4gICAgICAgIGJsb2NrLmkobG9jYWwpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHRyYW5zaXRpb25fb3V0KGJsb2NrLCBsb2NhbCwgZGV0YWNoLCBjYWxsYmFjaykge1xuICAgIGlmIChibG9jayAmJiBibG9jay5vKSB7XG4gICAgICAgIGlmIChvdXRyb2luZy5oYXMoYmxvY2spKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBvdXRyb2luZy5hZGQoYmxvY2spO1xuICAgICAgICBvdXRyb3MuYy5wdXNoKCgpID0+IHtcbiAgICAgICAgICAgIG91dHJvaW5nLmRlbGV0ZShibG9jayk7XG4gICAgICAgICAgICBpZiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICBpZiAoZGV0YWNoKVxuICAgICAgICAgICAgICAgICAgICBibG9jay5kKDEpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBibG9jay5vKGxvY2FsKTtcbiAgICB9XG59XG5jb25zdCBudWxsX3RyYW5zaXRpb24gPSB7IGR1cmF0aW9uOiAwIH07XG5mdW5jdGlvbiBjcmVhdGVfaW5fdHJhbnNpdGlvbihub2RlLCBmbiwgcGFyYW1zKSB7XG4gICAgbGV0IGNvbmZpZyA9IGZuKG5vZGUsIHBhcmFtcyk7XG4gICAgbGV0IHJ1bm5pbmcgPSBmYWxzZTtcbiAgICBsZXQgYW5pbWF0aW9uX25hbWU7XG4gICAgbGV0IHRhc2s7XG4gICAgbGV0IHVpZCA9IDA7XG4gICAgZnVuY3Rpb24gY2xlYW51cCgpIHtcbiAgICAgICAgaWYgKGFuaW1hdGlvbl9uYW1lKVxuICAgICAgICAgICAgZGVsZXRlX3J1bGUobm9kZSwgYW5pbWF0aW9uX25hbWUpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBnbygpIHtcbiAgICAgICAgY29uc3QgeyBkZWxheSA9IDAsIGR1cmF0aW9uID0gMzAwLCBlYXNpbmcgPSBpZGVudGl0eSwgdGljayA9IG5vb3AsIGNzcyB9ID0gY29uZmlnIHx8IG51bGxfdHJhbnNpdGlvbjtcbiAgICAgICAgaWYgKGNzcylcbiAgICAgICAgICAgIGFuaW1hdGlvbl9uYW1lID0gY3JlYXRlX3J1bGUobm9kZSwgMCwgMSwgZHVyYXRpb24sIGRlbGF5LCBlYXNpbmcsIGNzcywgdWlkKyspO1xuICAgICAgICB0aWNrKDAsIDEpO1xuICAgICAgICBjb25zdCBzdGFydF90aW1lID0gbm93KCkgKyBkZWxheTtcbiAgICAgICAgY29uc3QgZW5kX3RpbWUgPSBzdGFydF90aW1lICsgZHVyYXRpb247XG4gICAgICAgIGlmICh0YXNrKVxuICAgICAgICAgICAgdGFzay5hYm9ydCgpO1xuICAgICAgICBydW5uaW5nID0gdHJ1ZTtcbiAgICAgICAgYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiBkaXNwYXRjaChub2RlLCB0cnVlLCAnc3RhcnQnKSk7XG4gICAgICAgIHRhc2sgPSBsb29wKG5vdyA9PiB7XG4gICAgICAgICAgICBpZiAocnVubmluZykge1xuICAgICAgICAgICAgICAgIGlmIChub3cgPj0gZW5kX3RpbWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGljaygxLCAwKTtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2gobm9kZSwgdHJ1ZSwgJ2VuZCcpO1xuICAgICAgICAgICAgICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBydW5uaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub3cgPj0gc3RhcnRfdGltZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gZWFzaW5nKChub3cgLSBzdGFydF90aW1lKSAvIGR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdGljayh0LCAxIC0gdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJ1bm5pbmc7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBsZXQgc3RhcnRlZCA9IGZhbHNlO1xuICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0KCkge1xuICAgICAgICAgICAgaWYgKHN0YXJ0ZWQpXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgZGVsZXRlX3J1bGUobm9kZSk7XG4gICAgICAgICAgICBpZiAoaXNfZnVuY3Rpb24oY29uZmlnKSkge1xuICAgICAgICAgICAgICAgIGNvbmZpZyA9IGNvbmZpZygpO1xuICAgICAgICAgICAgICAgIHdhaXQoKS50aGVuKGdvKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGdvKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGludmFsaWRhdGUoKSB7XG4gICAgICAgICAgICBzdGFydGVkID0gZmFsc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGVuZCgpIHtcbiAgICAgICAgICAgIGlmIChydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICAgICAgICAgIHJ1bm5pbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XG5mdW5jdGlvbiBjcmVhdGVfb3V0X3RyYW5zaXRpb24obm9kZSwgZm4sIHBhcmFtcykge1xuICAgIGxldCBjb25maWcgPSBmbihub2RlLCBwYXJhbXMpO1xuICAgIGxldCBydW5uaW5nID0gdHJ1ZTtcbiAgICBsZXQgYW5pbWF0aW9uX25hbWU7XG4gICAgY29uc3QgZ3JvdXAgPSBvdXRyb3M7XG4gICAgZ3JvdXAuciArPSAxO1xuICAgIGZ1bmN0aW9uIGdvKCkge1xuICAgICAgICBjb25zdCB7IGRlbGF5ID0gMCwgZHVyYXRpb24gPSAzMDAsIGVhc2luZyA9IGlkZW50aXR5LCB0aWNrID0gbm9vcCwgY3NzIH0gPSBjb25maWcgfHwgbnVsbF90cmFuc2l0aW9uO1xuICAgICAgICBpZiAoY3NzKVxuICAgICAgICAgICAgYW5pbWF0aW9uX25hbWUgPSBjcmVhdGVfcnVsZShub2RlLCAxLCAwLCBkdXJhdGlvbiwgZGVsYXksIGVhc2luZywgY3NzKTtcbiAgICAgICAgY29uc3Qgc3RhcnRfdGltZSA9IG5vdygpICsgZGVsYXk7XG4gICAgICAgIGNvbnN0IGVuZF90aW1lID0gc3RhcnRfdGltZSArIGR1cmF0aW9uO1xuICAgICAgICBhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IGRpc3BhdGNoKG5vZGUsIGZhbHNlLCAnc3RhcnQnKSk7XG4gICAgICAgIGxvb3Aobm93ID0+IHtcbiAgICAgICAgICAgIGlmIChydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKG5vdyA+PSBlbmRfdGltZSkge1xuICAgICAgICAgICAgICAgICAgICB0aWNrKDAsIDEpO1xuICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaChub2RlLCBmYWxzZSwgJ2VuZCcpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoIS0tZ3JvdXAucikge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gdGhpcyB3aWxsIHJlc3VsdCBpbiBgZW5kKClgIGJlaW5nIGNhbGxlZCxcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNvIHdlIGRvbid0IG5lZWQgdG8gY2xlYW4gdXAgaGVyZVxuICAgICAgICAgICAgICAgICAgICAgICAgcnVuX2FsbChncm91cC5jKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChub3cgPj0gc3RhcnRfdGltZSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB0ID0gZWFzaW5nKChub3cgLSBzdGFydF90aW1lKSAvIGR1cmF0aW9uKTtcbiAgICAgICAgICAgICAgICAgICAgdGljaygxIC0gdCwgdCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHJ1bm5pbmc7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpZiAoaXNfZnVuY3Rpb24oY29uZmlnKSkge1xuICAgICAgICB3YWl0KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICBjb25maWcgPSBjb25maWcoKTtcbiAgICAgICAgICAgIGdvKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZ28oKTtcbiAgICB9XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZW5kKHJlc2V0KSB7XG4gICAgICAgICAgICBpZiAocmVzZXQgJiYgY29uZmlnLnRpY2spIHtcbiAgICAgICAgICAgICAgICBjb25maWcudGljaygxLCAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChydW5uaW5nKSB7XG4gICAgICAgICAgICAgICAgaWYgKGFuaW1hdGlvbl9uYW1lKVxuICAgICAgICAgICAgICAgICAgICBkZWxldGVfcnVsZShub2RlLCBhbmltYXRpb25fbmFtZSk7XG4gICAgICAgICAgICAgICAgcnVubmluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbn1cbmZ1bmN0aW9uIGNyZWF0ZV9iaWRpcmVjdGlvbmFsX3RyYW5zaXRpb24obm9kZSwgZm4sIHBhcmFtcywgaW50cm8pIHtcbiAgICBsZXQgY29uZmlnID0gZm4obm9kZSwgcGFyYW1zKTtcbiAgICBsZXQgdCA9IGludHJvID8gMCA6IDE7XG4gICAgbGV0IHJ1bm5pbmdfcHJvZ3JhbSA9IG51bGw7XG4gICAgbGV0IHBlbmRpbmdfcHJvZ3JhbSA9IG51bGw7XG4gICAgbGV0IGFuaW1hdGlvbl9uYW1lID0gbnVsbDtcbiAgICBmdW5jdGlvbiBjbGVhcl9hbmltYXRpb24oKSB7XG4gICAgICAgIGlmIChhbmltYXRpb25fbmFtZSlcbiAgICAgICAgICAgIGRlbGV0ZV9ydWxlKG5vZGUsIGFuaW1hdGlvbl9uYW1lKTtcbiAgICB9XG4gICAgZnVuY3Rpb24gaW5pdChwcm9ncmFtLCBkdXJhdGlvbikge1xuICAgICAgICBjb25zdCBkID0gcHJvZ3JhbS5iIC0gdDtcbiAgICAgICAgZHVyYXRpb24gKj0gTWF0aC5hYnMoZCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBhOiB0LFxuICAgICAgICAgICAgYjogcHJvZ3JhbS5iLFxuICAgICAgICAgICAgZCxcbiAgICAgICAgICAgIGR1cmF0aW9uLFxuICAgICAgICAgICAgc3RhcnQ6IHByb2dyYW0uc3RhcnQsXG4gICAgICAgICAgICBlbmQ6IHByb2dyYW0uc3RhcnQgKyBkdXJhdGlvbixcbiAgICAgICAgICAgIGdyb3VwOiBwcm9ncmFtLmdyb3VwXG4gICAgICAgIH07XG4gICAgfVxuICAgIGZ1bmN0aW9uIGdvKGIpIHtcbiAgICAgICAgY29uc3QgeyBkZWxheSA9IDAsIGR1cmF0aW9uID0gMzAwLCBlYXNpbmcgPSBpZGVudGl0eSwgdGljayA9IG5vb3AsIGNzcyB9ID0gY29uZmlnIHx8IG51bGxfdHJhbnNpdGlvbjtcbiAgICAgICAgY29uc3QgcHJvZ3JhbSA9IHtcbiAgICAgICAgICAgIHN0YXJ0OiBub3coKSArIGRlbGF5LFxuICAgICAgICAgICAgYlxuICAgICAgICB9O1xuICAgICAgICBpZiAoIWIpIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmUgdG9kbzogaW1wcm92ZSB0eXBpbmdzXG4gICAgICAgICAgICBwcm9ncmFtLmdyb3VwID0gb3V0cm9zO1xuICAgICAgICAgICAgb3V0cm9zLnIgKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocnVubmluZ19wcm9ncmFtIHx8IHBlbmRpbmdfcHJvZ3JhbSkge1xuICAgICAgICAgICAgcGVuZGluZ19wcm9ncmFtID0gcHJvZ3JhbTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGlmIHRoaXMgaXMgYW4gaW50cm8sIGFuZCB0aGVyZSdzIGEgZGVsYXksIHdlIG5lZWQgdG8gZG9cbiAgICAgICAgICAgIC8vIGFuIGluaXRpYWwgdGljayBhbmQvb3IgYXBwbHkgQ1NTIGFuaW1hdGlvbiBpbW1lZGlhdGVseVxuICAgICAgICAgICAgaWYgKGNzcykge1xuICAgICAgICAgICAgICAgIGNsZWFyX2FuaW1hdGlvbigpO1xuICAgICAgICAgICAgICAgIGFuaW1hdGlvbl9uYW1lID0gY3JlYXRlX3J1bGUobm9kZSwgdCwgYiwgZHVyYXRpb24sIGRlbGF5LCBlYXNpbmcsIGNzcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoYilcbiAgICAgICAgICAgICAgICB0aWNrKDAsIDEpO1xuICAgICAgICAgICAgcnVubmluZ19wcm9ncmFtID0gaW5pdChwcm9ncmFtLCBkdXJhdGlvbik7XG4gICAgICAgICAgICBhZGRfcmVuZGVyX2NhbGxiYWNrKCgpID0+IGRpc3BhdGNoKG5vZGUsIGIsICdzdGFydCcpKTtcbiAgICAgICAgICAgIGxvb3Aobm93ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAocGVuZGluZ19wcm9ncmFtICYmIG5vdyA+IHBlbmRpbmdfcHJvZ3JhbS5zdGFydCkge1xuICAgICAgICAgICAgICAgICAgICBydW5uaW5nX3Byb2dyYW0gPSBpbml0KHBlbmRpbmdfcHJvZ3JhbSwgZHVyYXRpb24pO1xuICAgICAgICAgICAgICAgICAgICBwZW5kaW5nX3Byb2dyYW0gPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICBkaXNwYXRjaChub2RlLCBydW5uaW5nX3Byb2dyYW0uYiwgJ3N0YXJ0Jyk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyX2FuaW1hdGlvbigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uX25hbWUgPSBjcmVhdGVfcnVsZShub2RlLCB0LCBydW5uaW5nX3Byb2dyYW0uYiwgcnVubmluZ19wcm9ncmFtLmR1cmF0aW9uLCAwLCBlYXNpbmcsIGNvbmZpZy5jc3MpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChydW5uaW5nX3Byb2dyYW0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG5vdyA+PSBydW5uaW5nX3Byb2dyYW0uZW5kKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWNrKHQgPSBydW5uaW5nX3Byb2dyYW0uYiwgMSAtIHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2gobm9kZSwgcnVubmluZ19wcm9ncmFtLmIsICdlbmQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcGVuZGluZ19wcm9ncmFtKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gd2UncmUgZG9uZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChydW5uaW5nX3Byb2dyYW0uYikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnRybyDigJQgd2UgY2FuIHRpZHkgdXAgaW1tZWRpYXRlbHlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJfYW5pbWF0aW9uKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBvdXRybyDigJQgbmVlZHMgdG8gYmUgY29vcmRpbmF0ZWRcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCEtLXJ1bm5pbmdfcHJvZ3JhbS5ncm91cC5yKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVuX2FsbChydW5uaW5nX3Byb2dyYW0uZ3JvdXAuYyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcnVubmluZ19wcm9ncmFtID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmIChub3cgPj0gcnVubmluZ19wcm9ncmFtLnN0YXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwID0gbm93IC0gcnVubmluZ19wcm9ncmFtLnN0YXJ0O1xuICAgICAgICAgICAgICAgICAgICAgICAgdCA9IHJ1bm5pbmdfcHJvZ3JhbS5hICsgcnVubmluZ19wcm9ncmFtLmQgKiBlYXNpbmcocCAvIHJ1bm5pbmdfcHJvZ3JhbS5kdXJhdGlvbik7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aWNrKHQsIDEgLSB0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gISEocnVubmluZ19wcm9ncmFtIHx8IHBlbmRpbmdfcHJvZ3JhbSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICBydW4oYikge1xuICAgICAgICAgICAgaWYgKGlzX2Z1bmN0aW9uKGNvbmZpZykpIHtcbiAgICAgICAgICAgICAgICB3YWl0KCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0gY29uZmlnKCk7XG4gICAgICAgICAgICAgICAgICAgIGdvKGIpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgZ28oYik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGVuZCgpIHtcbiAgICAgICAgICAgIGNsZWFyX2FuaW1hdGlvbigpO1xuICAgICAgICAgICAgcnVubmluZ19wcm9ncmFtID0gcGVuZGluZ19wcm9ncmFtID0gbnVsbDtcbiAgICAgICAgfVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGhhbmRsZV9wcm9taXNlKHByb21pc2UsIGluZm8pIHtcbiAgICBjb25zdCB0b2tlbiA9IGluZm8udG9rZW4gPSB7fTtcbiAgICBmdW5jdGlvbiB1cGRhdGUodHlwZSwgaW5kZXgsIGtleSwgdmFsdWUpIHtcbiAgICAgICAgaWYgKGluZm8udG9rZW4gIT09IHRva2VuKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBpbmZvLnJlc29sdmVkID0gdmFsdWU7XG4gICAgICAgIGxldCBjaGlsZF9jdHggPSBpbmZvLmN0eDtcbiAgICAgICAgaWYgKGtleSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICBjaGlsZF9jdHggPSBjaGlsZF9jdHguc2xpY2UoKTtcbiAgICAgICAgICAgIGNoaWxkX2N0eFtrZXldID0gdmFsdWU7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgYmxvY2sgPSB0eXBlICYmIChpbmZvLmN1cnJlbnQgPSB0eXBlKShjaGlsZF9jdHgpO1xuICAgICAgICBsZXQgbmVlZHNfZmx1c2ggPSBmYWxzZTtcbiAgICAgICAgaWYgKGluZm8uYmxvY2spIHtcbiAgICAgICAgICAgIGlmIChpbmZvLmJsb2Nrcykge1xuICAgICAgICAgICAgICAgIGluZm8uYmxvY2tzLmZvckVhY2goKGJsb2NrLCBpKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpICE9PSBpbmRleCAmJiBibG9jaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBfb3V0cm9zKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uX291dChibG9jaywgMSwgMSwgKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZm8uYmxvY2tzW2ldID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfb3V0cm9zKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGluZm8uYmxvY2suZCgxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJsb2NrLmMoKTtcbiAgICAgICAgICAgIHRyYW5zaXRpb25faW4oYmxvY2ssIDEpO1xuICAgICAgICAgICAgYmxvY2subShpbmZvLm1vdW50KCksIGluZm8uYW5jaG9yKTtcbiAgICAgICAgICAgIG5lZWRzX2ZsdXNoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBpbmZvLmJsb2NrID0gYmxvY2s7XG4gICAgICAgIGlmIChpbmZvLmJsb2NrcylcbiAgICAgICAgICAgIGluZm8uYmxvY2tzW2luZGV4XSA9IGJsb2NrO1xuICAgICAgICBpZiAobmVlZHNfZmx1c2gpIHtcbiAgICAgICAgICAgIGZsdXNoKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKGlzX3Byb21pc2UocHJvbWlzZSkpIHtcbiAgICAgICAgY29uc3QgY3VycmVudF9jb21wb25lbnQgPSBnZXRfY3VycmVudF9jb21wb25lbnQoKTtcbiAgICAgICAgcHJvbWlzZS50aGVuKHZhbHVlID0+IHtcbiAgICAgICAgICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChjdXJyZW50X2NvbXBvbmVudCk7XG4gICAgICAgICAgICB1cGRhdGUoaW5mby50aGVuLCAxLCBpbmZvLnZhbHVlLCB2YWx1ZSk7XG4gICAgICAgICAgICBzZXRfY3VycmVudF9jb21wb25lbnQobnVsbCk7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChjdXJyZW50X2NvbXBvbmVudCk7XG4gICAgICAgICAgICB1cGRhdGUoaW5mby5jYXRjaCwgMiwgaW5mby5lcnJvciwgZXJyb3IpO1xuICAgICAgICAgICAgc2V0X2N1cnJlbnRfY29tcG9uZW50KG51bGwpO1xuICAgICAgICAgICAgaWYgKCFpbmZvLmhhc0NhdGNoKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBpZiB3ZSBwcmV2aW91c2x5IGhhZCBhIHRoZW4vY2F0Y2ggYmxvY2ssIGRlc3Ryb3kgaXRcbiAgICAgICAgaWYgKGluZm8uY3VycmVudCAhPT0gaW5mby5wZW5kaW5nKSB7XG4gICAgICAgICAgICB1cGRhdGUoaW5mby5wZW5kaW5nLCAwKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoaW5mby5jdXJyZW50ICE9PSBpbmZvLnRoZW4pIHtcbiAgICAgICAgICAgIHVwZGF0ZShpbmZvLnRoZW4sIDEsIGluZm8udmFsdWUsIHByb21pc2UpO1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaW5mby5yZXNvbHZlZCA9IHByb21pc2U7XG4gICAgfVxufVxuXG5jb25zdCBnbG9iYWxzID0gKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnXG4gICAgPyB3aW5kb3dcbiAgICA6IHR5cGVvZiBnbG9iYWxUaGlzICE9PSAndW5kZWZpbmVkJ1xuICAgICAgICA/IGdsb2JhbFRoaXNcbiAgICAgICAgOiBnbG9iYWwpO1xuXG5mdW5jdGlvbiBkZXN0cm95X2Jsb2NrKGJsb2NrLCBsb29rdXApIHtcbiAgICBibG9jay5kKDEpO1xuICAgIGxvb2t1cC5kZWxldGUoYmxvY2sua2V5KTtcbn1cbmZ1bmN0aW9uIG91dHJvX2FuZF9kZXN0cm95X2Jsb2NrKGJsb2NrLCBsb29rdXApIHtcbiAgICB0cmFuc2l0aW9uX291dChibG9jaywgMSwgMSwgKCkgPT4ge1xuICAgICAgICBsb29rdXAuZGVsZXRlKGJsb2NrLmtleSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBmaXhfYW5kX2Rlc3Ryb3lfYmxvY2soYmxvY2ssIGxvb2t1cCkge1xuICAgIGJsb2NrLmYoKTtcbiAgICBkZXN0cm95X2Jsb2NrKGJsb2NrLCBsb29rdXApO1xufVxuZnVuY3Rpb24gZml4X2FuZF9vdXRyb19hbmRfZGVzdHJveV9ibG9jayhibG9jaywgbG9va3VwKSB7XG4gICAgYmxvY2suZigpO1xuICAgIG91dHJvX2FuZF9kZXN0cm95X2Jsb2NrKGJsb2NrLCBsb29rdXApO1xufVxuZnVuY3Rpb24gdXBkYXRlX2tleWVkX2VhY2gob2xkX2Jsb2NrcywgZGlydHksIGdldF9rZXksIGR5bmFtaWMsIGN0eCwgbGlzdCwgbG9va3VwLCBub2RlLCBkZXN0cm95LCBjcmVhdGVfZWFjaF9ibG9jaywgbmV4dCwgZ2V0X2NvbnRleHQpIHtcbiAgICBsZXQgbyA9IG9sZF9ibG9ja3MubGVuZ3RoO1xuICAgIGxldCBuID0gbGlzdC5sZW5ndGg7XG4gICAgbGV0IGkgPSBvO1xuICAgIGNvbnN0IG9sZF9pbmRleGVzID0ge307XG4gICAgd2hpbGUgKGktLSlcbiAgICAgICAgb2xkX2luZGV4ZXNbb2xkX2Jsb2Nrc1tpXS5rZXldID0gaTtcbiAgICBjb25zdCBuZXdfYmxvY2tzID0gW107XG4gICAgY29uc3QgbmV3X2xvb2t1cCA9IG5ldyBNYXAoKTtcbiAgICBjb25zdCBkZWx0YXMgPSBuZXcgTWFwKCk7XG4gICAgaSA9IG47XG4gICAgd2hpbGUgKGktLSkge1xuICAgICAgICBjb25zdCBjaGlsZF9jdHggPSBnZXRfY29udGV4dChjdHgsIGxpc3QsIGkpO1xuICAgICAgICBjb25zdCBrZXkgPSBnZXRfa2V5KGNoaWxkX2N0eCk7XG4gICAgICAgIGxldCBibG9jayA9IGxvb2t1cC5nZXQoa2V5KTtcbiAgICAgICAgaWYgKCFibG9jaykge1xuICAgICAgICAgICAgYmxvY2sgPSBjcmVhdGVfZWFjaF9ibG9jayhrZXksIGNoaWxkX2N0eCk7XG4gICAgICAgICAgICBibG9jay5jKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZHluYW1pYykge1xuICAgICAgICAgICAgYmxvY2sucChjaGlsZF9jdHgsIGRpcnR5KTtcbiAgICAgICAgfVxuICAgICAgICBuZXdfbG9va3VwLnNldChrZXksIG5ld19ibG9ja3NbaV0gPSBibG9jayk7XG4gICAgICAgIGlmIChrZXkgaW4gb2xkX2luZGV4ZXMpXG4gICAgICAgICAgICBkZWx0YXMuc2V0KGtleSwgTWF0aC5hYnMoaSAtIG9sZF9pbmRleGVzW2tleV0pKTtcbiAgICB9XG4gICAgY29uc3Qgd2lsbF9tb3ZlID0gbmV3IFNldCgpO1xuICAgIGNvbnN0IGRpZF9tb3ZlID0gbmV3IFNldCgpO1xuICAgIGZ1bmN0aW9uIGluc2VydChibG9jaykge1xuICAgICAgICB0cmFuc2l0aW9uX2luKGJsb2NrLCAxKTtcbiAgICAgICAgYmxvY2subShub2RlLCBuZXh0KTtcbiAgICAgICAgbG9va3VwLnNldChibG9jay5rZXksIGJsb2NrKTtcbiAgICAgICAgbmV4dCA9IGJsb2NrLmZpcnN0O1xuICAgICAgICBuLS07XG4gICAgfVxuICAgIHdoaWxlIChvICYmIG4pIHtcbiAgICAgICAgY29uc3QgbmV3X2Jsb2NrID0gbmV3X2Jsb2Nrc1tuIC0gMV07XG4gICAgICAgIGNvbnN0IG9sZF9ibG9jayA9IG9sZF9ibG9ja3NbbyAtIDFdO1xuICAgICAgICBjb25zdCBuZXdfa2V5ID0gbmV3X2Jsb2NrLmtleTtcbiAgICAgICAgY29uc3Qgb2xkX2tleSA9IG9sZF9ibG9jay5rZXk7XG4gICAgICAgIGlmIChuZXdfYmxvY2sgPT09IG9sZF9ibG9jaykge1xuICAgICAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAgICAgICAgbmV4dCA9IG5ld19ibG9jay5maXJzdDtcbiAgICAgICAgICAgIG8tLTtcbiAgICAgICAgICAgIG4tLTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICghbmV3X2xvb2t1cC5oYXMob2xkX2tleSkpIHtcbiAgICAgICAgICAgIC8vIHJlbW92ZSBvbGQgYmxvY2tcbiAgICAgICAgICAgIGRlc3Ryb3kob2xkX2Jsb2NrLCBsb29rdXApO1xuICAgICAgICAgICAgby0tO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFsb29rdXAuaGFzKG5ld19rZXkpIHx8IHdpbGxfbW92ZS5oYXMobmV3X2tleSkpIHtcbiAgICAgICAgICAgIGluc2VydChuZXdfYmxvY2spO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRpZF9tb3ZlLmhhcyhvbGRfa2V5KSkge1xuICAgICAgICAgICAgby0tO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGRlbHRhcy5nZXQobmV3X2tleSkgPiBkZWx0YXMuZ2V0KG9sZF9rZXkpKSB7XG4gICAgICAgICAgICBkaWRfbW92ZS5hZGQobmV3X2tleSk7XG4gICAgICAgICAgICBpbnNlcnQobmV3X2Jsb2NrKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHdpbGxfbW92ZS5hZGQob2xkX2tleSk7XG4gICAgICAgICAgICBvLS07XG4gICAgICAgIH1cbiAgICB9XG4gICAgd2hpbGUgKG8tLSkge1xuICAgICAgICBjb25zdCBvbGRfYmxvY2sgPSBvbGRfYmxvY2tzW29dO1xuICAgICAgICBpZiAoIW5ld19sb29rdXAuaGFzKG9sZF9ibG9jay5rZXkpKVxuICAgICAgICAgICAgZGVzdHJveShvbGRfYmxvY2ssIGxvb2t1cCk7XG4gICAgfVxuICAgIHdoaWxlIChuKVxuICAgICAgICBpbnNlcnQobmV3X2Jsb2Nrc1tuIC0gMV0pO1xuICAgIHJldHVybiBuZXdfYmxvY2tzO1xufVxuZnVuY3Rpb24gdmFsaWRhdGVfZWFjaF9rZXlzKGN0eCwgbGlzdCwgZ2V0X2NvbnRleHQsIGdldF9rZXkpIHtcbiAgICBjb25zdCBrZXlzID0gbmV3IFNldCgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlzdC5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBrZXkgPSBnZXRfa2V5KGdldF9jb250ZXh0KGN0eCwgbGlzdCwgaSkpO1xuICAgICAgICBpZiAoa2V5cy5oYXMoa2V5KSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgaGF2ZSBkdXBsaWNhdGUga2V5cyBpbiBhIGtleWVkIGVhY2hgKTtcbiAgICAgICAgfVxuICAgICAgICBrZXlzLmFkZChrZXkpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gZ2V0X3NwcmVhZF91cGRhdGUobGV2ZWxzLCB1cGRhdGVzKSB7XG4gICAgY29uc3QgdXBkYXRlID0ge307XG4gICAgY29uc3QgdG9fbnVsbF9vdXQgPSB7fTtcbiAgICBjb25zdCBhY2NvdW50ZWRfZm9yID0geyAkJHNjb3BlOiAxIH07XG4gICAgbGV0IGkgPSBsZXZlbHMubGVuZ3RoO1xuICAgIHdoaWxlIChpLS0pIHtcbiAgICAgICAgY29uc3QgbyA9IGxldmVsc1tpXTtcbiAgICAgICAgY29uc3QgbiA9IHVwZGF0ZXNbaV07XG4gICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGtleSBpbiBvKSB7XG4gICAgICAgICAgICAgICAgaWYgKCEoa2V5IGluIG4pKVxuICAgICAgICAgICAgICAgICAgICB0b19udWxsX291dFtrZXldID0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGZvciAoY29uc3Qga2V5IGluIG4pIHtcbiAgICAgICAgICAgICAgICBpZiAoIWFjY291bnRlZF9mb3Jba2V5XSkge1xuICAgICAgICAgICAgICAgICAgICB1cGRhdGVba2V5XSA9IG5ba2V5XTtcbiAgICAgICAgICAgICAgICAgICAgYWNjb3VudGVkX2ZvcltrZXldID0gMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBsZXZlbHNbaV0gPSBuO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gbykge1xuICAgICAgICAgICAgICAgIGFjY291bnRlZF9mb3Jba2V5XSA9IDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZm9yIChjb25zdCBrZXkgaW4gdG9fbnVsbF9vdXQpIHtcbiAgICAgICAgaWYgKCEoa2V5IGluIHVwZGF0ZSkpXG4gICAgICAgICAgICB1cGRhdGVba2V5XSA9IHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIHVwZGF0ZTtcbn1cbmZ1bmN0aW9uIGdldF9zcHJlYWRfb2JqZWN0KHNwcmVhZF9wcm9wcykge1xuICAgIHJldHVybiB0eXBlb2Ygc3ByZWFkX3Byb3BzID09PSAnb2JqZWN0JyAmJiBzcHJlYWRfcHJvcHMgIT09IG51bGwgPyBzcHJlYWRfcHJvcHMgOiB7fTtcbn1cblxuLy8gc291cmNlOiBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9pbmRpY2VzLmh0bWxcbmNvbnN0IGJvb2xlYW5fYXR0cmlidXRlcyA9IG5ldyBTZXQoW1xuICAgICdhbGxvd2Z1bGxzY3JlZW4nLFxuICAgICdhbGxvd3BheW1lbnRyZXF1ZXN0JyxcbiAgICAnYXN5bmMnLFxuICAgICdhdXRvZm9jdXMnLFxuICAgICdhdXRvcGxheScsXG4gICAgJ2NoZWNrZWQnLFxuICAgICdjb250cm9scycsXG4gICAgJ2RlZmF1bHQnLFxuICAgICdkZWZlcicsXG4gICAgJ2Rpc2FibGVkJyxcbiAgICAnZm9ybW5vdmFsaWRhdGUnLFxuICAgICdoaWRkZW4nLFxuICAgICdpc21hcCcsXG4gICAgJ2xvb3AnLFxuICAgICdtdWx0aXBsZScsXG4gICAgJ211dGVkJyxcbiAgICAnbm9tb2R1bGUnLFxuICAgICdub3ZhbGlkYXRlJyxcbiAgICAnb3BlbicsXG4gICAgJ3BsYXlzaW5saW5lJyxcbiAgICAncmVhZG9ubHknLFxuICAgICdyZXF1aXJlZCcsXG4gICAgJ3JldmVyc2VkJyxcbiAgICAnc2VsZWN0ZWQnXG5dKTtcblxuY29uc3QgaW52YWxpZF9hdHRyaWJ1dGVfbmFtZV9jaGFyYWN0ZXIgPSAvW1xccydcIj4vPVxcdXtGREQwfS1cXHV7RkRFRn1cXHV7RkZGRX1cXHV7RkZGRn1cXHV7MUZGRkV9XFx1ezFGRkZGfVxcdXsyRkZGRX1cXHV7MkZGRkZ9XFx1ezNGRkZFfVxcdXszRkZGRn1cXHV7NEZGRkV9XFx1ezRGRkZGfVxcdXs1RkZGRX1cXHV7NUZGRkZ9XFx1ezZGRkZFfVxcdXs2RkZGRn1cXHV7N0ZGRkV9XFx1ezdGRkZGfVxcdXs4RkZGRX1cXHV7OEZGRkZ9XFx1ezlGRkZFfVxcdXs5RkZGRn1cXHV7QUZGRkV9XFx1e0FGRkZGfVxcdXtCRkZGRX1cXHV7QkZGRkZ9XFx1e0NGRkZFfVxcdXtDRkZGRn1cXHV7REZGRkV9XFx1e0RGRkZGfVxcdXtFRkZGRX1cXHV7RUZGRkZ9XFx1e0ZGRkZFfVxcdXtGRkZGRn1cXHV7MTBGRkZFfVxcdXsxMEZGRkZ9XS91O1xuLy8gaHR0cHM6Ly9odG1sLnNwZWMud2hhdHdnLm9yZy9tdWx0aXBhZ2Uvc3ludGF4Lmh0bWwjYXR0cmlidXRlcy0yXG4vLyBodHRwczovL2luZnJhLnNwZWMud2hhdHdnLm9yZy8jbm9uY2hhcmFjdGVyXG5mdW5jdGlvbiBzcHJlYWQoYXJncywgY2xhc3Nlc190b19hZGQpIHtcbiAgICBjb25zdCBhdHRyaWJ1dGVzID0gT2JqZWN0LmFzc2lnbih7fSwgLi4uYXJncyk7XG4gICAgaWYgKGNsYXNzZXNfdG9fYWRkKSB7XG4gICAgICAgIGlmIChhdHRyaWJ1dGVzLmNsYXNzID09IG51bGwpIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgPSBjbGFzc2VzX3RvX2FkZDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGF0dHJpYnV0ZXMuY2xhc3MgKz0gJyAnICsgY2xhc3Nlc190b19hZGQ7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHN0ciA9ICcnO1xuICAgIE9iamVjdC5rZXlzKGF0dHJpYnV0ZXMpLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgIGlmIChpbnZhbGlkX2F0dHJpYnV0ZV9uYW1lX2NoYXJhY3Rlci50ZXN0KG5hbWUpKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICBjb25zdCB2YWx1ZSA9IGF0dHJpYnV0ZXNbbmFtZV07XG4gICAgICAgIGlmICh2YWx1ZSA9PT0gdHJ1ZSlcbiAgICAgICAgICAgIHN0ciArPSBcIiBcIiArIG5hbWU7XG4gICAgICAgIGVsc2UgaWYgKGJvb2xlYW5fYXR0cmlidXRlcy5oYXMobmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICAgICAgaWYgKHZhbHVlKVxuICAgICAgICAgICAgICAgIHN0ciArPSBcIiBcIiArIG5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgICAgICAgc3RyICs9IGAgJHtuYW1lfT1cIiR7U3RyaW5nKHZhbHVlKS5yZXBsYWNlKC9cIi9nLCAnJiMzNDsnKS5yZXBsYWNlKC8nL2csICcmIzM5OycpfVwiYDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBzdHI7XG59XG5jb25zdCBlc2NhcGVkID0ge1xuICAgICdcIic6ICcmcXVvdDsnLFxuICAgIFwiJ1wiOiAnJiMzOTsnLFxuICAgICcmJzogJyZhbXA7JyxcbiAgICAnPCc6ICcmbHQ7JyxcbiAgICAnPic6ICcmZ3Q7J1xufTtcbmZ1bmN0aW9uIGVzY2FwZShodG1sKSB7XG4gICAgcmV0dXJuIFN0cmluZyhodG1sKS5yZXBsYWNlKC9bXCInJjw+XS9nLCBtYXRjaCA9PiBlc2NhcGVkW21hdGNoXSk7XG59XG5mdW5jdGlvbiBlYWNoKGl0ZW1zLCBmbikge1xuICAgIGxldCBzdHIgPSAnJztcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGl0ZW1zLmxlbmd0aDsgaSArPSAxKSB7XG4gICAgICAgIHN0ciArPSBmbihpdGVtc1tpXSwgaSk7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5jb25zdCBtaXNzaW5nX2NvbXBvbmVudCA9IHtcbiAgICAkJHJlbmRlcjogKCkgPT4gJydcbn07XG5mdW5jdGlvbiB2YWxpZGF0ZV9jb21wb25lbnQoY29tcG9uZW50LCBuYW1lKSB7XG4gICAgaWYgKCFjb21wb25lbnQgfHwgIWNvbXBvbmVudC4kJHJlbmRlcikge1xuICAgICAgICBpZiAobmFtZSA9PT0gJ3N2ZWx0ZTpjb21wb25lbnQnKVxuICAgICAgICAgICAgbmFtZSArPSAnIHRoaXM9ey4uLn0nO1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYDwke25hbWV9PiBpcyBub3QgYSB2YWxpZCBTU1IgY29tcG9uZW50LiBZb3UgbWF5IG5lZWQgdG8gcmV2aWV3IHlvdXIgYnVpbGQgY29uZmlnIHRvIGVuc3VyZSB0aGF0IGRlcGVuZGVuY2llcyBhcmUgY29tcGlsZWQsIHJhdGhlciB0aGFuIGltcG9ydGVkIGFzIHByZS1jb21waWxlZCBtb2R1bGVzYCk7XG4gICAgfVxuICAgIHJldHVybiBjb21wb25lbnQ7XG59XG5mdW5jdGlvbiBkZWJ1ZyhmaWxlLCBsaW5lLCBjb2x1bW4sIHZhbHVlcykge1xuICAgIGNvbnNvbGUubG9nKGB7QGRlYnVnfSAke2ZpbGUgPyBmaWxlICsgJyAnIDogJyd9KCR7bGluZX06JHtjb2x1bW59KWApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICBjb25zb2xlLmxvZyh2YWx1ZXMpOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICByZXR1cm4gJyc7XG59XG5sZXQgb25fZGVzdHJveTtcbmZ1bmN0aW9uIGNyZWF0ZV9zc3JfY29tcG9uZW50KGZuKSB7XG4gICAgZnVuY3Rpb24gJCRyZW5kZXIocmVzdWx0LCBwcm9wcywgYmluZGluZ3MsIHNsb3RzKSB7XG4gICAgICAgIGNvbnN0IHBhcmVudF9jb21wb25lbnQgPSBjdXJyZW50X2NvbXBvbmVudDtcbiAgICAgICAgY29uc3QgJCQgPSB7XG4gICAgICAgICAgICBvbl9kZXN0cm95LFxuICAgICAgICAgICAgY29udGV4dDogbmV3IE1hcChwYXJlbnRfY29tcG9uZW50ID8gcGFyZW50X2NvbXBvbmVudC4kJC5jb250ZXh0IDogW10pLFxuICAgICAgICAgICAgLy8gdGhlc2Ugd2lsbCBiZSBpbW1lZGlhdGVseSBkaXNjYXJkZWRcbiAgICAgICAgICAgIG9uX21vdW50OiBbXSxcbiAgICAgICAgICAgIGJlZm9yZV91cGRhdGU6IFtdLFxuICAgICAgICAgICAgYWZ0ZXJfdXBkYXRlOiBbXSxcbiAgICAgICAgICAgIGNhbGxiYWNrczogYmxhbmtfb2JqZWN0KClcbiAgICAgICAgfTtcbiAgICAgICAgc2V0X2N1cnJlbnRfY29tcG9uZW50KHsgJCQgfSk7XG4gICAgICAgIGNvbnN0IGh0bWwgPSBmbihyZXN1bHQsIHByb3BzLCBiaW5kaW5ncywgc2xvdHMpO1xuICAgICAgICBzZXRfY3VycmVudF9jb21wb25lbnQocGFyZW50X2NvbXBvbmVudCk7XG4gICAgICAgIHJldHVybiBodG1sO1xuICAgIH1cbiAgICByZXR1cm4ge1xuICAgICAgICByZW5kZXI6IChwcm9wcyA9IHt9LCBvcHRpb25zID0ge30pID0+IHtcbiAgICAgICAgICAgIG9uX2Rlc3Ryb3kgPSBbXTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IHsgdGl0bGU6ICcnLCBoZWFkOiAnJywgY3NzOiBuZXcgU2V0KCkgfTtcbiAgICAgICAgICAgIGNvbnN0IGh0bWwgPSAkJHJlbmRlcihyZXN1bHQsIHByb3BzLCB7fSwgb3B0aW9ucyk7XG4gICAgICAgICAgICBydW5fYWxsKG9uX2Rlc3Ryb3kpO1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgICBodG1sLFxuICAgICAgICAgICAgICAgIGNzczoge1xuICAgICAgICAgICAgICAgICAgICBjb2RlOiBBcnJheS5mcm9tKHJlc3VsdC5jc3MpLm1hcChjc3MgPT4gY3NzLmNvZGUpLmpvaW4oJ1xcbicpLFxuICAgICAgICAgICAgICAgICAgICBtYXA6IG51bGwgLy8gVE9ET1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGVhZDogcmVzdWx0LnRpdGxlICsgcmVzdWx0LmhlYWRcbiAgICAgICAgICAgIH07XG4gICAgICAgIH0sXG4gICAgICAgICQkcmVuZGVyXG4gICAgfTtcbn1cbmZ1bmN0aW9uIGFkZF9hdHRyaWJ1dGUobmFtZSwgdmFsdWUsIGJvb2xlYW4pIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCB8fCAoYm9vbGVhbiAmJiAhdmFsdWUpKVxuICAgICAgICByZXR1cm4gJyc7XG4gICAgcmV0dXJuIGAgJHtuYW1lfSR7dmFsdWUgPT09IHRydWUgPyAnJyA6IGA9JHt0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnID8gSlNPTi5zdHJpbmdpZnkoZXNjYXBlKHZhbHVlKSkgOiBgXCIke3ZhbHVlfVwiYH1gfWA7XG59XG5mdW5jdGlvbiBhZGRfY2xhc3NlcyhjbGFzc2VzKSB7XG4gICAgcmV0dXJuIGNsYXNzZXMgPyBgIGNsYXNzPVwiJHtjbGFzc2VzfVwiYCA6IGBgO1xufVxuXG5mdW5jdGlvbiBiaW5kKGNvbXBvbmVudCwgbmFtZSwgY2FsbGJhY2spIHtcbiAgICBjb25zdCBpbmRleCA9IGNvbXBvbmVudC4kJC5wcm9wc1tuYW1lXTtcbiAgICBpZiAoaW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBjb21wb25lbnQuJCQuYm91bmRbaW5kZXhdID0gY2FsbGJhY2s7XG4gICAgICAgIGNhbGxiYWNrKGNvbXBvbmVudC4kJC5jdHhbaW5kZXhdKTtcbiAgICB9XG59XG5mdW5jdGlvbiBjcmVhdGVfY29tcG9uZW50KGJsb2NrKSB7XG4gICAgYmxvY2sgJiYgYmxvY2suYygpO1xufVxuZnVuY3Rpb24gY2xhaW1fY29tcG9uZW50KGJsb2NrLCBwYXJlbnRfbm9kZXMpIHtcbiAgICBibG9jayAmJiBibG9jay5sKHBhcmVudF9ub2Rlcyk7XG59XG5mdW5jdGlvbiBtb3VudF9jb21wb25lbnQoY29tcG9uZW50LCB0YXJnZXQsIGFuY2hvcikge1xuICAgIGNvbnN0IHsgZnJhZ21lbnQsIG9uX21vdW50LCBvbl9kZXN0cm95LCBhZnRlcl91cGRhdGUgfSA9IGNvbXBvbmVudC4kJDtcbiAgICBmcmFnbWVudCAmJiBmcmFnbWVudC5tKHRhcmdldCwgYW5jaG9yKTtcbiAgICAvLyBvbk1vdW50IGhhcHBlbnMgYmVmb3JlIHRoZSBpbml0aWFsIGFmdGVyVXBkYXRlXG4gICAgYWRkX3JlbmRlcl9jYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGNvbnN0IG5ld19vbl9kZXN0cm95ID0gb25fbW91bnQubWFwKHJ1bikuZmlsdGVyKGlzX2Z1bmN0aW9uKTtcbiAgICAgICAgaWYgKG9uX2Rlc3Ryb3kpIHtcbiAgICAgICAgICAgIG9uX2Rlc3Ryb3kucHVzaCguLi5uZXdfb25fZGVzdHJveSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBFZGdlIGNhc2UgLSBjb21wb25lbnQgd2FzIGRlc3Ryb3llZCBpbW1lZGlhdGVseSxcbiAgICAgICAgICAgIC8vIG1vc3QgbGlrZWx5IGFzIGEgcmVzdWx0IG9mIGEgYmluZGluZyBpbml0aWFsaXNpbmdcbiAgICAgICAgICAgIHJ1bl9hbGwobmV3X29uX2Rlc3Ryb3kpO1xuICAgICAgICB9XG4gICAgICAgIGNvbXBvbmVudC4kJC5vbl9tb3VudCA9IFtdO1xuICAgIH0pO1xuICAgIGFmdGVyX3VwZGF0ZS5mb3JFYWNoKGFkZF9yZW5kZXJfY2FsbGJhY2spO1xufVxuZnVuY3Rpb24gZGVzdHJveV9jb21wb25lbnQoY29tcG9uZW50LCBkZXRhY2hpbmcpIHtcbiAgICBjb25zdCAkJCA9IGNvbXBvbmVudC4kJDtcbiAgICBpZiAoJCQuZnJhZ21lbnQgIT09IG51bGwpIHtcbiAgICAgICAgcnVuX2FsbCgkJC5vbl9kZXN0cm95KTtcbiAgICAgICAgJCQuZnJhZ21lbnQgJiYgJCQuZnJhZ21lbnQuZChkZXRhY2hpbmcpO1xuICAgICAgICAvLyBUT0RPIG51bGwgb3V0IG90aGVyIHJlZnMsIGluY2x1ZGluZyBjb21wb25lbnQuJCQgKGJ1dCBuZWVkIHRvXG4gICAgICAgIC8vIHByZXNlcnZlIGZpbmFsIHN0YXRlPylcbiAgICAgICAgJCQub25fZGVzdHJveSA9ICQkLmZyYWdtZW50ID0gbnVsbDtcbiAgICAgICAgJCQuY3R4ID0gW107XG4gICAgfVxufVxuZnVuY3Rpb24gbWFrZV9kaXJ0eShjb21wb25lbnQsIGkpIHtcbiAgICBpZiAoY29tcG9uZW50LiQkLmRpcnR5WzBdID09PSAtMSkge1xuICAgICAgICBkaXJ0eV9jb21wb25lbnRzLnB1c2goY29tcG9uZW50KTtcbiAgICAgICAgc2NoZWR1bGVfdXBkYXRlKCk7XG4gICAgICAgIGNvbXBvbmVudC4kJC5kaXJ0eS5maWxsKDApO1xuICAgIH1cbiAgICBjb21wb25lbnQuJCQuZGlydHlbKGkgLyAzMSkgfCAwXSB8PSAoMSA8PCAoaSAlIDMxKSk7XG59XG5mdW5jdGlvbiBpbml0KGNvbXBvbmVudCwgb3B0aW9ucywgaW5zdGFuY2UsIGNyZWF0ZV9mcmFnbWVudCwgbm90X2VxdWFsLCBwcm9wcywgZGlydHkgPSBbLTFdKSB7XG4gICAgY29uc3QgcGFyZW50X2NvbXBvbmVudCA9IGN1cnJlbnRfY29tcG9uZW50O1xuICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChjb21wb25lbnQpO1xuICAgIGNvbnN0IHByb3BfdmFsdWVzID0gb3B0aW9ucy5wcm9wcyB8fCB7fTtcbiAgICBjb25zdCAkJCA9IGNvbXBvbmVudC4kJCA9IHtcbiAgICAgICAgZnJhZ21lbnQ6IG51bGwsXG4gICAgICAgIGN0eDogbnVsbCxcbiAgICAgICAgLy8gc3RhdGVcbiAgICAgICAgcHJvcHMsXG4gICAgICAgIHVwZGF0ZTogbm9vcCxcbiAgICAgICAgbm90X2VxdWFsLFxuICAgICAgICBib3VuZDogYmxhbmtfb2JqZWN0KCksXG4gICAgICAgIC8vIGxpZmVjeWNsZVxuICAgICAgICBvbl9tb3VudDogW10sXG4gICAgICAgIG9uX2Rlc3Ryb3k6IFtdLFxuICAgICAgICBiZWZvcmVfdXBkYXRlOiBbXSxcbiAgICAgICAgYWZ0ZXJfdXBkYXRlOiBbXSxcbiAgICAgICAgY29udGV4dDogbmV3IE1hcChwYXJlbnRfY29tcG9uZW50ID8gcGFyZW50X2NvbXBvbmVudC4kJC5jb250ZXh0IDogW10pLFxuICAgICAgICAvLyBldmVyeXRoaW5nIGVsc2VcbiAgICAgICAgY2FsbGJhY2tzOiBibGFua19vYmplY3QoKSxcbiAgICAgICAgZGlydHksXG4gICAgICAgIHNraXBfYm91bmQ6IGZhbHNlXG4gICAgfTtcbiAgICBsZXQgcmVhZHkgPSBmYWxzZTtcbiAgICAkJC5jdHggPSBpbnN0YW5jZVxuICAgICAgICA/IGluc3RhbmNlKGNvbXBvbmVudCwgcHJvcF92YWx1ZXMsIChpLCByZXQsIC4uLnJlc3QpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gcmVzdC5sZW5ndGggPyByZXN0WzBdIDogcmV0O1xuICAgICAgICAgICAgaWYgKCQkLmN0eCAmJiBub3RfZXF1YWwoJCQuY3R4W2ldLCAkJC5jdHhbaV0gPSB2YWx1ZSkpIHtcbiAgICAgICAgICAgICAgICBpZiAoISQkLnNraXBfYm91bmQgJiYgJCQuYm91bmRbaV0pXG4gICAgICAgICAgICAgICAgICAgICQkLmJvdW5kW2ldKHZhbHVlKTtcbiAgICAgICAgICAgICAgICBpZiAocmVhZHkpXG4gICAgICAgICAgICAgICAgICAgIG1ha2VfZGlydHkoY29tcG9uZW50LCBpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXQ7XG4gICAgICAgIH0pXG4gICAgICAgIDogW107XG4gICAgJCQudXBkYXRlKCk7XG4gICAgcmVhZHkgPSB0cnVlO1xuICAgIHJ1bl9hbGwoJCQuYmVmb3JlX3VwZGF0ZSk7XG4gICAgLy8gYGZhbHNlYCBhcyBhIHNwZWNpYWwgY2FzZSBvZiBubyBET00gY29tcG9uZW50XG4gICAgJCQuZnJhZ21lbnQgPSBjcmVhdGVfZnJhZ21lbnQgPyBjcmVhdGVfZnJhZ21lbnQoJCQuY3R4KSA6IGZhbHNlO1xuICAgIGlmIChvcHRpb25zLnRhcmdldCkge1xuICAgICAgICBpZiAob3B0aW9ucy5oeWRyYXRlKSB7XG4gICAgICAgICAgICBjb25zdCBub2RlcyA9IGNoaWxkcmVuKG9wdGlvbnMudGFyZ2V0KTtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICAkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5sKG5vZGVzKTtcbiAgICAgICAgICAgIG5vZGVzLmZvckVhY2goZGV0YWNoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tbm9uLW51bGwtYXNzZXJ0aW9uXG4gICAgICAgICAgICAkJC5mcmFnbWVudCAmJiAkJC5mcmFnbWVudC5jKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9wdGlvbnMuaW50cm8pXG4gICAgICAgICAgICB0cmFuc2l0aW9uX2luKGNvbXBvbmVudC4kJC5mcmFnbWVudCk7XG4gICAgICAgIG1vdW50X2NvbXBvbmVudChjb21wb25lbnQsIG9wdGlvbnMudGFyZ2V0LCBvcHRpb25zLmFuY2hvcik7XG4gICAgICAgIGZsdXNoKCk7XG4gICAgfVxuICAgIHNldF9jdXJyZW50X2NvbXBvbmVudChwYXJlbnRfY29tcG9uZW50KTtcbn1cbmxldCBTdmVsdGVFbGVtZW50O1xuaWYgKHR5cGVvZiBIVE1MRWxlbWVudCA9PT0gJ2Z1bmN0aW9uJykge1xuICAgIFN2ZWx0ZUVsZW1lbnQgPSBjbGFzcyBleHRlbmRzIEhUTUxFbGVtZW50IHtcbiAgICAgICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgICAgICBzdXBlcigpO1xuICAgICAgICAgICAgdGhpcy5hdHRhY2hTaGFkb3coeyBtb2RlOiAnb3BlbicgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgICAgICAgICAvLyBAdHMtaWdub3JlIHRvZG86IGltcHJvdmUgdHlwaW5nc1xuICAgICAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gdGhpcy4kJC5zbG90dGVkKSB7XG4gICAgICAgICAgICAgICAgLy8gQHRzLWlnbm9yZSB0b2RvOiBpbXByb3ZlIHR5cGluZ3NcbiAgICAgICAgICAgICAgICB0aGlzLmFwcGVuZENoaWxkKHRoaXMuJCQuc2xvdHRlZFtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBhdHRyaWJ1dGVDaGFuZ2VkQ2FsbGJhY2soYXR0ciwgX29sZFZhbHVlLCBuZXdWYWx1ZSkge1xuICAgICAgICAgICAgdGhpc1thdHRyXSA9IG5ld1ZhbHVlO1xuICAgICAgICB9XG4gICAgICAgICRkZXN0cm95KCkge1xuICAgICAgICAgICAgZGVzdHJveV9jb21wb25lbnQodGhpcywgMSk7XG4gICAgICAgICAgICB0aGlzLiRkZXN0cm95ID0gbm9vcDtcbiAgICAgICAgfVxuICAgICAgICAkb24odHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgICAgIC8vIFRPRE8gc2hvdWxkIHRoaXMgZGVsZWdhdGUgdG8gYWRkRXZlbnRMaXN0ZW5lcj9cbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrcyA9ICh0aGlzLiQkLmNhbGxiYWNrc1t0eXBlXSB8fCAodGhpcy4kJC5jYWxsYmFja3NbdHlwZV0gPSBbXSkpO1xuICAgICAgICAgICAgY2FsbGJhY2tzLnB1c2goY2FsbGJhY2spO1xuICAgICAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmRleCA9IGNhbGxiYWNrcy5pbmRleE9mKGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICBpZiAoaW5kZXggIT09IC0xKVxuICAgICAgICAgICAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgICAgJHNldCgkJHByb3BzKSB7XG4gICAgICAgICAgICBpZiAodGhpcy4kJHNldCAmJiAhaXNfZW1wdHkoJCRwcm9wcykpIHtcbiAgICAgICAgICAgICAgICB0aGlzLiQkLnNraXBfYm91bmQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHRoaXMuJCRzZXQoJCRwcm9wcyk7XG4gICAgICAgICAgICAgICAgdGhpcy4kJC5za2lwX2JvdW5kID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xufVxuY2xhc3MgU3ZlbHRlQ29tcG9uZW50IHtcbiAgICAkZGVzdHJveSgpIHtcbiAgICAgICAgZGVzdHJveV9jb21wb25lbnQodGhpcywgMSk7XG4gICAgICAgIHRoaXMuJGRlc3Ryb3kgPSBub29wO1xuICAgIH1cbiAgICAkb24odHlwZSwgY2FsbGJhY2spIHtcbiAgICAgICAgY29uc3QgY2FsbGJhY2tzID0gKHRoaXMuJCQuY2FsbGJhY2tzW3R5cGVdIHx8ICh0aGlzLiQkLmNhbGxiYWNrc1t0eXBlXSA9IFtdKSk7XG4gICAgICAgIGNhbGxiYWNrcy5wdXNoKGNhbGxiYWNrKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gY2FsbGJhY2tzLmluZGV4T2YoY2FsbGJhY2spO1xuICAgICAgICAgICAgaWYgKGluZGV4ICE9PSAtMSlcbiAgICAgICAgICAgICAgICBjYWxsYmFja3Muc3BsaWNlKGluZGV4LCAxKTtcbiAgICAgICAgfTtcbiAgICB9XG4gICAgJHNldCgkJHByb3BzKSB7XG4gICAgICAgIGlmICh0aGlzLiQkc2V0ICYmICFpc19lbXB0eSgkJHByb3BzKSkge1xuICAgICAgICAgICAgdGhpcy4kJC5za2lwX2JvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIHRoaXMuJCRzZXQoJCRwcm9wcyk7XG4gICAgICAgICAgICB0aGlzLiQkLnNraXBfYm91bmQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gZGlzcGF0Y2hfZGV2KHR5cGUsIGRldGFpbCkge1xuICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQoY3VzdG9tX2V2ZW50KHR5cGUsIE9iamVjdC5hc3NpZ24oeyB2ZXJzaW9uOiAnMy4yOS4wJyB9LCBkZXRhaWwpKSk7XG59XG5mdW5jdGlvbiBhcHBlbmRfZGV2KHRhcmdldCwgbm9kZSkge1xuICAgIGRpc3BhdGNoX2RldihcIlN2ZWx0ZURPTUluc2VydFwiLCB7IHRhcmdldCwgbm9kZSB9KTtcbiAgICBhcHBlbmQodGFyZ2V0LCBub2RlKTtcbn1cbmZ1bmN0aW9uIGluc2VydF9kZXYodGFyZ2V0LCBub2RlLCBhbmNob3IpIHtcbiAgICBkaXNwYXRjaF9kZXYoXCJTdmVsdGVET01JbnNlcnRcIiwgeyB0YXJnZXQsIG5vZGUsIGFuY2hvciB9KTtcbiAgICBpbnNlcnQodGFyZ2V0LCBub2RlLCBhbmNob3IpO1xufVxuZnVuY3Rpb24gZGV0YWNoX2Rldihub2RlKSB7XG4gICAgZGlzcGF0Y2hfZGV2KFwiU3ZlbHRlRE9NUmVtb3ZlXCIsIHsgbm9kZSB9KTtcbiAgICBkZXRhY2gobm9kZSk7XG59XG5mdW5jdGlvbiBkZXRhY2hfYmV0d2Vlbl9kZXYoYmVmb3JlLCBhZnRlcikge1xuICAgIHdoaWxlIChiZWZvcmUubmV4dFNpYmxpbmcgJiYgYmVmb3JlLm5leHRTaWJsaW5nICE9PSBhZnRlcikge1xuICAgICAgICBkZXRhY2hfZGV2KGJlZm9yZS5uZXh0U2libGluZyk7XG4gICAgfVxufVxuZnVuY3Rpb24gZGV0YWNoX2JlZm9yZV9kZXYoYWZ0ZXIpIHtcbiAgICB3aGlsZSAoYWZ0ZXIucHJldmlvdXNTaWJsaW5nKSB7XG4gICAgICAgIGRldGFjaF9kZXYoYWZ0ZXIucHJldmlvdXNTaWJsaW5nKTtcbiAgICB9XG59XG5mdW5jdGlvbiBkZXRhY2hfYWZ0ZXJfZGV2KGJlZm9yZSkge1xuICAgIHdoaWxlIChiZWZvcmUubmV4dFNpYmxpbmcpIHtcbiAgICAgICAgZGV0YWNoX2RldihiZWZvcmUubmV4dFNpYmxpbmcpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGxpc3Rlbl9kZXYobm9kZSwgZXZlbnQsIGhhbmRsZXIsIG9wdGlvbnMsIGhhc19wcmV2ZW50X2RlZmF1bHQsIGhhc19zdG9wX3Byb3BhZ2F0aW9uKSB7XG4gICAgY29uc3QgbW9kaWZpZXJzID0gb3B0aW9ucyA9PT0gdHJ1ZSA/IFtcImNhcHR1cmVcIl0gOiBvcHRpb25zID8gQXJyYXkuZnJvbShPYmplY3Qua2V5cyhvcHRpb25zKSkgOiBbXTtcbiAgICBpZiAoaGFzX3ByZXZlbnRfZGVmYXVsdClcbiAgICAgICAgbW9kaWZpZXJzLnB1c2goJ3ByZXZlbnREZWZhdWx0Jyk7XG4gICAgaWYgKGhhc19zdG9wX3Byb3BhZ2F0aW9uKVxuICAgICAgICBtb2RpZmllcnMucHVzaCgnc3RvcFByb3BhZ2F0aW9uJyk7XG4gICAgZGlzcGF0Y2hfZGV2KFwiU3ZlbHRlRE9NQWRkRXZlbnRMaXN0ZW5lclwiLCB7IG5vZGUsIGV2ZW50LCBoYW5kbGVyLCBtb2RpZmllcnMgfSk7XG4gICAgY29uc3QgZGlzcG9zZSA9IGxpc3Rlbihub2RlLCBldmVudCwgaGFuZGxlciwgb3B0aW9ucyk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2hfZGV2KFwiU3ZlbHRlRE9NUmVtb3ZlRXZlbnRMaXN0ZW5lclwiLCB7IG5vZGUsIGV2ZW50LCBoYW5kbGVyLCBtb2RpZmllcnMgfSk7XG4gICAgICAgIGRpc3Bvc2UoKTtcbiAgICB9O1xufVxuZnVuY3Rpb24gYXR0cl9kZXYobm9kZSwgYXR0cmlidXRlLCB2YWx1ZSkge1xuICAgIGF0dHIobm9kZSwgYXR0cmlidXRlLCB2YWx1ZSk7XG4gICAgaWYgKHZhbHVlID09IG51bGwpXG4gICAgICAgIGRpc3BhdGNoX2RldihcIlN2ZWx0ZURPTVJlbW92ZUF0dHJpYnV0ZVwiLCB7IG5vZGUsIGF0dHJpYnV0ZSB9KTtcbiAgICBlbHNlXG4gICAgICAgIGRpc3BhdGNoX2RldihcIlN2ZWx0ZURPTVNldEF0dHJpYnV0ZVwiLCB7IG5vZGUsIGF0dHJpYnV0ZSwgdmFsdWUgfSk7XG59XG5mdW5jdGlvbiBwcm9wX2Rldihub2RlLCBwcm9wZXJ0eSwgdmFsdWUpIHtcbiAgICBub2RlW3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIGRpc3BhdGNoX2RldihcIlN2ZWx0ZURPTVNldFByb3BlcnR5XCIsIHsgbm9kZSwgcHJvcGVydHksIHZhbHVlIH0pO1xufVxuZnVuY3Rpb24gZGF0YXNldF9kZXYobm9kZSwgcHJvcGVydHksIHZhbHVlKSB7XG4gICAgbm9kZS5kYXRhc2V0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIGRpc3BhdGNoX2RldihcIlN2ZWx0ZURPTVNldERhdGFzZXRcIiwgeyBub2RlLCBwcm9wZXJ0eSwgdmFsdWUgfSk7XG59XG5mdW5jdGlvbiBzZXRfZGF0YV9kZXYodGV4dCwgZGF0YSkge1xuICAgIGRhdGEgPSAnJyArIGRhdGE7XG4gICAgaWYgKHRleHQud2hvbGVUZXh0ID09PSBkYXRhKVxuICAgICAgICByZXR1cm47XG4gICAgZGlzcGF0Y2hfZGV2KFwiU3ZlbHRlRE9NU2V0RGF0YVwiLCB7IG5vZGU6IHRleHQsIGRhdGEgfSk7XG4gICAgdGV4dC5kYXRhID0gZGF0YTtcbn1cbmZ1bmN0aW9uIHZhbGlkYXRlX2VhY2hfYXJndW1lbnQoYXJnKSB7XG4gICAgaWYgKHR5cGVvZiBhcmcgIT09ICdzdHJpbmcnICYmICEoYXJnICYmIHR5cGVvZiBhcmcgPT09ICdvYmplY3QnICYmICdsZW5ndGgnIGluIGFyZykpIHtcbiAgICAgICAgbGV0IG1zZyA9ICd7I2VhY2h9IG9ubHkgaXRlcmF0ZXMgb3ZlciBhcnJheS1saWtlIG9iamVjdHMuJztcbiAgICAgICAgaWYgKHR5cGVvZiBTeW1ib2wgPT09ICdmdW5jdGlvbicgJiYgYXJnICYmIFN5bWJvbC5pdGVyYXRvciBpbiBhcmcpIHtcbiAgICAgICAgICAgIG1zZyArPSAnIFlvdSBjYW4gdXNlIGEgc3ByZWFkIHRvIGNvbnZlcnQgdGhpcyBpdGVyYWJsZSBpbnRvIGFuIGFycmF5Lic7XG4gICAgICAgIH1cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgfVxufVxuZnVuY3Rpb24gdmFsaWRhdGVfc2xvdHMobmFtZSwgc2xvdCwga2V5cykge1xuICAgIGZvciAoY29uc3Qgc2xvdF9rZXkgb2YgT2JqZWN0LmtleXMoc2xvdCkpIHtcbiAgICAgICAgaWYgKCF+a2V5cy5pbmRleE9mKHNsb3Rfa2V5KSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGA8JHtuYW1lfT4gcmVjZWl2ZWQgYW4gdW5leHBlY3RlZCBzbG90IFwiJHtzbG90X2tleX1cIi5gKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmNsYXNzIFN2ZWx0ZUNvbXBvbmVudERldiBleHRlbmRzIFN2ZWx0ZUNvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3Iob3B0aW9ucykge1xuICAgICAgICBpZiAoIW9wdGlvbnMgfHwgKCFvcHRpb25zLnRhcmdldCAmJiAhb3B0aW9ucy4kJGlubGluZSkpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgJ3RhcmdldCcgaXMgYSByZXF1aXJlZCBvcHRpb25gKTtcbiAgICAgICAgfVxuICAgICAgICBzdXBlcigpO1xuICAgIH1cbiAgICAkZGVzdHJveSgpIHtcbiAgICAgICAgc3VwZXIuJGRlc3Ryb3koKTtcbiAgICAgICAgdGhpcy4kZGVzdHJveSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybihgQ29tcG9uZW50IHdhcyBhbHJlYWR5IGRlc3Ryb3llZGApOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLWNvbnNvbGVcbiAgICAgICAgfTtcbiAgICB9XG4gICAgJGNhcHR1cmVfc3RhdGUoKSB7IH1cbiAgICAkaW5qZWN0X3N0YXRlKCkgeyB9XG59XG5mdW5jdGlvbiBsb29wX2d1YXJkKHRpbWVvdXQpIHtcbiAgICBjb25zdCBzdGFydCA9IERhdGUubm93KCk7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBzdGFydCA+IHRpbWVvdXQpIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgSW5maW5pdGUgbG9vcCBkZXRlY3RlZGApO1xuICAgICAgICB9XG4gICAgfTtcbn1cblxuZXhwb3J0IHsgSHRtbFRhZywgU3ZlbHRlQ29tcG9uZW50LCBTdmVsdGVDb21wb25lbnREZXYsIFN2ZWx0ZUVsZW1lbnQsIGFjdGlvbl9kZXN0cm95ZXIsIGFkZF9hdHRyaWJ1dGUsIGFkZF9jbGFzc2VzLCBhZGRfZmx1c2hfY2FsbGJhY2ssIGFkZF9sb2NhdGlvbiwgYWRkX3JlbmRlcl9jYWxsYmFjaywgYWRkX3Jlc2l6ZV9saXN0ZW5lciwgYWRkX3RyYW5zZm9ybSwgYWZ0ZXJVcGRhdGUsIGFwcGVuZCwgYXBwZW5kX2RldiwgYXNzaWduLCBhdHRyLCBhdHRyX2RldiwgYmVmb3JlVXBkYXRlLCBiaW5kLCBiaW5kaW5nX2NhbGxiYWNrcywgYmxhbmtfb2JqZWN0LCBidWJibGUsIGNoZWNrX291dHJvcywgY2hpbGRyZW4sIGNsYWltX2NvbXBvbmVudCwgY2xhaW1fZWxlbWVudCwgY2xhaW1fc3BhY2UsIGNsYWltX3RleHQsIGNsZWFyX2xvb3BzLCBjb21wb25lbnRfc3Vic2NyaWJlLCBjb21wdXRlX3Jlc3RfcHJvcHMsIGNvbXB1dGVfc2xvdHMsIGNyZWF0ZUV2ZW50RGlzcGF0Y2hlciwgY3JlYXRlX2FuaW1hdGlvbiwgY3JlYXRlX2JpZGlyZWN0aW9uYWxfdHJhbnNpdGlvbiwgY3JlYXRlX2NvbXBvbmVudCwgY3JlYXRlX2luX3RyYW5zaXRpb24sIGNyZWF0ZV9vdXRfdHJhbnNpdGlvbiwgY3JlYXRlX3Nsb3QsIGNyZWF0ZV9zc3JfY29tcG9uZW50LCBjdXJyZW50X2NvbXBvbmVudCwgY3VzdG9tX2V2ZW50LCBkYXRhc2V0X2RldiwgZGVidWcsIGRlc3Ryb3lfYmxvY2ssIGRlc3Ryb3lfY29tcG9uZW50LCBkZXN0cm95X2VhY2gsIGRldGFjaCwgZGV0YWNoX2FmdGVyX2RldiwgZGV0YWNoX2JlZm9yZV9kZXYsIGRldGFjaF9iZXR3ZWVuX2RldiwgZGV0YWNoX2RldiwgZGlydHlfY29tcG9uZW50cywgZGlzcGF0Y2hfZGV2LCBlYWNoLCBlbGVtZW50LCBlbGVtZW50X2lzLCBlbXB0eSwgZXNjYXBlLCBlc2NhcGVkLCBleGNsdWRlX2ludGVybmFsX3Byb3BzLCBmaXhfYW5kX2Rlc3Ryb3lfYmxvY2ssIGZpeF9hbmRfb3V0cm9fYW5kX2Rlc3Ryb3lfYmxvY2ssIGZpeF9wb3NpdGlvbiwgZmx1c2gsIGdldENvbnRleHQsIGdldF9iaW5kaW5nX2dyb3VwX3ZhbHVlLCBnZXRfY3VycmVudF9jb21wb25lbnQsIGdldF9zbG90X2NoYW5nZXMsIGdldF9zbG90X2NvbnRleHQsIGdldF9zcHJlYWRfb2JqZWN0LCBnZXRfc3ByZWFkX3VwZGF0ZSwgZ2V0X3N0b3JlX3ZhbHVlLCBnbG9iYWxzLCBncm91cF9vdXRyb3MsIGhhbmRsZV9wcm9taXNlLCBoYXNfcHJvcCwgaWRlbnRpdHksIGluaXQsIGluc2VydCwgaW5zZXJ0X2RldiwgaW50cm9zLCBpbnZhbGlkX2F0dHJpYnV0ZV9uYW1lX2NoYXJhY3RlciwgaXNfY2xpZW50LCBpc19jcm9zc29yaWdpbiwgaXNfZW1wdHksIGlzX2Z1bmN0aW9uLCBpc19wcm9taXNlLCBsaXN0ZW4sIGxpc3Rlbl9kZXYsIGxvb3AsIGxvb3BfZ3VhcmQsIG1pc3NpbmdfY29tcG9uZW50LCBtb3VudF9jb21wb25lbnQsIG5vb3AsIG5vdF9lcXVhbCwgbm93LCBudWxsX3RvX2VtcHR5LCBvYmplY3Rfd2l0aG91dF9wcm9wZXJ0aWVzLCBvbkRlc3Ryb3ksIG9uTW91bnQsIG9uY2UsIG91dHJvX2FuZF9kZXN0cm95X2Jsb2NrLCBwcmV2ZW50X2RlZmF1bHQsIHByb3BfZGV2LCBxdWVyeV9zZWxlY3Rvcl9hbGwsIHJhZiwgcnVuLCBydW5fYWxsLCBzYWZlX25vdF9lcXVhbCwgc2NoZWR1bGVfdXBkYXRlLCBzZWxlY3RfbXVsdGlwbGVfdmFsdWUsIHNlbGVjdF9vcHRpb24sIHNlbGVjdF9vcHRpb25zLCBzZWxlY3RfdmFsdWUsIHNlbGYsIHNldENvbnRleHQsIHNldF9hdHRyaWJ1dGVzLCBzZXRfY3VycmVudF9jb21wb25lbnQsIHNldF9jdXN0b21fZWxlbWVudF9kYXRhLCBzZXRfZGF0YSwgc2V0X2RhdGFfZGV2LCBzZXRfaW5wdXRfdHlwZSwgc2V0X2lucHV0X3ZhbHVlLCBzZXRfbm93LCBzZXRfcmFmLCBzZXRfc3RvcmVfdmFsdWUsIHNldF9zdHlsZSwgc2V0X3N2Z19hdHRyaWJ1dGVzLCBzcGFjZSwgc3ByZWFkLCBzdG9wX3Byb3BhZ2F0aW9uLCBzdWJzY3JpYmUsIHN2Z19lbGVtZW50LCB0ZXh0LCB0aWNrLCB0aW1lX3Jhbmdlc190b19hcnJheSwgdG9fbnVtYmVyLCB0b2dnbGVfY2xhc3MsIHRyYW5zaXRpb25faW4sIHRyYW5zaXRpb25fb3V0LCB1cGRhdGVfa2V5ZWRfZWFjaCwgdXBkYXRlX3Nsb3QsIHZhbGlkYXRlX2NvbXBvbmVudCwgdmFsaWRhdGVfZWFjaF9hcmd1bWVudCwgdmFsaWRhdGVfZWFjaF9rZXlzLCB2YWxpZGF0ZV9zbG90cywgdmFsaWRhdGVfc3RvcmUsIHhsaW5rX2F0dHIgfTtcbiIsImltcG9ydCB7IG5vb3AsIHNhZmVfbm90X2VxdWFsLCBzdWJzY3JpYmUsIHJ1bl9hbGwsIGlzX2Z1bmN0aW9uIH0gZnJvbSAnLi4vaW50ZXJuYWwnO1xuZXhwb3J0IHsgZ2V0X3N0b3JlX3ZhbHVlIGFzIGdldCB9IGZyb20gJy4uL2ludGVybmFsJztcblxuY29uc3Qgc3Vic2NyaWJlcl9xdWV1ZSA9IFtdO1xuLyoqXG4gKiBDcmVhdGVzIGEgYFJlYWRhYmxlYCBzdG9yZSB0aGF0IGFsbG93cyByZWFkaW5nIGJ5IHN1YnNjcmlwdGlvbi5cbiAqIEBwYXJhbSB2YWx1ZSBpbml0aWFsIHZhbHVlXG4gKiBAcGFyYW0ge1N0YXJ0U3RvcE5vdGlmaWVyfXN0YXJ0IHN0YXJ0IGFuZCBzdG9wIG5vdGlmaWNhdGlvbnMgZm9yIHN1YnNjcmlwdGlvbnNcbiAqL1xuZnVuY3Rpb24gcmVhZGFibGUodmFsdWUsIHN0YXJ0KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgc3Vic2NyaWJlOiB3cml0YWJsZSh2YWx1ZSwgc3RhcnQpLnN1YnNjcmliZVxuICAgIH07XG59XG4vKipcbiAqIENyZWF0ZSBhIGBXcml0YWJsZWAgc3RvcmUgdGhhdCBhbGxvd3MgYm90aCB1cGRhdGluZyBhbmQgcmVhZGluZyBieSBzdWJzY3JpcHRpb24uXG4gKiBAcGFyYW0geyo9fXZhbHVlIGluaXRpYWwgdmFsdWVcbiAqIEBwYXJhbSB7U3RhcnRTdG9wTm90aWZpZXI9fXN0YXJ0IHN0YXJ0IGFuZCBzdG9wIG5vdGlmaWNhdGlvbnMgZm9yIHN1YnNjcmlwdGlvbnNcbiAqL1xuZnVuY3Rpb24gd3JpdGFibGUodmFsdWUsIHN0YXJ0ID0gbm9vcCkge1xuICAgIGxldCBzdG9wO1xuICAgIGNvbnN0IHN1YnNjcmliZXJzID0gW107XG4gICAgZnVuY3Rpb24gc2V0KG5ld192YWx1ZSkge1xuICAgICAgICBpZiAoc2FmZV9ub3RfZXF1YWwodmFsdWUsIG5ld192YWx1ZSkpIHtcbiAgICAgICAgICAgIHZhbHVlID0gbmV3X3ZhbHVlO1xuICAgICAgICAgICAgaWYgKHN0b3ApIHsgLy8gc3RvcmUgaXMgcmVhZHlcbiAgICAgICAgICAgICAgICBjb25zdCBydW5fcXVldWUgPSAhc3Vic2NyaWJlcl9xdWV1ZS5sZW5ndGg7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdWJzY3JpYmVycy5sZW5ndGg7IGkgKz0gMSkge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBzID0gc3Vic2NyaWJlcnNbaV07XG4gICAgICAgICAgICAgICAgICAgIHNbMV0oKTtcbiAgICAgICAgICAgICAgICAgICAgc3Vic2NyaWJlcl9xdWV1ZS5wdXNoKHMsIHZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHJ1bl9xdWV1ZSkge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN1YnNjcmliZXJfcXVldWUubGVuZ3RoOyBpICs9IDIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXJfcXVldWVbaV1bMF0oc3Vic2NyaWJlcl9xdWV1ZVtpICsgMV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHN1YnNjcmliZXJfcXVldWUubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgZnVuY3Rpb24gdXBkYXRlKGZuKSB7XG4gICAgICAgIHNldChmbih2YWx1ZSkpO1xuICAgIH1cbiAgICBmdW5jdGlvbiBzdWJzY3JpYmUocnVuLCBpbnZhbGlkYXRlID0gbm9vcCkge1xuICAgICAgICBjb25zdCBzdWJzY3JpYmVyID0gW3J1biwgaW52YWxpZGF0ZV07XG4gICAgICAgIHN1YnNjcmliZXJzLnB1c2goc3Vic2NyaWJlcik7XG4gICAgICAgIGlmIChzdWJzY3JpYmVycy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgIHN0b3AgPSBzdGFydChzZXQpIHx8IG5vb3A7XG4gICAgICAgIH1cbiAgICAgICAgcnVuKHZhbHVlKTtcbiAgICAgICAgcmV0dXJuICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ID0gc3Vic2NyaWJlcnMuaW5kZXhPZihzdWJzY3JpYmVyKTtcbiAgICAgICAgICAgIGlmIChpbmRleCAhPT0gLTEpIHtcbiAgICAgICAgICAgICAgICBzdWJzY3JpYmVycy5zcGxpY2UoaW5kZXgsIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHN1YnNjcmliZXJzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHN0b3AoKTtcbiAgICAgICAgICAgICAgICBzdG9wID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9XG4gICAgcmV0dXJuIHsgc2V0LCB1cGRhdGUsIHN1YnNjcmliZSB9O1xufVxuZnVuY3Rpb24gZGVyaXZlZChzdG9yZXMsIGZuLCBpbml0aWFsX3ZhbHVlKSB7XG4gICAgY29uc3Qgc2luZ2xlID0gIUFycmF5LmlzQXJyYXkoc3RvcmVzKTtcbiAgICBjb25zdCBzdG9yZXNfYXJyYXkgPSBzaW5nbGVcbiAgICAgICAgPyBbc3RvcmVzXVxuICAgICAgICA6IHN0b3JlcztcbiAgICBjb25zdCBhdXRvID0gZm4ubGVuZ3RoIDwgMjtcbiAgICByZXR1cm4gcmVhZGFibGUoaW5pdGlhbF92YWx1ZSwgKHNldCkgPT4ge1xuICAgICAgICBsZXQgaW5pdGVkID0gZmFsc2U7XG4gICAgICAgIGNvbnN0IHZhbHVlcyA9IFtdO1xuICAgICAgICBsZXQgcGVuZGluZyA9IDA7XG4gICAgICAgIGxldCBjbGVhbnVwID0gbm9vcDtcbiAgICAgICAgY29uc3Qgc3luYyA9ICgpID0+IHtcbiAgICAgICAgICAgIGlmIChwZW5kaW5nKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2xlYW51cCgpO1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gZm4oc2luZ2xlID8gdmFsdWVzWzBdIDogdmFsdWVzLCBzZXQpO1xuICAgICAgICAgICAgaWYgKGF1dG8pIHtcbiAgICAgICAgICAgICAgICBzZXQocmVzdWx0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGNsZWFudXAgPSBpc19mdW5jdGlvbihyZXN1bHQpID8gcmVzdWx0IDogbm9vcDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgdW5zdWJzY3JpYmVycyA9IHN0b3Jlc19hcnJheS5tYXAoKHN0b3JlLCBpKSA9PiBzdWJzY3JpYmUoc3RvcmUsICh2YWx1ZSkgPT4ge1xuICAgICAgICAgICAgdmFsdWVzW2ldID0gdmFsdWU7XG4gICAgICAgICAgICBwZW5kaW5nICY9IH4oMSA8PCBpKTtcbiAgICAgICAgICAgIGlmIChpbml0ZWQpIHtcbiAgICAgICAgICAgICAgICBzeW5jKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sICgpID0+IHtcbiAgICAgICAgICAgIHBlbmRpbmcgfD0gKDEgPDwgaSk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgaW5pdGVkID0gdHJ1ZTtcbiAgICAgICAgc3luYygpO1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24gc3RvcCgpIHtcbiAgICAgICAgICAgIHJ1bl9hbGwodW5zdWJzY3JpYmVycyk7XG4gICAgICAgICAgICBjbGVhbnVwKCk7XG4gICAgICAgIH07XG4gICAgfSk7XG59XG5cbmV4cG9ydCB7IGRlcml2ZWQsIHJlYWRhYmxlLCB3cml0YWJsZSB9O1xuIiwiaW1wb3J0IHsgc2FtcGxlUmF0ZSB9IGZyb20gXCIuLi9wcm9jZXNzb3JcIjtcbmxldCBvZmZzY3JlZW47XG5sZXQgZ2w7XG5sZXQgdmVydGljZXM7XG5sZXQgcHJvZ3JhbTtcbmxldCByZW5kZXJQYXJhbXMgPSBudWxsO1xubGV0IGluaXRpYWxpc2VkID0gZmFsc2U7XG5zZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoeyBkYXRhIH0pID0+IHtcbiAgICBpZiAoZGF0YS50eXBlID09PSBcImNyZWF0ZVwiKSB7XG4gICAgICAgIHNldHVwKGRhdGEpO1xuICAgICAgICBpbml0aWFsaXNlZCA9IHRydWU7XG4gICAgfVxuICAgIGVsc2UgaWYgKGluaXRpYWxpc2VkKSB7XG4gICAgICAgIGlmIChkYXRhLnR5cGUgPT09IFwidXBkYXRlX3Njcm9sbFwiKSB7XG4gICAgICAgICAgICByZW5kZXJQYXJhbXMuc2Nyb2xsID0gZGF0YS5zY3JvbGw7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoZGF0YS50eXBlID09PSBcInVwZGF0ZV96b29tXCIpIHtcbiAgICAgICAgICAgIHJlbmRlclBhcmFtcy5waXhlbHNQZXJTZWNvbmQgPSBkYXRhLnBpeGVsc1BlclNlY29uZDtcbiAgICAgICAgICAgIHJlbmRlclBhcmFtcy5zY3JvbGwgPSBkYXRhLnNjcm9sbDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChkYXRhLnR5cGUgPT09IFwidXBkYXRlX3NpemVcIikge1xuICAgICAgICAgICAgcmVuZGVyUGFyYW1zLndpZHRoID0gZGF0YS53aWR0aDtcbiAgICAgICAgICAgIHJlbmRlclBhcmFtcy5oZWlnaHQgPSBkYXRhLmhlaWdodDtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IHsgaWR4LCBzdGFydCwgZHVyYXRpb24gfSA9IGRhdGEudG9rZW47XG4gICAgICAgICAgICBjb25zdCB0b2tlbiA9IHJlbmRlclBhcmFtcy50b2tlbnNbaWR4XTtcbiAgICAgICAgICAgIHRva2VuLmR1cmF0aW9uID0gZHVyYXRpb247XG4gICAgICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJBVURJT1wiICYmIHN0YXJ0ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICB0b2tlbi5zdGFydCA9IHN0YXJ0O1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGRyYXdXYXZlZm9ybSgpO1xuICAgIH1cbn0pO1xuZnVuY3Rpb24gc2V0dXAoeyBjYW52YXMsIGNoYW5uZWwsIGluaXRpYWxWYWx1ZXMgfSkge1xuICAgIHJlbmRlclBhcmFtcyA9IGluaXRpYWxWYWx1ZXM7XG4gICAgb2Zmc2NyZWVuID0gY2FudmFzO1xuICAgIGdsID0gY2FudmFzLmdldENvbnRleHQoXCJ3ZWJnbDJcIiwgeyBwcmVzZXJ2ZURyYXdpbmdCdWZmZXI6IHRydWUsIGRlc3luY2hyb25pemVkOiB0cnVlIH0pO1xuICAgIHZlcnRpY2VzID0gcHJlcHJvY2VzcyhjaGFubmVsKTtcbiAgICBpbml0KCk7XG59XG5mdW5jdGlvbiBwcmVwcm9jZXNzKGNoYW5uZWwpIHtcbiAgICBjb25zdCBvdXRwdXRMZW5ndGggPSBjaGFubmVsLmxlbmd0aCAqIDI7XG4gICAgY29uc3Qgb3V0cHV0ID0gbmV3IEZsb2F0MzJBcnJheShvdXRwdXRMZW5ndGgpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2hhbm5lbC5sZW5ndGg7IGkrKykge1xuICAgICAgICBjb25zdCBpZHggPSBpICogMjtcbiAgICAgICAgb3V0cHV0W2lkeF0gPSBpIC8gc2FtcGxlUmF0ZTtcbiAgICAgICAgb3V0cHV0W2lkeCArIDFdID0gY2hhbm5lbFtpXTtcbiAgICB9XG4gICAgcmV0dXJuIG91dHB1dDtcbn1cbmZ1bmN0aW9uIGRyYXdXYXZlZm9ybSgpIHtcbiAgICBjb25zdCB7IHRva2VucywgcGl4ZWxzUGVyU2Vjb25kLCBzY3JvbGwsIHdpZHRoLCBoZWlnaHQgfSA9IHJlbmRlclBhcmFtcztcbiAgICBvZmZzY3JlZW4ud2lkdGggPSB3aWR0aDtcbiAgICBvZmZzY3JlZW4uaGVpZ2h0ID0gaGVpZ2h0O1xuICAgIGdsLnZpZXdwb3J0KDAsIDAsIHdpZHRoLCBoZWlnaHQpO1xuICAgIGdsLmNsZWFyQ29sb3IoMS4wLCAxLjAsIDEuMCwgMS4wKTtcbiAgICBnbC5jbGVhcihnbC5DT0xPUl9CVUZGRVJfQklUKTtcbiAgICBjb25zdCBwaXhlbHNQZXJDbGlwID0gd2lkdGggLyAyO1xuICAgIGNvbnN0IHNlY29uZHNQZXJDbGlwID0gcGl4ZWxzUGVyQ2xpcCAvIHBpeGVsc1BlclNlY29uZDtcbiAgICBjb25zdCBtaW5TZWNzID0gc2Nyb2xsIC0gc2Vjb25kc1BlckNsaXA7XG4gICAgY29uc3QgbWF4U2VjcyA9IHNjcm9sbCArIHNlY29uZHNQZXJDbGlwO1xuICAgIGxldCB0aW1lY29kZSA9IDA7XG4gICAgY29uc3QgdmlzaWJsZVRva2VucyA9IHRva2Vucy5maWx0ZXIodG9rZW4gPT4gdG9rZW4udHlwZSAhPT0gXCJOT1RISU5HXCIpO1xuICAgIGZvciAoY29uc3QgdG9rZW4gb2YgdmlzaWJsZVRva2Vucykge1xuICAgICAgICBjb25zdCBkcmF3QXRUaW1lID0gTWF0aC5tYXgobWluU2VjcywgdGltZWNvZGUpO1xuICAgICAgICBjb25zdCBjcm9wcGVkRnJvbVN0YXJ0ID0gZHJhd0F0VGltZSAtIHRpbWVjb2RlO1xuICAgICAgICBjb25zdCBzdGFydEFkanVzdGVkRHVyYXRpb24gPSB0b2tlbi5kdXJhdGlvbiAtIGNyb3BwZWRGcm9tU3RhcnQ7XG4gICAgICAgIGNvbnN0IG1heER1cmF0aW9uID0gbWF4U2VjcyAtIGRyYXdBdFRpbWU7XG4gICAgICAgIGNvbnN0IGVuZEFkanVzdGVkRHVyYXRpb24gPSBNYXRoLm1pbihtYXhEdXJhdGlvbiwgc3RhcnRBZGp1c3RlZER1cmF0aW9uKTtcbiAgICAgICAgaWYgKGVuZEFkanVzdGVkRHVyYXRpb24gPiAwKSB7XG4gICAgICAgICAgICBzZXRTY2FsZShwaXhlbHNQZXJTZWNvbmQpO1xuICAgICAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IFwiQVVESU9cIikge1xuICAgICAgICAgICAgICAgIGNvbnN0IHRva2VuT2Zmc2V0ID0gdG9rZW4uc3RhcnQgKyBjcm9wcGVkRnJvbVN0YXJ0O1xuICAgICAgICAgICAgICAgIGRyYXdTZWN0aW9uKGRyYXdBdFRpbWUsIHRva2VuT2Zmc2V0LCBlbmRBZGp1c3RlZER1cmF0aW9uLCBzY3JvbGwpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZHJhd091dGxpbmUoZHJhd0F0VGltZSwgZW5kQWRqdXN0ZWREdXJhdGlvbiwgc2Nyb2xsKTtcbiAgICAgICAgfVxuICAgICAgICB0aW1lY29kZSArPSB0b2tlbi5kdXJhdGlvbjtcbiAgICB9XG59XG5mdW5jdGlvbiBzZXRTY2FsZShwaXhlbHNQZXJTZWNvbmQpIHtcbiAgICBjb25zdCBsaW5lQ291bnQgPSB2ZXJ0aWNlcy5sZW5ndGggLyAyO1xuICAgIGNvbnN0IHRvdGFsRHVyYXRpb24gPSBsaW5lQ291bnQgLyBzYW1wbGVSYXRlO1xuICAgIGNvbnN0IHBpeGVsc1BlckNsaXAgPSBvZmZzY3JlZW4ud2lkdGggLyAyO1xuICAgIGNvbnN0IHRvdGFsQ2xpcCA9IGxpbmVDb3VudCAvIHBpeGVsc1BlckNsaXA7XG4gICAgY29uc3Qgc2Vjb25kc1RvQ2xpcFNjYWxlID0gdG90YWxDbGlwIC8gdG90YWxEdXJhdGlvbjtcbiAgICBjb25zdCBkaXNwbGF5U2NhbGUgPSBwaXhlbHNQZXJTZWNvbmQgLyBzYW1wbGVSYXRlO1xuICAgIGNvbnN0IHNjYWxlID0gc2Vjb25kc1RvQ2xpcFNjYWxlICogZGlzcGxheVNjYWxlO1xuICAgIGNvbnN0IHNjYWxlTG9jID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKHByb2dyYW0sIFwidV9zY2FsZVwiKTtcbiAgICBnbC51bmlmb3JtNGZ2KHNjYWxlTG9jLCBbc2NhbGUsIDEsIDEsIDFdKTtcbn1cbmZ1bmN0aW9uIGRyYXdTZWN0aW9uKGRyYXdBdFRpbWUsIHRva2VuT2Zmc2V0LCB0b2tlbkR1cmF0aW9uLCBzY3JvbGwpIHtcbiAgICBjb25zdCBzdGFydFZlcnRleCA9IE1hdGgucm91bmQodG9rZW5PZmZzZXQgKiBzYW1wbGVSYXRlKTtcbiAgICBjb25zdCBuYXR1cmFsVGltZSA9IHZlcnRpY2VzW3N0YXJ0VmVydGV4ICogMl07XG4gICAgY29uc3Qgb2Zmc2V0ID0gZHJhd0F0VGltZSAtIG5hdHVyYWxUaW1lIC0gc2Nyb2xsO1xuICAgIGNvbnN0IG9mZnNldExvYyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcInVfb2Zmc2V0XCIpO1xuICAgIGdsLnVuaWZvcm00ZnYob2Zmc2V0TG9jLCBbb2Zmc2V0LCAwLCAwLCAwXSk7XG4gICAgY29uc3QgdmVydGV4Q291bnQgPSBNYXRoLnJvdW5kKHRva2VuRHVyYXRpb24gKiBzYW1wbGVSYXRlKTtcbiAgICBjb25zdCBzdGFydCA9IE1hdGgubWF4KDAsIHN0YXJ0VmVydGV4IC0gMSk7XG4gICAgY29uc3QgZW5kID0gTWF0aC5taW4odmVydGljZXMubGVuZ3RoIC8gMiwgc3RhcnQgKyB2ZXJ0ZXhDb3VudCArIDIpO1xuICAgIGdsLmRyYXdBcnJheXMoZ2wuTElORV9TVFJJUCwgc3RhcnQsIGVuZCAtIHN0YXJ0KTtcbn1cbmZ1bmN0aW9uIGRyYXdPdXRsaW5lKGRyYXdBdFRpbWUsIHRva2VuRHVyYXRpb24sIHNjcm9sbCkge1xuICAgIGNvbnN0IG9mZnNldExvYyA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcInVfb2Zmc2V0XCIpO1xuICAgIGdsLnVuaWZvcm00ZnYob2Zmc2V0TG9jLCBbZHJhd0F0VGltZSAtIHNjcm9sbCwgMCwgMCwgMF0pO1xuICAgIGNvbnN0IG91dGxpbmUgPSBuZXcgRmxvYXQzMkFycmF5KFswLCAtMSwgMCwgMSwgdG9rZW5EdXJhdGlvbiwgMSwgdG9rZW5EdXJhdGlvbiwgLTFdKTtcbiAgICBnbC5idWZmZXJTdWJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdmVydGljZXMubGVuZ3RoICogdmVydGljZXMuQllURVNfUEVSX0VMRU1FTlQsIG91dGxpbmUpO1xuICAgIGdsLmRyYXdBcnJheXMoZ2wuTElORV9MT09QLCB2ZXJ0aWNlcy5sZW5ndGggLyAyLCA0KTtcbn1cbmNvbnN0IHZlY3RvclNoYWRlciA9IGBcbiAgdW5pZm9ybSB2ZWM0IHVfb2Zmc2V0O1xuICB1bmlmb3JtIHZlYzQgdV9zY2FsZTtcbiAgYXR0cmlidXRlIHZlYzQgYV9Qb3NpdGlvbjtcbiAgdm9pZCBtYWluKCkge1xuICAgIGdsX1Bvc2l0aW9uID0gdV9zY2FsZSAqIChhX1Bvc2l0aW9uICsgdV9vZmZzZXQpO1xuICB9XG5gO1xuY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBgXG4gIHZvaWQgbWFpbigpIHtcbiAgICBnbF9GcmFnQ29sb3IgPSB2ZWM0KDAuMCwgMC4wLCAwLjAsIDEuMCk7XG4gIH1cbmA7XG5mdW5jdGlvbiBpbml0KCkge1xuICAgIHByb2dyYW0gPSBpbml0U2hhZGVycyhnbCwgdmVjdG9yU2hhZGVyLCBmcmFnbWVudFNoYWRlcik7XG4gICAgY29uc3QgYnVmZmVycyA9IGluaXRWZXJ0ZXhCdWZmZXJzKGdsLCBwcm9ncmFtKTtcbiAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xuICAgIHJldHVybiBidWZmZXJzO1xufVxuZnVuY3Rpb24gaW5pdFNoYWRlcnMoZ2wsIHZzX3NvdXJjZSwgZnNfc291cmNlKSB7XG4gICAgY29uc3QgdmVydGV4U2hhZGVyID0gbWFrZVNoYWRlcihnbCwgdnNfc291cmNlLCBnbC5WRVJURVhfU0hBREVSKTtcbiAgICBjb25zdCBmcmFnbWVudFNoYWRlciA9IG1ha2VTaGFkZXIoZ2wsIGZzX3NvdXJjZSwgZ2wuRlJBR01FTlRfU0hBREVSKTtcbiAgICBjb25zdCBnbFByb2dyYW0gPSBnbC5jcmVhdGVQcm9ncmFtKCk7XG4gICAgaWYgKCFnbFByb2dyYW0pXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgcHJvZ3JhbVwiKTtcbiAgICBnbC5hdHRhY2hTaGFkZXIoZ2xQcm9ncmFtLCB2ZXJ0ZXhTaGFkZXIpO1xuICAgIGdsLmF0dGFjaFNoYWRlcihnbFByb2dyYW0sIGZyYWdtZW50U2hhZGVyKTtcbiAgICBnbC5saW5rUHJvZ3JhbShnbFByb2dyYW0pO1xuICAgIGlmICghZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlcihnbFByb2dyYW0sIGdsLkxJTktfU1RBVFVTKSkge1xuICAgICAgICBhbGVydCgnVW5hYmxlIHRvIGluaXRpYWxpemUgdGhlIHNoYWRlciBwcm9ncmFtOiAnICsgZ2wuZ2V0UHJvZ3JhbUluZm9Mb2coZ2xQcm9ncmFtKSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgcHJvZ3JhbVwiKTtcbiAgICB9XG4gICAgcmV0dXJuIGdsUHJvZ3JhbTtcbn1cbmZ1bmN0aW9uIGluaXRWZXJ0ZXhCdWZmZXJzKGdsLCBwcm9ncmFtKSB7XG4gICAgY29uc3QgYnVmZmVyID0gZ2wuY3JlYXRlQnVmZmVyKCk7XG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlcik7XG4gICAgY29uc3QgYV9Qb3NpdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sICdhX1Bvc2l0aW9uJyk7XG4gICAgZ2wudmVydGV4QXR0cmliUG9pbnRlcihhX1Bvc2l0aW9uLCAyLCBnbC5GTE9BVCwgZmFsc2UsIDAsIDApO1xuICAgIGdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KGFfUG9zaXRpb24pO1xuICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCAodmVydGljZXMubGVuZ3RoICsgOCkgKiB2ZXJ0aWNlcy5CWVRFU19QRVJfRUxFTUVOVCwgZ2wuU1RBVElDX0RSQVcpO1xuICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCAwLCB2ZXJ0aWNlcyk7XG59XG5mdW5jdGlvbiBtYWtlU2hhZGVyKGdsLCBzcmMsIHR5cGUpIHtcbiAgICBjb25zdCBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIodHlwZSk7XG4gICAgaWYgKCFzaGFkZXIpXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBjcmVhdGUgc2hhZGVyXCIpO1xuICAgIGdsLnNoYWRlclNvdXJjZShzaGFkZXIsIHNyYyk7XG4gICAgZ2wuY29tcGlsZVNoYWRlcihzaGFkZXIpO1xuICAgIGlmICghZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgZ2wuQ09NUElMRV9TVEFUVVMpKSB7XG4gICAgICAgIGFsZXJ0KCdBbiBlcnJvciBvY2N1cnJlZCBjb21waWxpbmcgdGhlIHNoYWRlcnM6ICcgKyBnbC5nZXRTaGFkZXJJbmZvTG9nKHNoYWRlcikpO1xuICAgICAgICBnbC5kZWxldGVTaGFkZXIoc2hhZGVyKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGNyZWF0ZSBzaGFkZXJcIik7XG4gICAgfVxuICAgIHJldHVybiBzaGFkZXI7XG59XG4iLCIvL0B0cy1pZ25vcmVcbmltcG9ydCB0b1dhdiBmcm9tIFwiYXVkaW9idWZmZXItdG8td2F2XCI7XG5pbXBvcnQgZG93bmxvYWQgZnJvbSBcImRvd25sb2FkanNcIjtcbmltcG9ydCB7IHdyaXRhYmxlIH0gZnJvbSBcInN2ZWx0ZS9zdG9yZVwiO1xuZXhwb3J0IGNvbnN0IHNhbXBsZVJhdGUgPSA0NDEwMDtcbmxldCBhdWRpb0NvbnRleHQgPSBudWxsO1xuZXhwb3J0IGZ1bmN0aW9uIGdldEF1ZGlvQ29udGV4dCgpIHtcbiAgICBpZiAoIWF1ZGlvQ29udGV4dCkge1xuICAgICAgICBhdWRpb0NvbnRleHQgPSBuZXcgQXVkaW9Db250ZXh0KHsgc2FtcGxlUmF0ZSB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGF1ZGlvQ29udGV4dDtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjcmVhdGVFZGl0b3JUb2tlbnModG9rZW5zLCBidWZmZXIpIHtcbiAgICBjb25zdCBlbnZlbG9wZSA9IGF3YWl0IHRvRW52ZWxvcGUoYnVmZmVyKTtcbiAgICBjb25zdCBlbnZlbG9wZUNoYW5uZWwgPSBlbnZlbG9wZS5nZXRDaGFubmVsRGF0YSgwKTtcbiAgICByZXR1cm4gdG9rZW5zLm1hcCh0b2tlbiA9PiB7XG4gICAgICAgIGlmICh0b2tlbi50eXBlICE9PSBcIlRJTUlOR1wiKVxuICAgICAgICAgICAgcmV0dXJuIHRva2VuO1xuICAgICAgICAvLyBTdGFydCB3aXRoIFNwZWVjaCBSZWNvZ25pdGlvbiBBUEkncyBiZXN0IGd1ZXNzIGFkanVzdGVkIHNsaWdodGx5IGZvciBsYXRlbmN5XG4gICAgICAgIGNvbnN0IG9yaWdpbmFsU3RhcnRTZWNzID0gdG9rZW4udGltaW5ncy5zdGFydCAvIDEwMDA7XG4gICAgICAgIGxldCBzdGFydFNlYXJjaFNhbXBsZSA9IE1hdGgubWF4KDAsIE1hdGgucm91bmQoKG9yaWdpbmFsU3RhcnRTZWNzIC0gMC41KSAqIHNhbXBsZVJhdGUpKTtcbiAgICAgICAgY29uc3Qgb3JpZ2luYWxFbmRTZWNzID0gdG9rZW4udGltaW5ncy5lbmQgLyAxMDAwO1xuICAgICAgICBsZXQgZW5kU2VhcmNoU2FtcGxlID0gTWF0aC5taW4oZW52ZWxvcGVDaGFubmVsLmxlbmd0aCwgTWF0aC5yb3VuZCgob3JpZ2luYWxFbmRTZWNzICsgMC41KSAqIHNhbXBsZVJhdGUpKTtcbiAgICAgICAgbGV0IG1heFZvbHVtZSA9IDA7XG4gICAgICAgIGZvciAobGV0IGkgPSBzdGFydFNlYXJjaFNhbXBsZTsgaSA8IGVuZFNlYXJjaFNhbXBsZTsgaSsrKSB7XG4gICAgICAgICAgICBtYXhWb2x1bWUgPSBNYXRoLm1heChtYXhWb2x1bWUsIGVudmVsb3BlQ2hhbm5lbFtpXSk7XG4gICAgICAgIH1cbiAgICAgICAgY29uc3Qgc3BlZWNoVGhyZXNob2xkID0gMC4yICogbWF4Vm9sdW1lO1xuICAgICAgICBjb25zdCBzaWxlbmNlVGhyZXNob2xkID0gMC4wMyAqIG1heFZvbHVtZTtcbiAgICAgICAgY29uc3Qgc2lsZW5jZUNvdW50ID0gMC4xICogc2FtcGxlUmF0ZTsgLy8gMC4xIHNlY29uZHMgb2Ygc2lsZW5jZVxuICAgICAgICAvLyBFeHBhbmQgdW50aWwgeW91IGhpdCBzaWxlbmNlIChvZnRlbiBpbW1lZGlhdGVseSlcbiAgICAgICAgLy8gVG8gaGFuZGxlIGNhc2Ugd2hlcmUgc3BlZWNoIHJlY29nbml0aW9uIGVuZGVkIGVhcmx5XG4gICAgICAgIHtcbiAgICAgICAgICAgIGxldCBjb3VudCA9IDA7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gc3RhcnRTZWFyY2hTYW1wbGU7IGkgPj0gMDsgaS0tKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbnZlbG9wZUNoYW5uZWxbaV07XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDw9IHNpbGVuY2VUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gc2lsZW5jZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFNlYXJjaFNhbXBsZSA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGVuZFNlYXJjaFNhbXBsZTsgaSA8IGVudmVsb3BlQ2hhbm5lbC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZW52ZWxvcGVDaGFubmVsW2ldO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8PSBzaWxlbmNlVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IHNpbGVuY2VDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kU2VhcmNoU2FtcGxlID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIE1vdmUgaW4gdG8gZmluZCBzcGVlY2hcbiAgICAgICAgLy8gVG8gaGFuZGxlIGNhc2Ugd2hlcmUgc3BlZWNoIHJlY29nbml0aW9uIGVuZGVkIGxhdGVcbiAgICAgICAgbGV0IHN0YXJ0U2FtcGxlID0gbnVsbDtcbiAgICAgICAgZm9yIChsZXQgaSA9IHN0YXJ0U2VhcmNoU2FtcGxlOyBpIDw9IGVuZFNlYXJjaFNhbXBsZTsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCB2YWx1ZSA9IGVudmVsb3BlQ2hhbm5lbFtpXTtcbiAgICAgICAgICAgIGlmICh2YWx1ZSA+PSBzcGVlY2hUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICBzdGFydFNhbXBsZSA9IGk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbGV0IGVuZFNhbXBsZSA9IG51bGw7XG4gICAgICAgIGZvciAobGV0IGkgPSBlbmRTZWFyY2hTYW1wbGU7IGkgPj0gc3RhcnRTZWFyY2hTYW1wbGU7IGktLSkge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbnZlbG9wZUNoYW5uZWxbaV07XG4gICAgICAgICAgICBpZiAodmFsdWUgPj0gc3BlZWNoVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgZW5kU2FtcGxlID0gaTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICAvLyBNb3ZlIG91dCB0byBmaW5kIHNpbGVuY2VcbiAgICAgICAgLy8gVG8gaGFuZGxlIGNhc2Ugd2hlcmUgc3BlZWNoIGhhcyBzbG93IHJhbXAgaW4vb3V0XG4gICAgICAgIGlmIChzdGFydFNhbXBsZSkge1xuICAgICAgICAgICAgbGV0IGNvdW50ID0gMDtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSBzdGFydFNhbXBsZTsgaSA+PSBzdGFydFNlYXJjaFNhbXBsZTsgaS0tKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBlbnZlbG9wZUNoYW5uZWxbaV07XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlIDw9IHNpbGVuY2VUaHJlc2hvbGQpIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQrKztcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdW50ID4gc2lsZW5jZUNvdW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGFydFNhbXBsZSA9IGk7XG4gICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY291bnQgPSAwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZW5kU2FtcGxlKSB7XG4gICAgICAgICAgICBsZXQgY291bnQgPSAwO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IGVuZFNhbXBsZTsgaSA8PSBlbmRTZWFyY2hTYW1wbGU7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZW52ZWxvcGVDaGFubmVsW2ldO1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZSA8PSBzaWxlbmNlVGhyZXNob2xkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjb3VudCA+IHNpbGVuY2VDb3VudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZW5kU2FtcGxlID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjb3VudCA9IDA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN0YXJ0U2VjcyA9IHN0YXJ0U2FtcGxlID09PSBudWxsID8gb3JpZ2luYWxTdGFydFNlY3MgLSAwLjUgOiBzdGFydFNhbXBsZSAvIHNhbXBsZVJhdGU7XG4gICAgICAgIGNvbnN0IGVuZFNlY3MgPSBlbmRTYW1wbGUgPT09IG51bGwgPyBvcmlnaW5hbEVuZFNlY3MgLSAwLjI1IDogZW5kU2FtcGxlIC8gc2FtcGxlUmF0ZSArIDAuMDU7XG4gICAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kU2VjcyAtIHN0YXJ0U2VjcztcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHR5cGU6IFwiQVVESU9cIixcbiAgICAgICAgICAgIGlkeDogdG9rZW4uaWR4LFxuICAgICAgICAgICAgc3RhcnQ6IHN0YXJ0U2VjcyxcbiAgICAgICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgICAgIGJ1ZmZlcjogYnVmZmVyLFxuICAgICAgICAgICAgc3RvcDogKCkgPT4geyB9XG4gICAgICAgIH07XG4gICAgfSk7XG59XG5leHBvcnQgY29uc3QgYXVkaW9TdGF0dXNTdG9yZSA9IHdyaXRhYmxlKHsgdHlwZTogXCJTVE9QUEVEXCIgfSk7XG5sZXQgYXVkaW9TdGF0ZTtcbmF1ZGlvU3RhdHVzU3RvcmUuc3Vic2NyaWJlKHN0YXRlID0+IHtcbiAgICBhdWRpb1N0YXRlID0gc3RhdGU7XG59KTtcbmV4cG9ydCBmdW5jdGlvbiBnZXRDdXJyZW50VGltZSgpIHtcbiAgICBpZiAoYXVkaW9TdGF0ZS50eXBlID09PSBcIlBMQVlJTkdcIikge1xuICAgICAgICByZXR1cm4gZ2V0QXVkaW9Db250ZXh0KCkuY3VycmVudFRpbWUgLSBhdWRpb1N0YXRlLmN0eFN0YXJ0VGltZTtcbiAgICB9XG4gICAgcmV0dXJuIC0xO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHBsYXkodG9rZW5zLCBzdGFydFRpbWUgPSAwKSB7XG4gICAgc3RvcCh0b2tlbnMpO1xuICAgIGNvbnN0IGN0eCA9IGdldEF1ZGlvQ29udGV4dCgpO1xuICAgIGNvbnN0IGN1cnJlbnRUaW1lID0gY3R4LmN1cnJlbnRUaW1lO1xuICAgIGxldCB0aW1lT2Zmc2V0ID0gMDtcbiAgICB0b2tlbnMuZm9yRWFjaCgodG9rZW4pID0+IHtcbiAgICAgICAgaWYgKHRva2VuLnR5cGUgPT09IFwiUEFVU0VcIiB8fCB0b2tlbi50eXBlID09PSBcIlBBUkFHUkFQSFwiKSB7XG4gICAgICAgICAgICB0aW1lT2Zmc2V0ICs9IHRva2VuLmR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKHRva2VuLnR5cGUgPT09IFwiQVVESU9cIikge1xuICAgICAgICAgICAgY29uc3QgZmluaXNoVGltZU9mZnNldCA9IHRpbWVPZmZzZXQgKyB0b2tlbi5kdXJhdGlvbjtcbiAgICAgICAgICAgIGlmICh0aW1lT2Zmc2V0ID49IHN0YXJ0VGltZSkge1xuICAgICAgICAgICAgICAgIHBsYXlCdWZmZXIoY3R4LCBjdXJyZW50VGltZSArIHRpbWVPZmZzZXQgLSBzdGFydFRpbWUsIHRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGZpbmlzaFRpbWVPZmZzZXQgPiBzdGFydFRpbWUpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBhZGRpdGlvbmFsT2Zmc2V0ID0gc3RhcnRUaW1lIC0gdGltZU9mZnNldDtcbiAgICAgICAgICAgICAgICBwbGF5QnVmZmVyKGN0eCwgdW5kZWZpbmVkLCB0b2tlbiwgYWRkaXRpb25hbE9mZnNldCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aW1lT2Zmc2V0ID0gZmluaXNoVGltZU9mZnNldDtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGF1ZGlvU3RhdHVzU3RvcmUuc2V0KHsgdHlwZTogXCJQTEFZSU5HXCIsIG9mZnNldDogc3RhcnRUaW1lLCBjdHhTdGFydFRpbWU6IGN1cnJlbnRUaW1lIH0pO1xufVxuZXhwb3J0IGZ1bmN0aW9uIHN0b3AodG9rZW5zKSB7XG4gICAgdG9rZW5zLmZvckVhY2godG9rZW4gPT4ge1xuICAgICAgICBpZiAodG9rZW4udHlwZSA9PT0gXCJBVURJT1wiKVxuICAgICAgICAgICAgdG9rZW4uc3RvcCgpO1xuICAgIH0pO1xuICAgIGF1ZGlvU3RhdHVzU3RvcmUuc2V0KHsgdHlwZTogXCJTVE9QUEVEXCIgfSk7XG59XG5leHBvcnQgZnVuY3Rpb24gcGF1c2UodG9rZW5zKSB7XG4gICAgbGV0IGR1cmF0aW9uID0gMDtcbiAgICB0b2tlbnMuZm9yRWFjaCh0b2tlbiA9PiB7XG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSBcIkFVRElPXCIpXG4gICAgICAgICAgICB0b2tlbi5zdG9wKCk7XG4gICAgICAgIGlmICh0b2tlbi50eXBlICE9PSBcIk5PVEhJTkdcIilcbiAgICAgICAgICAgIGR1cmF0aW9uICs9IHRva2VuLmR1cmF0aW9uO1xuICAgIH0pO1xuICAgIGNvbnN0IG9sZE9mZnNldCA9IGF1ZGlvU3RhdGUudHlwZSA9PT0gXCJQTEFZSU5HXCIgPyBhdWRpb1N0YXRlLm9mZnNldCA6IDA7XG4gICAgY29uc3QgbmV3T2Zmc2V0ID0gb2xkT2Zmc2V0ICsgZ2V0Q3VycmVudFRpbWUoKTtcbiAgICBpZiAobmV3T2Zmc2V0ID49IGR1cmF0aW9uKSB7XG4gICAgICAgIGF1ZGlvU3RhdHVzU3RvcmUuc2V0KHsgdHlwZTogXCJTVE9QUEVEXCIgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBhdWRpb1N0YXR1c1N0b3JlLnNldCh7IHR5cGU6IFwiUEFVU0VEXCIsIG9mZnNldDogbmV3T2Zmc2V0IH0pO1xuICAgIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiB0b2dnbGVQYXVzZSh0b2tlbnMpIHtcbiAgICBpZiAoYXVkaW9TdGF0ZS50eXBlID09PSBcIlNUT1BQRURcIikge1xuICAgICAgICBwbGF5KHRva2Vucyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKGF1ZGlvU3RhdGUudHlwZSA9PT0gXCJQQVVTRURcIikge1xuICAgICAgICBwbGF5KHRva2VucywgYXVkaW9TdGF0ZS5vZmZzZXQpO1xuICAgIH1cbiAgICBlbHNlIGlmIChhdWRpb1N0YXRlLnR5cGUgPT09IFwiUExBWUlOR1wiKSB7XG4gICAgICAgIHBhdXNlKHRva2Vucyk7XG4gICAgfVxufVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NSYXdBdWRpbyhhdWRpbykge1xuICAgIGNvbnN0IGN0eCA9IGdldEF1ZGlvQ29udGV4dCgpO1xuICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgYXVkaW8uYXJyYXlCdWZmZXIoKTtcbiAgICBjb25zdCBhdWRpb0J1ZmZlciA9IGF3YWl0IGN0eC5kZWNvZGVBdWRpb0RhdGEoYXJyYXlCdWZmZXIpO1xuICAgIHJldHVybiBhd2FpdCBwb3N0UHJvY2Vzc0F1ZGlvKGF1ZGlvQnVmZmVyKTtcbn1cbmZ1bmN0aW9uIHBsYXlCdWZmZXIoY3R4LCB3aGVuLCB0b2tlbiwgb2Zmc2V0ID0gMCkge1xuICAgIGNvbnN0IGR1cmF0aW9uID0gdG9rZW4uZHVyYXRpb24gLSBvZmZzZXQ7XG4gICAgY29uc3Qgc291cmNlTm9kZSA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICBzb3VyY2VOb2RlLmJ1ZmZlciA9IHRva2VuLmJ1ZmZlcjtcbiAgICBzb3VyY2VOb2RlLnN0YXJ0KHdoZW4sIHRva2VuLnN0YXJ0ICsgb2Zmc2V0LCBkdXJhdGlvbik7XG4gICAgY29uc3QgZ2Fpbk5vZGUgPSBjdHguY3JlYXRlR2FpbigpO1xuICAgIGlmICh3aGVuID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgZ2Fpbk5vZGUuZ2Fpbi52YWx1ZSA9IDE7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBnYWluTm9kZS5nYWluLnZhbHVlID0gMDtcbiAgICAgICAgZ2Fpbk5vZGUuZ2Fpbi5zZXRWYWx1ZUF0VGltZSgwLCB3aGVuKTtcbiAgICAgICAgZ2Fpbk5vZGUuZ2Fpbi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSgxLCB3aGVuICsgMC4wNSk7XG4gICAgICAgIGdhaW5Ob2RlLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMSwgd2hlbiArIGR1cmF0aW9uIC0gMC4wNSk7XG4gICAgICAgIGdhaW5Ob2RlLmdhaW4ubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoMCwgd2hlbiArIGR1cmF0aW9uKTtcbiAgICB9XG4gICAgc291cmNlTm9kZS5jb25uZWN0KGdhaW5Ob2RlKTtcbiAgICBnYWluTm9kZS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7XG4gICAgdG9rZW4uc3RvcCA9ICgpID0+IHNvdXJjZU5vZGUuc3RvcCgpO1xufVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNhdmUodG9rZW5zKSB7XG4gICAgY29uc3QgZHVyYXRpb24gPSB0b2tlbnMubWFwKHRva2VuID0+IHRva2VuLnR5cGUgPT09IFwiTk9USElOR1wiID8gMCA6IHRva2VuLmR1cmF0aW9uKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgICBjb25zdCBjdHggPSBuZXcgT2ZmbGluZUF1ZGlvQ29udGV4dCh7IHNhbXBsZVJhdGUsIGxlbmd0aDogZHVyYXRpb24gKiBzYW1wbGVSYXRlIH0pO1xuICAgIGxldCBjdXJyZW50VGltZSA9IDA7XG4gICAgdG9rZW5zLmZvckVhY2goKHRva2VuKSA9PiB7XG4gICAgICAgIGlmICh0b2tlbi50eXBlID09PSBcIlBBVVNFXCIgfHwgdG9rZW4udHlwZSA9PT0gXCJQQVJBR1JBUEhcIikge1xuICAgICAgICAgICAgY3VycmVudFRpbWUgKz0gdG9rZW4uZHVyYXRpb247XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodG9rZW4udHlwZSA9PT0gXCJBVURJT1wiKSB7XG4gICAgICAgICAgICBwbGF5QnVmZmVyKGN0eCwgY3VycmVudFRpbWUsIHRva2VuKTtcbiAgICAgICAgICAgIGN1cnJlbnRUaW1lICs9IHRva2VuLmR1cmF0aW9uO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgY29uc3Qgb3V0cHV0QnVmZmVyID0gYXdhaXQgY3R4LnN0YXJ0UmVuZGVyaW5nKCk7XG4gICAgY29uc3Qgd2F2ID0gdG9XYXYob3V0cHV0QnVmZmVyKTtcbiAgICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KHdhdik7XG4gICAgZG93bmxvYWQoYXJyYXksIGBhdWRpby53YXZgKTtcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB0b0VudmVsb3BlKGJ1ZmZlcikge1xuICAgIGNvbnN0IGN0eCA9IG5ldyBPZmZsaW5lQXVkaW9Db250ZXh0KHsgc2FtcGxlUmF0ZSwgbGVuZ3RoOiBidWZmZXIubGVuZ3RoLCBudW1iZXJPZkNoYW5uZWxzOiAxIH0pO1xuICAgIGF3YWl0IGN0eC5hdWRpb1dvcmtsZXQuYWRkTW9kdWxlKFwiY3VzdG9tQXVkaW8uanNcIik7XG4gICAgY29uc3QgYnVmZmVyU291cmNlID0gY3R4LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpO1xuICAgIGJ1ZmZlclNvdXJjZS5idWZmZXIgPSBidWZmZXI7XG4gICAgYnVmZmVyU291cmNlLnN0YXJ0KCk7XG4gICAgY29uc3QgYmFuZFBhc3MgPSBjdHguY3JlYXRlQmlxdWFkRmlsdGVyKCk7XG4gICAgYmFuZFBhc3MudHlwZSA9IFwiYmFuZHBhc3NcIjtcbiAgICBiYW5kUGFzcy5mcmVxdWVuY3kudmFsdWUgPSAoMzAwICsgMzAwMCkgLyAyO1xuICAgIGJhbmRQYXNzLlEudmFsdWUgPSAwLjM1MTM2NDE4NDQ2MztcbiAgICBidWZmZXJTb3VyY2UuY29ubmVjdChiYW5kUGFzcyk7XG4gICAgY29uc3QgYWJzb2x1dGUgPSBuZXcgQXVkaW9Xb3JrbGV0Tm9kZShjdHgsIFwiYWJzb2x1dGVcIik7XG4gICAgYmFuZFBhc3MuY29ubmVjdChhYnNvbHV0ZSk7XG4gICAgY29uc3QgbWVhbiA9IG5ldyBBdWRpb1dvcmtsZXROb2RlKGN0eCwgXCJtZWFuXCIpO1xuICAgIGFic29sdXRlLmNvbm5lY3QobWVhbik7XG4gICAgbWVhbi5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7XG4gICAgcmV0dXJuIGF3YWl0IGN0eC5zdGFydFJlbmRlcmluZygpO1xufVxuYXN5bmMgZnVuY3Rpb24gcG9zdFByb2Nlc3NBdWRpbyhidWZmZXIpIHtcbiAgICBsZXQgbWF4Vm9sdW1lID0gMDtcbiAgICBmb3IgKGxldCBjaGFubmVsSWR4ID0gMDsgY2hhbm5lbElkeCA8IGJ1ZmZlci5udW1iZXJPZkNoYW5uZWxzOyBjaGFubmVsSWR4KyspIHtcbiAgICAgICAgY29uc3QgY2hhbm5lbCA9IGJ1ZmZlci5nZXRDaGFubmVsRGF0YShjaGFubmVsSWR4KTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFubmVsLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBtYXhWb2x1bWUgPSBNYXRoLm1heChtYXhWb2x1bWUsIE1hdGguYWJzKGNoYW5uZWxbaV0pKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjb25zdCBnYWluID0gMC44IC8gbWF4Vm9sdW1lO1xuICAgIGNvbnN0IGN0eCA9IG5ldyBPZmZsaW5lQXVkaW9Db250ZXh0KHsgc2FtcGxlUmF0ZSwgbGVuZ3RoOiBidWZmZXIubGVuZ3RoIH0pO1xuICAgIGNvbnN0IGJ1ZmZlclNvdXJjZSA9IGN0eC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcbiAgICBidWZmZXJTb3VyY2UuYnVmZmVyID0gYnVmZmVyO1xuICAgIGJ1ZmZlclNvdXJjZS5zdGFydCgpO1xuICAgIGNvbnN0IGxvd1NoZWxmID0gY3R4LmNyZWF0ZUJpcXVhZEZpbHRlcigpO1xuICAgIGxvd1NoZWxmLnR5cGUgPSBcImxvd3NoZWxmXCI7XG4gICAgbG93U2hlbGYuZnJlcXVlbmN5LnZhbHVlID0gMTA7XG4gICAgbG93U2hlbGYuZ2Fpbi52YWx1ZSA9IC0xMDA7XG4gICAgYnVmZmVyU291cmNlLmNvbm5lY3QobG93U2hlbGYpO1xuICAgIGNvbnN0IGdhaW5Ob2RlID0gY3R4LmNyZWF0ZUdhaW4oKTtcbiAgICBnYWluTm9kZS5nYWluLnZhbHVlID0gZ2FpbjtcbiAgICBsb3dTaGVsZi5jb25uZWN0KGdhaW5Ob2RlKTtcbiAgICBnYWluTm9kZS5jb25uZWN0KGN0eC5kZXN0aW5hdGlvbik7XG4gICAgcmV0dXJuIGF3YWl0IGN0eC5zdGFydFJlbmRlcmluZygpO1xufVxuIl0sIm5hbWVzIjpbIm1vZHVsZSIsImRvd25sb2FkIiwiZGF0YSIsInN0ckZpbGVOYW1lIiwic3RyTWltZVR5cGUiLCJibG9iIiwicmVhZGVyIiwic2VsZiIsIndpbmRvdyIsImRlZmF1bHRNaW1lIiwibWltZVR5cGUiLCJwYXlsb2FkIiwidXJsIiwiYW5jaG9yIiwiZG9jdW1lbnQiLCJjcmVhdGVFbGVtZW50IiwidG9TdHJpbmciLCJhIiwiU3RyaW5nIiwibXlCbG9iIiwiQmxvYiIsIk1vekJsb2IiLCJXZWJLaXRCbG9iIiwiZmlsZU5hbWUiLCJjYWxsIiwiYmluZCIsInRoaXMiLCJsZW5ndGgiLCJzcGxpdCIsInBvcCIsImhyZWYiLCJpbmRleE9mIiwiYWpheCIsIlhNTEh0dHBSZXF1ZXN0Iiwib3BlbiIsInJlc3BvbnNlVHlwZSIsIm9ubG9hZCIsImUiLCJ0YXJnZXQiLCJyZXNwb25zZSIsInNldFRpbWVvdXQiLCJzZW5kIiwidGVzdCIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJkYXRhVXJsVG9CbG9iIiwic2F2ZXIiLCJ0eXBlIiwiaSIsInRlbXBVaUFyciIsIlVpbnQ4QXJyYXkiLCJteCIsImNoYXJDb2RlQXQiLCJzdHJVcmwiLCJwYXJ0cyIsImJpbkRhdGEiLCJhdG9iIiwiZGVjb2RlVVJJQ29tcG9uZW50IiwidWlBcnIiLCJ3aW5Nb2RlIiwic2V0QXR0cmlidXRlIiwiY2xhc3NOYW1lIiwiaW5uZXJIVE1MIiwic3R5bGUiLCJkaXNwbGF5IiwiYm9keSIsImFwcGVuZENoaWxkIiwiY2xpY2siLCJyZW1vdmVDaGlsZCIsIlVSTCIsInJldm9rZU9iamVjdFVSTCIsInVzZXJBZ2VudCIsInJlcGxhY2UiLCJjb25maXJtIiwibG9jYXRpb24iLCJmIiwic3JjIiwiY3JlYXRlT2JqZWN0VVJMIiwiY29uc3RydWN0b3IiLCJidG9hIiwieSIsImVuY29kZVVSSUNvbXBvbmVudCIsIkZpbGVSZWFkZXIiLCJyZXN1bHQiLCJyZWFkQXNEYXRhVVJMIiwibm9vcCIsInN1YnNjcmliZXJfcXVldWUiLCJvZmZzY3JlZW4iLCJnbCIsInZlcnRpY2VzIiwicHJvZ3JhbSIsInZhbHVlIiwic3RhcnQiLCJzdG9wIiwic3Vic2NyaWJlcnMiLCJzZXQiLCJuZXdfdmFsdWUiLCJiIiwicnVuX3F1ZXVlIiwicyIsInB1c2giLCJ1cGRhdGUiLCJmbiIsInN1YnNjcmliZSIsInJ1biIsImludmFsaWRhdGUiLCJzdWJzY3JpYmVyIiwiaW5kZXgiLCJzcGxpY2UiLCJ3cml0YWJsZSIsInN0YXRlIiwicmVuZGVyUGFyYW1zIiwiaW5pdGlhbGlzZWQiLCJzZXRTY2FsZSIsInBpeGVsc1BlclNlY29uZCIsImxpbmVDb3VudCIsInRvdGFsRHVyYXRpb24iLCJzY2FsZSIsIndpZHRoIiwic2NhbGVMb2MiLCJnZXRVbmlmb3JtTG9jYXRpb24iLCJ1bmlmb3JtNGZ2IiwiZHJhd1NlY3Rpb24iLCJkcmF3QXRUaW1lIiwidG9rZW5PZmZzZXQiLCJ0b2tlbkR1cmF0aW9uIiwic2Nyb2xsIiwic3RhcnRWZXJ0ZXgiLCJNYXRoIiwicm91bmQiLCJvZmZzZXQiLCJvZmZzZXRMb2MiLCJ2ZXJ0ZXhDb3VudCIsIm1heCIsImVuZCIsIm1pbiIsImRyYXdBcnJheXMiLCJMSU5FX1NUUklQIiwiZHJhd091dGxpbmUiLCJvdXRsaW5lIiwiRmxvYXQzMkFycmF5IiwiYnVmZmVyU3ViRGF0YSIsIkFSUkFZX0JVRkZFUiIsIkJZVEVTX1BFUl9FTEVNRU5UIiwiTElORV9MT09QIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhbnZhcyIsImNoYW5uZWwiLCJpbml0aWFsVmFsdWVzIiwiZ2V0Q29udGV4dCIsInByZXNlcnZlRHJhd2luZ0J1ZmZlciIsImRlc3luY2hyb25pemVkIiwib3V0cHV0TGVuZ3RoIiwib3V0cHV0IiwiaWR4IiwicHJlcHJvY2VzcyIsInZzX3NvdXJjZSIsImZzX3NvdXJjZSIsInZlcnRleFNoYWRlciIsIm1ha2VTaGFkZXIiLCJWRVJURVhfU0hBREVSIiwiZnJhZ21lbnRTaGFkZXIiLCJGUkFHTUVOVF9TSEFERVIiLCJnbFByb2dyYW0iLCJjcmVhdGVQcm9ncmFtIiwiRXJyb3IiLCJhdHRhY2hTaGFkZXIiLCJsaW5rUHJvZ3JhbSIsImdldFByb2dyYW1QYXJhbWV0ZXIiLCJMSU5LX1NUQVRVUyIsImFsZXJ0IiwiZ2V0UHJvZ3JhbUluZm9Mb2ciLCJpbml0U2hhZGVycyIsImJ1ZmZlcnMiLCJidWZmZXIiLCJjcmVhdGVCdWZmZXIiLCJiaW5kQnVmZmVyIiwiYV9Qb3NpdGlvbiIsImdldEF0dHJpYkxvY2F0aW9uIiwidmVydGV4QXR0cmliUG9pbnRlciIsIkZMT0FUIiwiZW5hYmxlVmVydGV4QXR0cmliQXJyYXkiLCJidWZmZXJEYXRhIiwiU1RBVElDX0RSQVciLCJpbml0VmVydGV4QnVmZmVycyIsInVzZVByb2dyYW0iLCJpbml0Iiwic2V0dXAiLCJoZWlnaHQiLCJkdXJhdGlvbiIsInRva2VuIiwidG9rZW5zIiwidW5kZWZpbmVkIiwidmlld3BvcnQiLCJjbGVhckNvbG9yIiwiY2xlYXIiLCJDT0xPUl9CVUZGRVJfQklUIiwic2Vjb25kc1BlckNsaXAiLCJtaW5TZWNzIiwibWF4U2VjcyIsInRpbWVjb2RlIiwidmlzaWJsZVRva2VucyIsImZpbHRlciIsImNyb3BwZWRGcm9tU3RhcnQiLCJzdGFydEFkanVzdGVkRHVyYXRpb24iLCJtYXhEdXJhdGlvbiIsImVuZEFkanVzdGVkRHVyYXRpb24iLCJkcmF3V2F2ZWZvcm0iLCJzaGFkZXIiLCJjcmVhdGVTaGFkZXIiLCJzaGFkZXJTb3VyY2UiLCJjb21waWxlU2hhZGVyIiwiZ2V0U2hhZGVyUGFyYW1ldGVyIiwiQ09NUElMRV9TVEFUVVMiLCJnZXRTaGFkZXJJbmZvTG9nIiwiZGVsZXRlU2hhZGVyIl0sIm1hcHBpbmdzIjoiMFlBaUJFQSxVQU9NLFNBQVNDLEVBQVNDLEVBQU1DLEVBQWFDLEdBRTNDLElBU0NDLEVBQ0FDLEVBVkdDLEVBQU9DLE9BQ1ZDLEVBQWMsMkJBQ2RDLEVBQVdOLEdBQWVLLEVBQzFCRSxFQUFVVCxFQUNWVSxHQUFPVCxJQUFnQkMsR0FBZU8sRUFDdENFLEVBQVNDLFNBQVNDLGNBQWMsS0FDaENDLEVBQVcsU0FBU0MsR0FBRyxPQUFPQyxPQUFPRCxJQUNyQ0UsRUFBVVosRUFBS2EsTUFBUWIsRUFBS2MsU0FBV2QsRUFBS2UsWUFBY04sRUFDMURPLEVBQVdwQixHQUFlLFdBWTNCLEdBVENnQixFQUFRQSxFQUFPSyxLQUFPTCxFQUFPTSxLQUFLbEIsR0FBUWEsS0FFekIsU0FBZkYsT0FBT1EsUUFFVGhCLEdBREFDLEVBQVEsQ0FBQ0EsRUFBU0QsSUFDRCxHQUNqQkMsRUFBUUEsRUFBUSxJQUlkQyxHQUFPQSxFQUFJZSxPQUFRLE9BQ3JCSixFQUFXWCxFQUFJZ0IsTUFBTSxLQUFLQyxNQUFNRCxNQUFNLEtBQUssR0FDM0NmLEVBQU9pQixLQUFPbEIsR0FDcUIsSUFBOUJDLEVBQU9pQixLQUFLQyxRQUFRbkIsSUFBWSxDQUM5QixJQUFJb0IsRUFBSyxJQUFJQyxlQU9oQixPQU5HRCxFQUFLRSxLQUFNLE1BQU90QixHQUFLLEdBQ3ZCb0IsRUFBS0csYUFBZSxPQUNwQkgsRUFBS0ksT0FBUSxTQUFTQyxHQUMxQnBDLEVBQVNvQyxFQUFFQyxPQUFPQyxTQUFVaEIsRUFBVWQsSUFFbEMrQixZQUFXLFdBQVlSLEVBQUtTLFNBQVUsR0FDbENULEVBTVosR0FBRyxpQ0FBaUNVLEtBQUsvQixHQUFTLENBRWpELEtBQUdBLEVBQVFnQixvQkFBOEJSLElBQVdILEdBSW5ELE9BQU8yQixVQUFVQyxXQUNoQkQsVUFBVUMsV0FBV0MsRUFBY2xDLEdBQVVZLEdBQzdDdUIsRUFBTW5DLEdBSlBELEdBREFDLEVBQVFrQyxFQUFjbEMsSUFDTG9DLE1BQVF0QyxPQVExQixHQUFHLGdCQUFnQmlDLEtBQUsvQixHQUFTLENBRWhDLElBREEsSUFBSXFDLEVBQUUsRUFBR0MsRUFBVyxJQUFJQyxXQUFXdkMsRUFBUWdCLFFBQVN3QixFQUFHRixFQUFVdEIsT0FDM0RxQixFQUFFRyxJQUFLSCxFQUFHQyxFQUFVRCxHQUFJckMsRUFBUXlDLFdBQVdKLEdBQ2hEckMsRUFBUSxJQUFJUSxFQUFPLENBQUM4QixHQUFZLENBQUNGLEtBQU1yQyxJQVExQyxTQUFTbUMsRUFBY1EsR0FTdEIsSUFSQSxJQUFJQyxFQUFPRCxFQUFPekIsTUFBTSxTQUN4Qm1CLEVBQU1PLEVBQU0sR0FFWkMsR0FEcUIsVUFBWkQsRUFBTSxHQUFpQkUsS0FBT0Msb0JBQ3JCSCxFQUFNekIsT0FDeEJzQixFQUFJSSxFQUFRNUIsT0FDWnFCLEVBQUcsRUFDSFUsRUFBTyxJQUFJUixXQUFXQyxHQUVoQkgsRUFBRUcsSUFBS0gsRUFBR1UsRUFBTVYsR0FBSU8sRUFBUUgsV0FBV0osR0FFN0MsT0FBTyxJQUFJN0IsRUFBTyxDQUFDdUMsR0FBUSxDQUFDWCxLQUFNQSxJQUduQyxTQUFTRCxFQUFNbEMsRUFBSytDLEdBRW5CLEdBQUksYUFBYzlDLEVBWWpCLE9BWEFBLEVBQU9pQixLQUFPbEIsRUFDZEMsRUFBTytDLGFBQWEsV0FBWXJDLEdBQ2hDVixFQUFPZ0QsVUFBWSxtQkFDbkJoRCxFQUFPaUQsVUFBWSxpQkFDbkJqRCxFQUFPa0QsTUFBTUMsUUFBVSxPQUN2QmxELFNBQVNtRCxLQUFLQyxZQUFZckQsR0FDMUIyQixZQUFXLFdBQ1YzQixFQUFPc0QsUUFDUHJELFNBQVNtRCxLQUFLRyxZQUFZdkQsSUFDYixJQUFWOEMsR0FBZ0JuQixZQUFXLFdBQVlqQyxFQUFLOEQsSUFBSUMsZ0JBQWdCekQsRUFBT2lCLFFBQVMsT0FDakYsS0FDSSxFQUlSLEdBQUcsZ0RBQWdEWSxLQUFLQyxVQUFVNEIsV0FLakUsTUFKRyxTQUFTN0IsS0FBSzlCLEtBQU1BLEVBQUksUUFBUUEsRUFBSTRELFFBQVEsc0JBQXVCL0QsSUFDbEVELE9BQU8wQixLQUFLdEIsSUFDWjZELFFBQVEsb0dBQW9HQyxTQUFTNUMsS0FBS2xCLElBRXZILEVBSVIsSUFBSStELEVBQUk3RCxTQUFTQyxjQUFjLFVBQy9CRCxTQUFTbUQsS0FBS0MsWUFBWVMsSUFFdEJoQixHQUFXLFNBQVNqQixLQUFLOUIsS0FDNUJBLEVBQUksUUFBUUEsRUFBSTRELFFBQVEsc0JBQXVCL0QsSUFFaERrRSxFQUFFQyxJQUFJaEUsRUFDTjRCLFlBQVcsV0FBWTFCLFNBQVNtRCxLQUFLRyxZQUFZTyxLQUFPLEtBT3pELEdBNURBdEUsRUFBT00sYUFBbUJRLEVBQ3pCUixFQUNBLElBQUlRLEVBQU8sQ0FBQ1IsR0FBVSxDQUFDb0MsS0FBTXJDLElBMEQxQmlDLFVBQVVDLFdBQ2IsT0FBT0QsVUFBVUMsV0FBV3ZDLEVBQU1rQixHQUduQyxHQUFHaEIsRUFBSzhELElBQ1B2QixFQUFNdkMsRUFBSzhELElBQUlRLGdCQUFnQnhFLElBQU8sT0FDbEMsQ0FFSixHQUFtQixpQkFBVEEsR0FBcUJBLEVBQUt5RSxjQUFjOUQsRUFDakQsSUFDQyxPQUFPOEIsRUFBTyxRQUFXcEMsRUFBYSxXQUFlSCxFQUFLd0UsS0FBSzFFLElBQy9ELE1BQU0yRSxHQUNOLE9BQU9sQyxFQUFPLFFBQVdwQyxFQUFhLElBQU11RSxtQkFBbUI1RSxLQUtqRUMsRUFBTyxJQUFJNEUsWUFDSjlDLE9BQU8sU0FBU0MsR0FDdEJTLEVBQU1wQixLQUFLeUQsU0FFWjdFLEVBQU84RSxjQUFjL0UsR0FFdEIsT0FBTyxNQ3BLVCxTQUFTZ0YsS0NHVCxNQUFNQyxFQUFtQixHQ0Z6QixJQUFJQyxFQUNBQyxFQUNBQyxFQUNBQyxHRGVKLFNBQWtCQyxFQUFPQyxFQUFRUCxHQUM3QixJQUFJUSxFQUNKLE1BQU1DLEVBQWMsR0FDcEIsU0FBU0MsRUFBSUMsR0FDVCxHREttQkMsRUNMT0QsSURLVi9FLEVDTEcwRSxJRE1YMUUsRUFBSWdGLEdBQUtBLEVBQUloRixJQUFNZ0YsR0FBT2hGLEdBQWtCLGlCQUFOQSxHQUFnQyxtQkFBTkEsS0NMcEUwRSxFQUFRSyxFQUNKSCxHQUFNLENBQ04sTUFBTUssR0FBYVosRUFBaUIzRCxPQUNwQyxJQUFLLElBQUlxQixFQUFJLEVBQUdBLEVBQUk4QyxFQUFZbkUsT0FBUXFCLEdBQUssRUFBRyxDQUM1QyxNQUFNbUQsRUFBSUwsRUFBWTlDLEdBQ3RCbUQsRUFBRSxLQUNGYixFQUFpQmMsS0FBS0QsRUFBR1IsR0FFN0IsR0FBSU8sRUFBVyxDQUNYLElBQUssSUFBSWxELEVBQUksRUFBR0EsRUFBSXNDLEVBQWlCM0QsT0FBUXFCLEdBQUssRUFDOUNzQyxFQUFpQnRDLEdBQUcsR0FBR3NDLEVBQWlCdEMsRUFBSSxJQUVoRHNDLEVBQWlCM0QsT0FBUyxHRFI5QyxJQUF3QlYsRUFBR2dGLEVDa0N2QixNQUFPLENBQUVGLElBQUFBLEVBQUtNLE9BckJkLFNBQWdCQyxHQUNaUCxFQUFJTyxFQUFHWCxLQW9CV1ksVUFsQnRCLFNBQW1CQyxFQUFLQyxFQUFhcEIsR0FDakMsTUFBTXFCLEVBQWEsQ0FBQ0YsRUFBS0MsR0FNekIsT0FMQVgsRUFBWU0sS0FBS00sR0FDVSxJQUF2QlosRUFBWW5FLFNBQ1prRSxFQUFPRCxFQUFNRyxJQUFRVixHQUV6Qm1CLEVBQUliLEdBQ0csS0FDSCxNQUFNZ0IsRUFBUWIsRUFBWS9ELFFBQVEyRSxJQUNuQixJQUFYQyxHQUNBYixFQUFZYyxPQUFPRCxFQUFPLEdBRUgsSUFBdkJiLEVBQVluRSxTQUNaa0UsSUFDQUEsRUFBTyxVRXVFU2dCLENBQVMsQ0FBRTlELEtBQU0sWUFFaEN3RCxVQUFVTyxPRDlIM0IsSUFBSUMsRUFBZSxLQUNmQyxHQUFjLEVBNEVsQixTQUFTQyxFQUFTQyxHQUNkLE1BQU1DLEVBQVkxQixFQUFTOUQsT0FBUyxFQUM5QnlGLEVBQWdCRCxFQ2hGQSxNRHFGaEJFLEVBSFlGLEdBREk1QixFQUFVK0IsTUFBUSxHQUVERixHQUNsQkYsRUNwRkMsT0RzRmhCSyxFQUFXL0IsRUFBR2dDLG1CQUFtQjlCLEVBQVMsV0FDaERGLEVBQUdpQyxXQUFXRixFQUFVLENBQUNGLEVBQU8sRUFBRyxFQUFHLElBRTFDLFNBQVNLLEVBQVlDLEVBQVlDLEVBQWFDLEVBQWVDLEdBQ3pELE1BQU1DLEVBQWNDLEtBQUtDLE1DMUZILE1EMEZTTCxHQUV6Qk0sRUFBU1AsRUFES2xDLEVBQXVCLEVBQWRzQyxHQUNhRCxFQUNwQ0ssRUFBWTNDLEVBQUdnQyxtQkFBbUI5QixFQUFTLFlBQ2pERixFQUFHaUMsV0FBV1UsRUFBVyxDQUFDRCxFQUFRLEVBQUcsRUFBRyxJQUN4QyxNQUFNRSxFQUFjSixLQUFLQyxNQy9GSCxNRCtGU0osR0FDekJqQyxFQUFRb0MsS0FBS0ssSUFBSSxFQUFHTixFQUFjLEdBQ2xDTyxFQUFNTixLQUFLTyxJQUFJOUMsRUFBUzlELE9BQVMsRUFBR2lFLEVBQVF3QyxFQUFjLEdBQ2hFNUMsRUFBR2dELFdBQVdoRCxFQUFHaUQsV0FBWTdDLEVBQU8wQyxFQUFNMUMsR0FFOUMsU0FBUzhDLEVBQVlmLEVBQVlFLEVBQWVDLEdBQzVDLE1BQU1LLEVBQVkzQyxFQUFHZ0MsbUJBQW1COUIsRUFBUyxZQUNqREYsRUFBR2lDLFdBQVdVLEVBQVcsQ0FBQ1IsRUFBYUcsRUFBUSxFQUFHLEVBQUcsSUFDckQsTUFBTWEsRUFBVSxJQUFJQyxhQUFhLENBQUMsR0FBSSxFQUFHLEVBQUcsRUFBR2YsRUFBZSxFQUFHQSxHQUFnQixJQUNqRnJDLEVBQUdxRCxjQUFjckQsRUFBR3NELGFBQWNyRCxFQUFTOUQsT0FBUzhELEVBQVNzRCxrQkFBbUJKLEdBQ2hGbkQsRUFBR2dELFdBQVdoRCxFQUFHd0QsVUFBV3ZELEVBQVM5RCxPQUFTLEVBQUcsR0F0R3JEcEIsS0FBSzBJLGlCQUFpQixVQUFXLEVBQUcvSSxLQUFBQSxNQUNoQyxHQUFrQixXQUFkQSxFQUFLNkMsTUEyQmIsVUFBZW1HLE9BQUVBLEVBQU1DLFFBQUVBLEVBQU9DLGNBQUVBLElBQzlCckMsRUFBZXFDLEVBQ2Y3RCxFQUFZMkQsRUFDWjFELEVBQUswRCxFQUFPRyxXQUFXLFNBQVUsQ0FBRUMsdUJBQXVCLEVBQU1DLGdCQUFnQixJQUNoRjlELEVBR0osU0FBb0IwRCxHQUNoQixNQUFNSyxFQUFnQyxFQUFqQkwsRUFBUXhILE9BQ3ZCOEgsRUFBUyxJQUFJYixhQUFhWSxHQUNoQyxJQUFLLElBQUl4RyxFQUFJLEVBQUdBLEVBQUltRyxFQUFReEgsT0FBUXFCLElBQUssQ0FDckMsTUFBTTBHLEVBQVUsRUFBSjFHLEVBQ1p5RyxFQUFPQyxHQUFPMUcsRUMzQ0ksTUQ0Q2xCeUcsRUFBT0MsRUFBTSxHQUFLUCxFQUFRbkcsR0FFOUIsT0FBT3lHLEVBWElFLENBQVdSLEdBcUYxQixXQUNJekQsRUFLSixTQUFxQkYsRUFBSW9FLEVBQVdDLEdBQ2hDLE1BQU1DLEVBQWVDLEVBQVd2RSxFQUFJb0UsRUFBV3BFLEVBQUd3RSxlQUM1Q0MsRUFBaUJGLEVBQVd2RSxFQUFJcUUsRUFBV3JFLEVBQUcwRSxpQkFDOUNDLEVBQVkzRSxFQUFHNEUsZ0JBQ3JCLElBQUtELEVBQ0QsTUFBTSxJQUFJRSxNQUFNLDRCQUlwQixHQUhBN0UsRUFBRzhFLGFBQWFILEVBQVdMLEdBQzNCdEUsRUFBRzhFLGFBQWFILEVBQVdGLEdBQzNCekUsRUFBRytFLFlBQVlKLElBQ1YzRSxFQUFHZ0Ysb0JBQW9CTCxFQUFXM0UsRUFBR2lGLGFBRXRDLE1BREFDLE1BQU0sNENBQThDbEYsRUFBR21GLGtCQUFrQlIsSUFDbkUsSUFBSUUsTUFBTSw0QkFFcEIsT0FBT0YsRUFsQkdTLENBQVlwRixFQWRMLGtLQVFFLDBFQU9uQixNQUFNcUYsRUFtQlYsU0FBMkJyRixFQUFJRSxHQUMzQixNQUFNb0YsRUFBU3RGLEVBQUd1RixlQUNsQnZGLEVBQUd3RixXQUFXeEYsRUFBR3NELGFBQWNnQyxHQUMvQixNQUFNRyxFQUFhekYsRUFBRzBGLGtCQUFrQnhGLEVBQVMsY0FDakRGLEVBQUcyRixvQkFBb0JGLEVBQVksRUFBR3pGLEVBQUc0RixPQUFPLEVBQU8sRUFBRyxHQUMxRDVGLEVBQUc2Rix3QkFBd0JKLEdBQzNCekYsRUFBRzhGLFdBQVc5RixFQUFHc0QsY0FBZXJELEVBQVM5RCxPQUFTLEdBQUs4RCxFQUFTc0Qsa0JBQW1CdkQsRUFBRytGLGFBQ3RGL0YsRUFBR3FELGNBQWNyRCxFQUFHc0QsYUFBYyxFQUFHckQsR0ExQnJCK0YsQ0FBa0JoRyxFQUFJRSxHQUN0Q0YsRUFBR2lHLFdBQVcvRixHQXZGZGdHLEdBL0JJQyxDQUFNekwsR0FDTjhHLEdBQWMsT0FFYixHQUFJQSxFQUFhLENBQ2xCLEdBQWtCLGtCQUFkOUcsRUFBSzZDLEtBQ0xnRSxFQUFhZSxPQUFTNUgsRUFBSzRILFlBRTFCLEdBQWtCLGdCQUFkNUgsRUFBSzZDLEtBQ1ZnRSxFQUFhRyxnQkFBa0JoSCxFQUFLZ0gsZ0JBQ3BDSCxFQUFhZSxPQUFTNUgsRUFBSzRILFlBRTFCLEdBQWtCLGdCQUFkNUgsRUFBSzZDLEtBQ1ZnRSxFQUFhTyxNQUFRcEgsRUFBS29ILE1BQzFCUCxFQUFhNkUsT0FBUzFMLEVBQUswTCxXQUUxQixDQUNELE1BQU1sQyxJQUFFQSxFQUFHOUQsTUFBRUEsRUFBS2lHLFNBQUVBLEdBQWEzTCxFQUFLNEwsTUFDaENBLEVBQVEvRSxFQUFhZ0YsT0FBT3JDLEdBQ2xDb0MsRUFBTUQsU0FBV0EsRUFDRSxVQUFmQyxFQUFNL0ksV0FBOEJpSixJQUFWcEcsSUFDMUJrRyxFQUFNbEcsTUFBUUEsSUF1QjlCLFdBQ0ksTUFBTW1HLE9BQUVBLEVBQU03RSxnQkFBRUEsRUFBZVksT0FBRUEsRUFBTVIsTUFBRUEsRUFBS3NFLE9BQUVBLEdBQVc3RSxFQUMzRHhCLEVBQVUrQixNQUFRQSxFQUNsQi9CLEVBQVVxRyxPQUFTQSxFQUNuQnBHLEVBQUd5RyxTQUFTLEVBQUcsRUFBRzNFLEVBQU9zRSxHQUN6QnBHLEVBQUcwRyxXQUFXLEVBQUssRUFBSyxFQUFLLEdBQzdCMUcsRUFBRzJHLE1BQU0zRyxFQUFHNEcsa0JBQ1osTUFDTUMsRUFEZ0IvRSxFQUFRLEVBQ1NKLEVBQ2pDb0YsRUFBVXhFLEVBQVN1RSxFQUNuQkUsRUFBVXpFLEVBQVN1RSxFQUN6QixJQUFJRyxFQUFXLEVBQ2YsTUFBTUMsRUFBZ0JWLEVBQU9XLE9BQU9aLEdBQXdCLFlBQWZBLEVBQU0vSSxNQUNuRCxJQUFLLE1BQU0rSSxLQUFTVyxFQUFlLENBQy9CLE1BQU05RSxFQUFhSyxLQUFLSyxJQUFJaUUsRUFBU0UsR0FDL0JHLEVBQW1CaEYsRUFBYTZFLEVBQ2hDSSxFQUF3QmQsRUFBTUQsU0FBV2MsRUFDekNFLEVBQWNOLEVBQVU1RSxFQUN4Qm1GLEVBQXNCOUUsS0FBS08sSUFBSXNFLEVBQWFELEdBQ2xELEdBQUlFLEVBQXNCLEVBQUcsQ0FFekIsR0FEQTdGLEVBQVNDLEdBQ1UsVUFBZjRFLEVBQU0vSSxLQUFrQixDQUN4QixNQUFNNkUsRUFBY2tFLEVBQU1sRyxNQUFRK0csRUFDbENqRixFQUFZQyxFQUFZQyxFQUFha0YsRUFBcUJoRixHQUU5RFksRUFBWWYsRUFBWW1GLEVBQXFCaEYsR0FFakQwRSxHQUFZVixFQUFNRCxVQS9DbEJrQixNQTBIUixTQUFTaEQsRUFBV3ZFLEVBQUlaLEVBQUs3QixHQUN6QixNQUFNaUssRUFBU3hILEVBQUd5SCxhQUFhbEssR0FDL0IsSUFBS2lLLEVBQ0QsTUFBTSxJQUFJM0MsTUFBTSwyQkFHcEIsR0FGQTdFLEVBQUcwSCxhQUFhRixFQUFRcEksR0FDeEJZLEVBQUcySCxjQUFjSCxJQUNaeEgsRUFBRzRILG1CQUFtQkosRUFBUXhILEVBQUc2SCxnQkFHbEMsTUFGQTNDLE1BQU0sNENBQThDbEYsRUFBRzhILGlCQUFpQk4sSUFDeEV4SCxFQUFHK0gsYUFBYVAsR0FDVixJQUFJM0MsTUFBTSwyQkFFcEIsT0FBTzJDIn0=",Og=!1,$g?jg(Pg,Dg,Og):function(g,I,t){var e;return function(n){return e=e||Mg(g,I,t),new Worker(e,n)}}(Pg,Dg,Og));class qg{constructor(g,I,t,e,n,C,c){const i={type:"create",canvas:g,channel:function(g){const I=new Float32Array(g.getChannelData(0).length);for(let t=0;t<g.numberOfChannels;t++){const e=g.getChannelData(t);for(let g=0;g<I.length;g++)I[g]+=e[g]}return I}(I),initialValues:{tokens:t.map(g=>"AUDIO"===g.type?{type:"AUDIO",idx:g.idx,start:g.start,duration:g.duration}:"NOTHING"===g.type?{type:"NOTHING",idx:g.idx}:{type:"PAUSE",idx:g.idx,duration:g.duration}),scroll:e,pixelsPerSecond:n,width:C,height:c}};_g.postMessage(i,[g])}updateScroll(g){const I={type:"update_scroll",scroll:g};_g.postMessage(I)}updateZoom(g,I){const t={type:"update_zoom",scroll:I,pixelsPerSecond:g};_g.postMessage(t)}updateSize(g,I){const t={type:"update_size",width:g,height:I};_g.postMessage(t)}updateToken(g){const I="AUDIO"===g.type?g.start:void 0,t={type:"update_token",token:{idx:g.idx,start:I,duration:g.duration}};_g.postMessage(t)}}function gI(g,{delay:t=0,duration:e=400,easing:n=I}){const C=+getComputedStyle(g).opacity;return{delay:t,duration:e,easing:n,css:g=>"opacity: "+g*C}}function II(g,I,t){const e=g.slice();return e[21]=I[t].left,e[22]=I[t].mins,e[23]=I[t].secs,e}function tI(g){let I,t;return{c(){I=Z("div"),W(I,"class","cursor svelte-1qhhba3"),W(I,"style",t=`transform: translateX(calc(${g[2]}px - 50% + 50vw))`)},m(g,t){o(g,I,t)},p(g,e){4&e&&t!==(t=`transform: translateX(calc(${g[2]}px - 50% + 50vw))`)&&W(I,"style",t)},d(g){g&&G(I)}}}function eI(g,I){let t,e,n,C,c,i,l,A,b,s,d,u=I[22]+"",r=I[23]+"";return{key:g,first:null,c(){t=Z("div"),e=Z("div"),n=m(u),C=m(":"),c=m(r),i=X(),l=Z("div"),A=X(),W(e,"class","timestamp"),W(l,"class","marker svelte-1qhhba3"),W(t,"class","column svelte-1qhhba3"),W(t,"style",b=`transform: translateX(calc(${I[21]}px - 50%))`),this.first=t},m(g,I){o(g,t,I),a(t,e),a(e,n),a(e,C),a(e,c),a(t,i),a(t,l),a(t,A),d=!0},p(g,I){(!d||2&I)&&u!==(u=g[22]+"")&&x(n,u),(!d||2&I)&&r!==(r=g[23]+"")&&x(c,r),(!d||2&I&&b!==(b=`transform: translateX(calc(${g[21]}px - 50%))`))&&W(t,"style",b)},i(g){d||(P(()=>{s||(s=Ag(t,gI,{},!0)),s.run(1)}),d=!0)},o(g){s||(s=Ag(t,gI,{},!1)),s.run(0),d=!1},d(g){g&&G(t),g&&s&&s.end()}}}function nI(g){let I,t,e,n,c,i,l=[],A=new Map,b=null!==g[2]&&tI(g),s=g[1];const d=g=>g[21];for(let I=0;I<s.length;I+=1){let t=II(g,s,I),e=d(t);A.set(e,l[I]=eI(e,t))}return{c(){b&&b.c(),I=X(),t=Z("div");for(let g=0;g<l.length;g+=1)l[g].c();W(t,"class","timestamps svelte-1qhhba3"),P(()=>g[11].call(t))},m(C,A){b&&b.m(C,A),o(C,I,A),o(C,t,A);for(let g=0;g<l.length;g+=1)l[g].m(t,null);e=f(t,g[11].bind(t)),n=!0,c||(i=[h(t,"mouseover",g[3]),h(t,"mouseout",p(g[4])),h(t,"mousemove",g[5]),h(t,"click",g[6])],c=!0)},p(g,[e]){if(null!==g[2]?b?b.p(g,e):(b=tI(g),b.c(),b.m(I.parentNode,I)):b&&(b.d(1),b=null),2&e){const I=g[1];ng(),l=dg(l,e,d,1,g,I,A,t,sg,eI,null,II),Cg()}},i(g){if(!n){for(let g=0;g<s.length;g+=1)cg(l[g]);n=!0}},o(g){for(let g=0;g<l.length;g+=1)ig(l[g]);n=!1},d(g){b&&b.d(g),g&&G(I),g&&G(t);for(let g=0;g<l.length;g+=1)l[g].d();e(),c=!1,C(i)}}}function CI(g,I,t){let e,n,C,c,i,l,A,b,s,{duration:d}=I,{scroll:u}=I,{pixelsPerSecond:r}=I,a=!1,o=null,{cursorPositionSeconds:G}=I;const Z=L();return g.$$set=g=>{"duration"in g&&t(8,d=g.duration),"scroll"in g&&t(9,u=g.scroll),"pixelsPerSecond"in g&&t(10,r=g.pixelsPerSecond),"cursorPositionSeconds"in g&&t(7,G=g.cursorPositionSeconds)},g.$$.update=()=>{1&g.$$.dirty&&t(12,n=e||0),4096&g.$$.dirty&&t(13,C=Math.floor(n/100)),12288&g.$$.dirty&&t(14,c=n/C),5120&g.$$.dirty&&t(15,i=n/r),40960&g.$$.dirty&&t(16,l=i/C),90880&g.$$.dirty&&t(1,A=new Array(C).fill(null).map((g,I)=>({ts:u+l*(I-C/2+.5),idx:I})).filter(({ts:g})=>g>=0&&g<=d).map(({ts:g,idx:I})=>({left:c*(I+.5),mins:Math.floor(g/60).toFixed().padStart(2,"0"),secs:(g%60).toFixed(3).padStart(6,"0")}))),1540&g.$$.dirty&&t(7,G=null===o?null:u+o/r),1536&g.$$.dirty&&t(18,b=-u*r),263424&g.$$.dirty&&(s=d*r+b)},[e,A,o,function(){a=!0},function(){a=!1,t(2,o=null)},function(g){if(a){const I=void 0===e?g.offsetX:e,n=g.offsetX-I/2;t(2,o=Math.min(Math.max(b,n),s))}},function(g){const I=void 0===e?g.offsetX:e,t=g.offsetX-I/2,n=u+t/r,C=Math.min(Math.max(0,n),d);Z("play",C)},G,d,u,r,function(){e=this.clientWidth,t(0,e)}]}class cI extends mg{constructor(g){super(),Zg(this,g,CI,nI,i,{duration:8,scroll:9,pixelsPerSecond:10,cursorPositionSeconds:7})}}function iI(g){let I,t;return{c(){I=Z("div"),W(I,"class","pauseLine svelte-ad7eak"),W(I,"style",t=`left: ${g[0]}px;`)},m(g,t){o(g,I,t)},p(g,e){1&e&&t!==(t=`left: ${g[0]}px;`)&&W(I,"style",t)},d(g){g&&G(I)}}}function lI(I){let t;return{c(){t=Z("div"),W(t,"class","playLine svelte-ad7eak")},m(g,I){o(g,t,I)},p:g,d(g){g&&G(t)}}}function AI(I){let t;function e(g,I){return"PLAYING"===g[1]?lI:"PAUSED"===g[1]?iI:void 0}let n=e(I),C=n&&n(I);return{c(){C&&C.c(),t=B()},m(g,I){C&&C.m(g,I),o(g,t,I)},p(g,[I]){n===(n=e(g))&&C?C.p(g,I):(C&&C.d(1),C=n&&n(g),C&&(C.c(),C.m(t.parentNode,t)))},i:g,o:g,d(g){C&&C.d(g),g&&G(t)}}}function bI(g,I,t){let e,n,{duration:C}=I,{scroll:c}=I,{pixelsPerSecond:i}=I,l=0,A=!1;function b(g){e=1e3*(C-l),e<=0||(n=g,A||(A=!0,d(g)))}const s=L();function d(g){const I=l+(g-n)/1e3;s("timechange",I),"PLAYING"===a&&I<C?requestAnimationFrame(d):("PLAYING"===a&&yg.set({type:"STOPPED"}),A=!1,n=void 0)}let u,r=0,a="STOPPED";return yg.subscribe(g=>{t(1,a=g.type),"PLAYING"===g.type?(l=g.offset,requestAnimationFrame(b)):"PAUSED"===g.type&&t(9,r=g.offset)}),g.$$set=g=>{"duration"in g&&t(2,C=g.duration),"scroll"in g&&t(3,c=g.scroll),"pixelsPerSecond"in g&&t(4,i=g.pixelsPerSecond)},g.$$.update=()=>{536&g.$$.dirty&&t(0,u=(r-c)*i)},[u,a,C,c,i]}class sI extends mg{constructor(g){super(),Zg(this,g,bI,AI,i,{duration:2,scroll:3,pixelsPerSecond:4})}}let dI=null;function uI({button:g,onDrag:I,otherInfoGetter:t,onEnd:e}){const n={LEFT:0,RIGHT:2}[g||"LEFT"];return g=>{g.button===n&&(dI={startPosition:g.screenX,dragHandler:I,endHandler:e,otherInfo:t()})}}function rI(g){dI&&dI.endHandler&&dI.endHandler(g.screenX-dI.startPosition,dI.otherInfo),dI=null}function aI(g){dI&&dI.dragHandler(g.screenX-dI.startPosition,dI.otherInfo)}function oI(g){let I,t,e,n,i,l,A,b,s,d,u=g[4]&&GI(),r=g[5]&&ZI();return{c(){I=Z("div"),t=Z("div"),e=X(),n=Z("div"),i=X(),u&&u.c(),l=X(),r&&r.c(),W(t,"class","panRegion svelte-y8kwz0"),W(n,"class","stretchRegion svelte-y8kwz0"),Y(n,"hidden",g[6]),W(I,"class","audioTokenContainer svelte-y8kwz0"),W(I,"style",A=`width: ${g[2]}px; left: ${g[1]}px;`)},m(C,A){o(C,I,A),a(I,t),a(I,e),a(I,n),a(I,i),u&&u.m(I,null),a(I,l),r&&r.m(I,null),b=!0,s||(d=[h(t,"mousedown",V((function(){c(uI({button:"LEFT",onDrag:g[7],otherInfoGetter:g[12],onEnd:g[13]}))&&uI({button:"LEFT",onDrag:g[7],otherInfoGetter:g[12],onEnd:g[13]}).apply(this,arguments)}))),h(n,"mousedown",V((function(){c(uI({button:"LEFT",onDrag:g[8],otherInfoGetter:g[14],onEnd:g[15]}))&&uI({button:"LEFT",onDrag:g[8],otherInfoGetter:g[14],onEnd:g[15]}).apply(this,arguments)})))],s=!0)},p(t,e){g=t,64&e&&Y(n,"hidden",g[6]),g[4]?u?16&e&&cg(u,1):(u=GI(),u.c(),cg(u,1),u.m(I,l)):u&&(ng(),ig(u,1,1,()=>{u=null}),Cg()),g[5]?r?32&e&&cg(r,1):(r=ZI(),r.c(),cg(r,1),r.m(I,null)):r&&(ng(),ig(r,1,1,()=>{r=null}),Cg()),(!b||6&e&&A!==(A=`width: ${g[2]}px; left: ${g[1]}px;`))&&W(I,"style",A)},i(g){b||(cg(u),cg(r),b=!0)},o(g){ig(u),ig(r),b=!1},d(g){g&&G(I),u&&u.d(),r&&r.d(),s=!1,C(d)}}}function GI(g){let I,t,e;return{c(){I=Z("div"),W(I,"class","leftClamp svelte-y8kwz0")},m(g,t){o(g,I,t),e=!0},i(g){e||(P(()=>{t||(t=Ag(I,gI,{},!0)),t.run(1)}),e=!0)},o(g){t||(t=Ag(I,gI,{},!1)),t.run(0),e=!1},d(g){g&&G(I),g&&t&&t.end()}}}function ZI(g){let I,t,e;return{c(){I=Z("div"),W(I,"class","rightClamp svelte-y8kwz0")},m(g,t){o(g,I,t),e=!0},i(g){e||(P(()=>{t||(t=Ag(I,gI,{},!0)),t.run(1)}),e=!0)},o(g){t||(t=Ag(I,gI,{},!1)),t.run(0),e=!1},d(g){g&&G(I),g&&t&&t.end()}}}function mI(g){let I,t,e=g[2]>10&&oI(g);return{c(){e&&e.c(),I=B()},m(g,n){e&&e.m(g,n),o(g,I,n),t=!0},p(g,[t]){g[2]>10?e?(e.p(g,t),4&t&&cg(e,1)):(e=oI(g),e.c(),cg(e,1),e.m(I.parentNode,I)):e&&(ng(),ig(e,1,1,()=>{e=null}),Cg())},i(g){t||(cg(e),t=!0)},o(g){ig(e),t=!1},d(g){e&&e.d(g),g&&G(I)}}}function XI(g,I,t){let e,n,C,{pixelsPerSecond:c}=I,{token:i}=I,{audioDuration:l}=I,{left:A}=I,{setToken:b}=I,s=null;let d=!1;return g.$$set=g=>{"pixelsPerSecond"in g&&t(9,c=g.pixelsPerSecond),"token"in g&&t(0,i=g.token),"audioDuration"in g&&t(10,l=g.audioDuration),"left"in g&&t(1,A=g.left),"setToken"in g&&t(11,b=g.setToken)},g.$$.update=()=>{513&g.$$.dirty&&t(2,e=i.duration*c),8&g.$$.dirty&&t(4,n="LEFT"===s),8&g.$$.dirty&&t(5,C="RIGHT"===s)},[i,A,e,s,n,C,d,function(g,I){const e=I-g/c,n=l-i.duration;e<0?(t(0,i.start=0,i),t(3,s="LEFT")):e>n?(t(0,i.start=n,i),t(3,s="RIGHT")):(t(0,i.start=e,i),t(3,s=null)),b(i)},function(g,I){const e=I+g/c,n=l-i.start;e<=.1?(t(0,i.duration=.1,i),t(3,s="LEFT")):e>=n?(t(0,i.duration=n,i),t(3,s="RIGHT")):(t(0,i.duration=e,i),t(3,s=null)),b(i)},c,l,b,()=>i.start,()=>t(3,s=null),()=>(t(6,d=!0),i.duration),()=>{t(6,d=!1),t(3,s=null)}]}class BI extends mg{constructor(g){super(),Zg(this,g,XI,mI,i,{pixelsPerSecond:9,token:0,audioDuration:10,left:1,setToken:11})}}function hI(g){let I,t,e,n,C,i=g[3]&&VI(g);return{c(){I=Z("div"),i&&i.c(),W(I,"class","silenceTokenContainer svelte-1ewtvqw"),W(I,"style",t=`width: ${g[2]}px; left: ${g[1]}px`)},m(t,l){o(t,I,l),i&&i.m(I,null),e=!0,n||(C=h(I,"mousedown",V((function(){c(uI({button:"LEFT",onDrag:g[4],otherInfoGetter:g[7],onEnd:g[8]}))&&uI({button:"LEFT",onDrag:g[4],otherInfoGetter:g[7],onEnd:g[8]}).apply(this,arguments)}))),n=!0)},p(n,C){(g=n)[3]?i?(i.p(g,C),8&C&&cg(i,1)):(i=VI(g),i.c(),cg(i,1),i.m(I,null)):i&&(ng(),ig(i,1,1,()=>{i=null}),Cg()),(!e||6&C&&t!==(t=`width: ${g[2]}px; left: ${g[1]}px`))&&W(I,"style",t)},i(g){e||(cg(i),e=!0)},o(g){ig(i),e=!1},d(g){g&&G(I),i&&i.d(),n=!1,C()}}}function VI(g){let I,t,e,n,C,c=g[0].duration.toFixed(2)+"";return{c(){I=Z("div"),t=m(c),e=m("s")},m(g,n){o(g,I,n),a(I,t),a(I,e),C=!0},p(g,I){(!C||1&I)&&c!==(c=g[0].duration.toFixed(2)+"")&&x(t,c)},i(g){C||(P(()=>{n||(n=Ag(I,gI,{},!0)),n.run(1)}),C=!0)},o(g){n||(n=Ag(I,gI,{},!1)),n.run(0),C=!1},d(g){g&&G(I),g&&n&&n.end()}}}function pI(g){let I,t,e=g[2]>10&&hI(g);return{c(){e&&e.c(),I=B()},m(g,n){e&&e.m(g,n),o(g,I,n),t=!0},p(g,[t]){g[2]>10?e?(e.p(g,t),4&t&&cg(e,1)):(e=hI(g),e.c(),cg(e,1),e.m(I.parentNode,I)):e&&(ng(),ig(e,1,1,()=>{e=null}),Cg())},i(g){t||(cg(e),t=!0)},o(g){ig(e),t=!1},d(g){e&&e.d(g),g&&G(I)}}}function WI(g,I,t){let e,{pixelsPerSecond:n}=I,{token:C}=I,{left:c}=I,{setToken:i}=I;let l=!1;return g.$$set=g=>{"pixelsPerSecond"in g&&t(5,n=g.pixelsPerSecond),"token"in g&&t(0,C=g.token),"left"in g&&t(1,c=g.left),"setToken"in g&&t(6,i=g.setToken)},g.$$.update=()=>{33&g.$$.dirty&&t(2,e=C.duration*n)},[C,c,e,l,function(g,I){const e=g/n;t(0,C.duration=Math.max(.1,I+e),C),i(C)},n,i,()=>(t(3,l=!0),C.duration),()=>{t(3,l=!1)}]}class xI extends mg{constructor(g){super(),Zg(this,g,WI,pI,i,{pixelsPerSecond:5,token:0,left:1,setToken:6})}}function FI(g,I,t){const e=g.slice();return e[8]=I[t].token,e[9]=I[t].left,e}function RI(g){let I,t;return I=new xI({props:{token:g[8],pixelsPerSecond:g[0],left:g[9],setToken:g[2]}}),{c(){rg(I.$$.fragment)},m(g,e){ag(I,g,e),t=!0},p(g,t){const e={};8&t&&(e.token=g[8]),1&t&&(e.pixelsPerSecond=g[0]),8&t&&(e.left=g[9]),4&t&&(e.setToken=g[2]),I.$set(e)},i(g){t||(cg(I.$$.fragment,g),t=!0)},o(g){ig(I.$$.fragment,g),t=!1},d(g){og(I,g)}}}function yI(g){let I,t;return I=new BI({props:{token:g[8],pixelsPerSecond:g[0],audioDuration:g[1],left:g[9],setToken:g[2]}}),{c(){rg(I.$$.fragment)},m(g,e){ag(I,g,e),t=!0},p(g,t){const e={};8&t&&(e.token=g[8]),1&t&&(e.pixelsPerSecond=g[0]),2&t&&(e.audioDuration=g[1]),8&t&&(e.left=g[9]),4&t&&(e.setToken=g[2]),I.$set(e)},i(g){t||(cg(I.$$.fragment,g),t=!0)},o(g){ig(I.$$.fragment,g),t=!1},d(g){og(I,g)}}}function fI(g){let I,t,e,n;const C=[yI,RI],c=[];function i(g,I){return"AUDIO"===g[8].type?0:1}return I=i(g),t=c[I]=C[I](g),{c(){t.c(),e=B()},m(g,t){c[I].m(g,t),o(g,e,t),n=!0},p(g,n){let l=I;I=i(g),I===l?c[I].p(g,n):(ng(),ig(c[l],1,1,()=>{c[l]=null}),Cg(),t=c[I],t||(t=c[I]=C[I](g),t.c()),cg(t,1),t.m(e.parentNode,e))},i(g){n||(cg(t),n=!0)},o(g){ig(t),n=!1},d(g){c[I].d(g),g&&G(e)}}}function YI(g){let I,t,e=g[3],n=[];for(let I=0;I<e.length;I+=1)n[I]=fI(FI(g,e,I));const C=g=>ig(n[g],1,1,()=>{n[g]=null});return{c(){I=Z("div");for(let g=0;g<n.length;g+=1)n[g].c();W(I,"class","tokensContainer svelte-k1b9je")},m(g,e){o(g,I,e);for(let g=0;g<n.length;g+=1)n[g].m(I,null);t=!0},p(g,[t]){if(15&t){let c;for(e=g[3],c=0;c<e.length;c+=1){const C=FI(g,e,c);n[c]?(n[c].p(C,t),cg(n[c],1)):(n[c]=fI(C),n[c].c(),cg(n[c],1),n[c].m(I,null))}for(ng(),c=e.length;c<n.length;c+=1)C(c);Cg()}},i(g){if(!t){for(let g=0;g<e.length;g+=1)cg(n[g]);t=!0}},o(g){n=n.filter(Boolean);for(let g=0;g<n.length;g+=1)ig(n[g]);t=!1},d(g){g&&G(I),function(g,I){for(let t=0;t<g.length;t+=1)g[t]&&g[t].d(I)}(n,g)}}}function kI(g,I,t){let e,{tokens:n}=I,{pixelsPerSecond:C}=I,{scroll:c}=I,{audioDuration:i}=I,{canvasBounds:l}=I,{setToken:A}=I;return g.$$set=g=>{"tokens"in g&&t(4,n=g.tokens),"pixelsPerSecond"in g&&t(0,C=g.pixelsPerSecond),"scroll"in g&&t(5,c=g.scroll),"audioDuration"in g&&t(1,i=g.audioDuration),"canvasBounds"in g&&t(6,l=g.canvasBounds),"setToken"in g&&t(2,A=g.setToken)},g.$$.update=()=>{80&g.$$.dirty&&t(3,e=function(g,{start:I,end:t}){let e=0;const n=[];for(const i of g){const g=e+i.duration;if(e>=t)return n;(e>=I&&e<t||g>I&&g<t||e<=I&&g>=t)&&n.push({token:i,left:(e-c)*C}),e=g}return n}(n,l))},[C,i,A,e,n,c,l]}class vI extends mg{constructor(g){super(),Zg(this,g,kI,YI,i,{tokens:4,pixelsPerSecond:0,scroll:5,audioDuration:1,canvasBounds:6,setToken:2})}}function HI(I){let t,e,n,C,c,i,l=I[0].toFixed(3)+"";return{c(){t=Z("br"),e=X(),n=Z("div"),C=m('<div id="timestamp-'),c=m(l),i=m('"></div>')},m(g,I){o(g,t,I),o(g,e,I),o(g,n,I),a(n,C),a(n,c),a(n,i)},p(g,[I]){1&I&&l!==(l=g[0].toFixed(3)+"")&&x(c,l)},i:g,o:g,d(g){g&&G(t),g&&G(e),g&&G(n)}}}function NI(g,I,t){let{time:e}=I;return g.$$set=g=>{"time"in g&&t(0,e=g.time)},[e]}class SI extends mg{constructor(g){super(),Zg(this,g,NI,HI,i,{time:0})}}function UI(g,I,t){const e=g.slice();return e[11]=I[t].idx,e[12]=I[t].raw,e[13]=I[t].timestamp,e}function QI(g){let I,t;return I=new SI({props:{time:g[13].start}}),{c(){rg(I.$$.fragment)},m(g,e){ag(I,g,e),t=!0},p(g,t){const e={};2&t&&(e.time=g[13].start),I.$set(e)},i(g){t||(cg(I.$$.fragment,g),t=!0)},o(g){ig(I.$$.fragment,g),t=!1},d(g){og(I,g)}}}function JI(g){let I,t,e=g[12]+"";return{c(){I=Z("div"),t=m(e)},m(g,e){o(g,I,e),a(I,t)},p(g,I){2&I&&e!==(e=g[12]+"")&&x(t,e)},d(g){g&&G(I)}}}function wI(g){let I,t,e=g[12]+"";return{c(){I=Z("div"),t=m(e),W(I,"class","highlighted svelte-1qmkppt")},m(e,n){o(e,I,n),a(I,t),g[7](I)},p(g,I){2&I&&e!==(e=g[12]+"")&&x(t,e)},d(t){t&&G(I),g[7](null)}}}function LI(g,I){let t,e,n,C,c,i=I[13]&&QI(I);function l(g,I){return(null==n||3&I)&&(n=!!g[3](g[0],g[13])),n?wI:JI}let A=l(I,-1),b=A(I);return{key:g,first:null,c(){t=B(),i&&i.c(),e=X(),b.c(),C=B(),this.first=t},m(g,I){o(g,t,I),i&&i.m(g,I),o(g,e,I),b.m(g,I),o(g,C,I),c=!0},p(g,I){g[13]?i?(i.p(g,I),2&I&&cg(i,1)):(i=QI(g),i.c(),cg(i,1),i.m(e.parentNode,e)):i&&(ng(),ig(i,1,1,()=>{i=null}),Cg()),A===(A=l(g,I))&&b?b.p(g,I):(b.d(1),b=A(g),b&&(b.c(),b.m(C.parentNode,C)))},i(g){c||(cg(i),c=!0)},o(g){ig(i),c=!1},d(g){g&&G(t),i&&i.d(g),g&&G(e),b.d(g),g&&G(C)}}}function zI(g){let I,t,e=[],n=new Map,C=g[1];const c=g=>g[11];for(let I=0;I<C.length;I+=1){let t=UI(g,C,I),i=c(t);n.set(i,e[I]=LI(i,t))}return{c(){I=Z("div");for(let g=0;g<e.length;g+=1)e[g].c();W(I,"class","container svelte-1qmkppt")},m(g,n){o(g,I,n);for(let g=0;g<e.length;g+=1)e[g].m(I,null);t=!0},p(g,[t]){if(15&t){const C=g[1];ng(),e=dg(e,t,c,1,g,C,n,I,sg,LI,null,UI),Cg()}},i(g){if(!t){for(let g=0;g<C.length;g+=1)cg(e[g]);t=!0}},o(g){for(let g=0;g<e.length;g+=1)ig(e[g]);t=!1},d(g){g&&G(I);for(let g=0;g<e.length;g+=1)e[g].d()}}}function TI(g,I,t){let e;l(g,yg,g=>t(10,e=g));let n,C,c,i,{tokens:A}=I,{scroll:b}=I,{cursorPositionSeconds:s}=I,d=void 0;return g.$$set=g=>{"tokens"in g&&t(4,A=g.tokens),"scroll"in g&&t(5,b=g.scroll),"cursorPositionSeconds"in g&&t(6,s=g.cursorPositionSeconds)},g.$$.update=()=>{1024&g.$$.dirty&&t(8,n="PLAYING"===e.type),288&g.$$.dirty&&t(9,C=n?b:null),576&g.$$.dirty&&t(0,c=null===C?s:C),16&g.$$.dirty&&t(1,i=function(g){const I=[];let t=0;return g.forEach(g=>{if("NOTHING"===g.type)I.push({idx:g.idx,raw:g.raw});else{if("PARAGRAPH"===g.type)I.push({idx:g.idx,raw:g.raw,timestamp:{start:t,end:t+g.duration}});else if(I.length){const t=I[I.length-1];void 0!==t.timestamp&&(t.timestamp.end+=g.duration)}t+=g.duration}}),I}(A)),4&g.$$.dirty&&d&&d.scrollIntoView({block:"center",behavior:"auto"})},[c,i,d,function(g,I){return null!==g&&(void 0!==I&&(!(I.start>g)&&!(I.end<=g)))},A,b,s,function(g){T[g?"unshift":"push"](()=>{d=g,t(2,d)})}]}class KI extends mg{constructor(g){super(),Zg(this,g,TI,zI,i,{tokens:4,scroll:5,cursorPositionSeconds:6})}}function EI(g){let I,t,e,n,c,i,l,A,b,s,d,u,r,B,F,R,y,Y,k,v,H,N,S,U,Q,J,w,L,z,K,E,j="PLAYING"===g[11].type?"⏸️":"▶️";function M(I){g[18].call(null,I)}t=new KI({props:{tokens:g[0],scroll:g[5],cursorPositionSeconds:g[9]}}),c=new sI({props:{scroll:g[5],duration:g[8],pixelsPerSecond:g[6]}}),c.$on("timechange",g[14]);let O={scroll:g[5],pixelsPerSecond:g[6],duration:g[8]};return void 0!==g[9]&&(O.cursorPositionSeconds=g[9]),l=new cI({props:O}),T.push(()=>ug(l,"cursorPositionSeconds",M)),l.$on("play",g[19]),s=new vI({props:{tokens:g[1],scroll:g[5],pixelsPerSecond:g[6],audioDuration:g[2],canvasBounds:g[7],setToken:g[15]}}),{c(){var C,A,r;I=Z("div"),rg(t.$$.fragment),e=X(),n=Z("div"),rg(c.$$.fragment),i=X(),rg(l.$$.fragment),b=X(),rg(s.$$.fragment),d=X(),u=Z("canvas"),B=X(),F=Z("div"),R=Z("button"),y=m(j),Y=X(),k=Z("button"),v=m("⏹️"),N=X(),S=Z("button"),S.textContent="↓",U=X(),Q=Z("div"),Q.textContent="Scroll to pan, hold shift to zoom",J=X(),w=Z("div"),w.textContent="Left-click drag to adjust offset and duration",L=X(),W(u,"class","svelte-tf9odl"),W(n,"class","canvasContainer svelte-tf9odl"),P(()=>g[21].call(n)),W(R,"class","svelte-tf9odl"),k.disabled=H="STOPPED"!==g[11].type,W(k,"class","svelte-tf9odl"),C="font-size",A="30px",S.style.setProperty(C,A,r?"important":""),W(S,"class","svelte-tf9odl"),W(F,"class","buttonRow svelte-tf9odl"),W(Q,"class","instruction left svelte-tf9odl"),W(w,"class","instruction right svelte-tf9odl"),W(I,"class","container svelte-tf9odl")},m(C,A){o(C,I,A),ag(t,I,null),a(I,e),a(I,n),ag(c,n,null),a(n,i),ag(l,n,null),a(n,b),ag(s,n,null),a(n,d),a(n,u),g[20](u),r=f(n,g[21].bind(n)),a(I,B),a(I,F),a(F,R),a(R,y),a(F,Y),a(F,k),a(k,v),a(F,N),a(F,S),a(I,U),a(I,Q),a(I,J),a(I,w),o(C,L,A),z=!0,K||(E=[h(n,"wheel",V(g[12])),h(n,"contextmenu",V(g[17])),h(R,"click",V(g[22])),h(k,"click",V(g[23])),h(S,"click",V(g[24])),h(I,"mousemove",aI),h(I,"mouseup",V(rI)),h(I,"mouseout",p(V(rI))),h(document.body,"keypress",g[13])],K=!0)},p(g,I){const e={};1&I[0]&&(e.tokens=g[0]),32&I[0]&&(e.scroll=g[5]),512&I[0]&&(e.cursorPositionSeconds=g[9]),t.$set(e);const n={};32&I[0]&&(n.scroll=g[5]),256&I[0]&&(n.duration=g[8]),64&I[0]&&(n.pixelsPerSecond=g[6]),c.$set(n);const C={};32&I[0]&&(C.scroll=g[5]),64&I[0]&&(C.pixelsPerSecond=g[6]),256&I[0]&&(C.duration=g[8]),!A&&512&I[0]&&(A=!0,C.cursorPositionSeconds=g[9],D(()=>A=!1)),l.$set(C);const i={};2&I[0]&&(i.tokens=g[1]),32&I[0]&&(i.scroll=g[5]),64&I[0]&&(i.pixelsPerSecond=g[6]),4&I[0]&&(i.audioDuration=g[2]),128&I[0]&&(i.canvasBounds=g[7]),s.$set(i),(!z||2048&I[0])&&j!==(j="PLAYING"===g[11].type?"⏸️":"▶️")&&x(y,j),(!z||2048&I[0]&&H!==(H="STOPPED"!==g[11].type))&&(k.disabled=H)},i(g){z||(cg(t.$$.fragment,g),cg(c.$$.fragment,g),cg(l.$$.fragment,g),cg(s.$$.fragment,g),z=!0)},o(g){ig(t.$$.fragment,g),ig(c.$$.fragment,g),ig(l.$$.fragment,g),ig(s.$$.fragment,g),z=!1},d(e){e&&G(I),og(t),og(c),og(l),og(s),g[20](null),r(),e&&G(L),K=!1,C(E)}}}function jI(g,I,t){let e;l(g,yg,g=>t(11,e=g));let n,C,c,i,A,b,s,d,u,{tokens:r}=I,{buffer:a}=I,o=void 0,G=0,Z=0,m=200;function X(g){const I=B/m,e=-.4*I,n=d+.4*I;t(5,Z=Math.min(Math.max(e,g),n))}w(()=>{const g=c.transferControlToOffscreen();o=new qg(g,a,r,Z,m,B,G)});let B;return g.$$set=g=>{"tokens"in g&&t(0,r=g.tokens),"buffer"in g&&t(16,a=g.buffer)},g.$$.update=()=>{var I,e;1&g.$$.dirty[0]&&t(1,n=r.filter(g=>"NOTHING"!==g.type)),65536&g.$$.dirty[0]&&t(2,C=a.length/44100),1088&g.$$.dirty[0]&&t(26,i=B/m),67108896&g.$$.dirty[0]&&t(27,A=Z-i/2),67108896&g.$$.dirty[0]&&t(28,b=Z+i/2),402653184&g.$$.dirty[0]&&t(7,s={start:A,end:b}),1&g.$$.dirty[0]&&t(8,d=r.map(g=>"NOTHING"===g.type?0:g.duration).reduce((g,I)=>g+I,0)),32&g.$$.dirty[0]&&function(g){o&&o.updateScroll(g)}(Z),64&g.$$.dirty[0]&&function(g){o&&o.updateZoom(g,Z)}(m),1040&g.$$.dirty[0]&&(I=B,e=G,o&&o.updateSize(I,e))},t(10,B=-30),[r,n,C,c,G,Z,m,s,d,u,B,e,function(g){if(!c)return;const I=c.width,{deltaX:e,deltaY:n,clientX:C,shiftKey:i}=g,l=C-I/2,A=l/m;i?(n<0&&t(6,m*=1.2),n>0&&t(6,m/=1.2),t(6,m=Math.min(1e5,m))):n&&X(Z+n/m),e&&X(Z+e/m),X(Z-(l/m-A))},function(g){"Space"===g.code&&Hg(r)},function(g){X(g.detail)},function(g){t(0,r[g.idx]=g,r),function(g){o&&o.updateToken(g)}(g),Jg(g),vg(r)},a,function(I){!function(g,I){const t=g.$$.callbacks[I.type];t&&t.slice().forEach(g=>g(I))}(g,I)},function(g){u=g,t(9,u)},g=>Yg(r,g.detail),function(g){T[g?"unshift":"push"](()=>{c=g,t(3,c)})},function(){B=this.clientWidth,G=this.clientHeight,t(10,B),t(4,G)},()=>Hg(r),()=>kg(r),()=>async function(g){const I=g.map(g=>"NOTHING"===g.type?0:g.duration).reduce((g,I)=>g+I,0),t=new OfflineAudioContext({sampleRate:44100,length:44100*I});let e=0;g.forEach(g=>{"PAUSE"===g.type||"PARAGRAPH"===g.type?e+=g.duration:"AUDIO"===g.type&&(Sg(t,e,g),e+=g.duration)});const n=await t.startRendering(),C=Xg(n),c=new Uint8Array(C);Vg(c,"audio.wav")}(r)]}class MI extends mg{constructor(g){super(),Zg(this,g,jI,EI,i,{tokens:0,buffer:16},[-1,-1])}}function PI(I){let t,e,n=I[1]+"";return{c(){t=Z("h2"),e=m(n)},m(g,I){o(g,t,I),a(t,e)},p:g,i:g,o:g,d(g){g&&G(t)}}}function DI(I){let t,e;return t=new MI({props:{tokens:I[0].tokens,buffer:I[0].audio}}),{c(){rg(t.$$.fragment)},m(g,I){ag(t,g,I),e=!0},p:g,i(g){e||(cg(t.$$.fragment,g),e=!0)},o(g){ig(t.$$.fragment,g),e=!1},d(g){og(t,g)}}}function OI(I){let t;return{c(){t=Z("h2"),t.textContent="Loading save"},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function $I(g){let I,t,e,n={ctx:g,current:null,token:null,hasCatch:!0,pending:OI,then:DI,catch:PI,value:0,error:1,blocks:[,,,]};return bg(t=Lg(),n),{c(){I=B(),n.block.c()},m(g,t){o(g,I,t),n.block.m(g,n.anchor=t),n.mount=()=>I.parentNode,n.anchor=I,e=!0},p(I,[t]){{const e=(g=I).slice();e[0]=e[1]=n.resolved,n.block.p(e,t)}},i(g){e||(cg(n.block),e=!0)},o(g){for(let g=0;g<3;g+=1){ig(n.blocks[g])}e=!1},d(g){g&&G(I),n.block.d(g),n.token=null,n=null}}}class _I extends mg{constructor(g){super(),Zg(this,g,null,$I,i,{})}}const qI=new Uint32Array(65536),gt=(g,I)=>{if(g.length>I.length){const t=I;I=g,g=t}return 0===g.length?I.length:g.length<=32?((g,I)=>{const t=g.length,e=I.length,n=1<<t-1;let C=-1,c=0,i=t,l=t;for(;l--;)qI[g.charCodeAt(l)]|=1<<l;for(l=0;l<e;l++){let g=qI[I.charCodeAt(l)];const t=g|c;g|=(g&C)+C^C,c|=~(g|C),C&=g,c&n&&i++,C&n&&i--,c=c<<1|1,C=C<<1|~(t|c),c&=t}for(l=t;l--;)qI[g.charCodeAt(l)]=0;return i})(g,I):((g,I)=>{const t=g.length,e=I.length,n=[],C=[],c=Math.ceil(t/32),i=Math.ceil(e/32);let l=e;for(let g=0;g<c;g++)C[g]=-1,n[g]=0;let A=0;for(;A<i-1;A++){let c=0,i=-1;const b=32*A,s=Math.min(32,e)+b;for(let g=b;g<s;g++)qI[I.charCodeAt(g)]|=1<<g;l=e;for(let I=0;I<t;I++){const t=qI[g.charCodeAt(I)],e=C[I/32|0]>>>I&1,l=n[I/32|0]>>>I&1,A=t|c,b=((t|l)&i)+i^i|t|l;let s=c|~(b|i),d=i&b;s>>>31^e&&(C[I/32|0]^=1<<I),d>>>31^l&&(n[I/32|0]^=1<<I),s=s<<1|e,d=d<<1|l,i=d|~(A|s),c=s&A}for(let g=b;g<s;g++)qI[I.charCodeAt(g)]=0}let b=0,s=-1;const d=32*A,u=Math.min(32,e-d)+d;for(let g=d;g<u;g++)qI[I.charCodeAt(g)]|=1<<g;l=e;for(let I=0;I<t;I++){const t=qI[g.charCodeAt(I)],c=C[I/32|0]>>>I&1,i=n[I/32|0]>>>I&1,A=t|b,d=((t|i)&s)+s^s|t|i;let u=b|~(d|s),r=s&d;l+=u>>>e-1&1,l-=r>>>e-1&1,u>>>31^c&&(C[I/32|0]^=1<<I),r>>>31^i&&(n[I/32|0]^=1<<I),u=u<<1|c,r=r<<1|i,s=r|~(A|u),b=u&A}for(let g=d;g<u;g++)qI[I.charCodeAt(g)]=0;return l})(g,I)};var It={closest:(g,I)=>{let t=1/0,e=0;for(let n=0;n<I.length;n++){const C=gt(g,I[n]);C<t&&(t=C,e=n)}return I[e]},distance:gt},tt=hg((function(g,I){!function(){var t;try{t="undefined"!=typeof Intl&&void 0!==Intl.Collator?Intl.Collator("generic",{sensitivity:"base"}):null}catch(g){console.log("Collator could not be initialized and wouldn't be used")}var e=It,n=[],C=[],c={get:function(g,I,c){if(c&&t&&c.useCollator){var i,l,A,b,s,d,u=g.length,r=I.length;if(0===u)return r;if(0===r)return u;for(A=0;A<r;++A)n[A]=A,C[A]=I.charCodeAt(A);for(n[r]=r,A=0;A<u;++A){for(l=A+1,b=0;b<r;++b)i=l,d=0===t.compare(g.charAt(A),String.fromCharCode(C[b])),(l=n[b]+(d?0:1))>(s=i+1)&&(l=s),l>(s=n[b+1]+1)&&(l=s),n[b]=i;n[b]=l}return l}return e.distance(g,I)}};null!==g&&g.exports===I?g.exports=c:"undefined"!=typeof self&&"function"==typeof self.postMessage&&"function"==typeof self.importScripts?self.Levenshtein=c:"undefined"!=typeof window&&null!==window&&(window.Levenshtein=c)}()}));let et={};fetch("https://raw.githubusercontent.com/words/cmu-pronouncing-dictionary/master/index.json").then(g=>g.json()).then(g=>et=g).catch(g=>alert("Failed to fetch CMU Pronouncing Dictionary: "+g));const nt={AA:"A",AE:"B",AH:"C",AO:"D",AW:"E",AY:"F",B:"G",CH:"H",D:"I",DH:"J",EH:"K",ER:"L",EY:"M",F:"N",G:"O",HH:"P",IH:"Q",IY:"R",JH:"S",K:"T",L:"U",M:"V",N:"W",NG:"X",OW:"Y",OY:"Z",P:"1",R:"2",S:"3",SH:"4",T:"5",TH:"6",UH:"7",UW:"8",V:"9",W:"0",Y:"/",Z:"*",ZH:"+",_:"_"," ":" "};function Ct(g){return g.split(" ").map(g=>g.toLowerCase().replace(/[^a-z']/g,"")).map(g=>{if(g in et){return et[g].replace(/[^A-Z ]/g,"")}return"_"}).flatMap(g=>[...g.split(" ")," "]).map(g=>nt[g]).join("")}function ct(g){return"[object Date]"===Object.prototype.toString.call(g)}function it(g,I){if(g===I||g!=g)return()=>g;const t=typeof g;if(t!==typeof I||Array.isArray(g)!==Array.isArray(I))throw new Error("Cannot interpolate values of different type");if(Array.isArray(g)){const t=I.map((I,t)=>it(g[t],I));return g=>t.map(I=>I(g))}if("object"===t){if(!g||!I)throw new Error("Object cannot be null");if(ct(g)&&ct(I)){g=g.getTime();const t=(I=I.getTime())-g;return I=>new Date(g+I*t)}const t=Object.keys(I),e={};return t.forEach(t=>{e[t]=it(g[t],I[t])}),g=>{const I={};return t.forEach(t=>{I[t]=e[t](g)}),I}}if("number"===t){const t=I-g;return I=>g+I*t}throw new Error(`Cannot interpolate ${t} values`)}function lt(g){let I,t,e=g[0]>0&&At(g);function n(g,I){return g[3]?st:bt}let C=n(g),c=C(g);return{c(){e&&e.c(),I=X(),c.c(),t=B()},m(g,n){e&&e.m(g,n),o(g,I,n),c.m(g,n),o(g,t,n)},p(g,i){g[0]>0?e?e.p(g,i):(e=At(g),e.c(),e.m(I.parentNode,I)):e&&(e.d(1),e=null),C===(C=n(g))&&c?c.p(g,i):(c.d(1),c=C(g),c&&(c.c(),c.m(t.parentNode,t)))},d(g){e&&e.d(g),g&&G(I),c.d(g),g&&G(t)}}}function At(I){let t,e,n;return{c(){t=Z("button"),t.textContent="Old Line",W(t,"class","overrideButton svelte-g04dti")},m(g,C){o(g,t,C),e||(n=h(t,"click",I[13]),e=!0)},p:g,d(g){g&&G(t),e=!1,n()}}}function bt(I){let t,e,n;return{c(){t=Z("button"),t.textContent="New Line",W(t,"class","overrideButton svelte-g04dti")},m(g,C){o(g,t,C),e||(n=h(t,"click",I[14]),e=!0)},p:g,d(g){g&&G(t),e=!1,n()}}}function st(g){let I,t,e;return{c(){I=Z("button"),I.textContent="Completed",W(I,"class","overrideButton svelte-g04dti")},m(n,C){o(n,I,C),t||(e=h(I,"click",(function(){c(g[4])&&g[4].apply(this,arguments)})),t=!0)},p(I,t){g=I},d(g){g&&G(I),t=!1,e()}}}function dt(I){let t,e,n,c,i,l,A,b,s,d,u,r,B,V,p,F,R,y,f,k,v,H,N,S,U,Q,J,w,L,z,T,K,E,j,M,P,D,O,$,_,q,gg,Ig,tg,eg,ng=(I[1]||"NONE")+"",Cg=(I[7]?I[7].transcript:"NONE")+"",cg=I[7]&&"UNCLEAR"===I[7].decision&&lt(I);return{c(){t=Z("button"),e=m("←"),c=X(),i=Z("button"),l=m("→"),b=X(),s=Z("div"),d=Z("div"),d.textContent="If you didn't like your delivery of the last line, say it again:",u=X(),r=Z("div"),B=X(),V=Z("div"),p=X(),F=Z("div"),R=m(I[8]),y=X(),f=Z("div"),k=X(),v=Z("div"),H=X(),N=Z("div"),S=Z("div"),U=X(),Q=Z("div"),J=X(),w=Z("div"),L=Z("span"),z=m("I heard "),T=Z("b"),K=m(Cg),E=X(),j=Z("div"),M=m(I[10]),P=X(),D=Z("div"),cg&&cg.c(),O=X(),$=Z("div"),_=X(),q=Z("div"),gg=Z("div"),W(t,"class","back svelte-g04dti"),t.disabled=n=I[6]||I[0]<=ut,W(i,"class","forwards svelte-g04dti"),i.disabled=A=I[6]||I[0]>=I[2],W(d,"class","prompt svelte-g04dti"),Y(d,"hidden",0===I[0]),W(r,"class","script svelte-g04dti"),Y(r,"hidden",0===I[0]),W(V,"class","spacer svelte-g04dti"),W(F,"class","prompt svelte-g04dti"),W(f,"class","script svelte-g04dti"),W(v,"class","spacer svelte-g04dti"),W(S,"class","circle svelte-g04dti"),Y(S,"red",I[5]),W(Q,"class","circle svelte-g04dti"),Y(Q,"green",I[6]),W(N,"class","circleContainer svelte-g04dti"),W(L,"class","svelte-g04dti"),Y(L,"hidden",null===I[7]),W(w,"class","transcript svelte-g04dti"),W(j,"class","decision svelte-g04dti"),Y(j,"hidden",null===I[7]),W(D,"class","override svelte-g04dti"),W($,"class","spacer svelte-g04dti"),W(gg,"class","bar svelte-g04dti"),W(gg,"style",Ig=`width: ${I[11]}%`),W(q,"class","barContainer svelte-g04dti"),W(s,"class","column svelte-g04dti")},m(g,n){o(g,t,n),a(t,e),o(g,c,n),o(g,i,n),a(i,l),o(g,b,n),o(g,s,n),a(s,d),a(s,u),a(s,r),r.innerHTML=ng,a(s,B),a(s,V),a(s,p),a(s,F),a(F,R),a(s,y),a(s,f),f.innerHTML=I[9],a(s,k),a(s,v),a(s,H),a(s,N),a(N,S),a(N,U),a(N,Q),a(s,J),a(s,w),a(w,L),a(L,z),a(L,T),a(T,K),a(s,E),a(s,j),a(j,M),a(s,P),a(s,D),cg&&cg.m(D,null),a(s,O),a(s,$),a(s,_),a(s,q),a(q,gg),tg||(eg=[h(t,"click",I[18]),h(i,"click",I[19])],tg=!0)},p(g,I){65&I[0]&&n!==(n=g[6]||g[0]<=ut)&&(t.disabled=n),69&I[0]&&A!==(A=g[6]||g[0]>=g[2])&&(i.disabled=A),1&I[0]&&Y(d,"hidden",0===g[0]),2&I[0]&&ng!==(ng=(g[1]||"NONE")+"")&&(r.innerHTML=ng),1&I[0]&&Y(r,"hidden",0===g[0]),256&I[0]&&x(R,g[8]),512&I[0]&&(f.innerHTML=g[9]),32&I[0]&&Y(S,"red",g[5]),64&I[0]&&Y(Q,"green",g[6]),128&I[0]&&Cg!==(Cg=(g[7]?g[7].transcript:"NONE")+"")&&x(K,Cg),128&I[0]&&Y(L,"hidden",null===g[7]),1024&I[0]&&x(M,g[10]),128&I[0]&&Y(j,"hidden",null===g[7]),g[7]&&"UNCLEAR"===g[7].decision?cg?cg.p(g,I):(cg=lt(g),cg.c(),cg.m(D,null)):cg&&(cg.d(1),cg=null),2048&I[0]&&Ig!==(Ig=`width: ${g[11]}%`)&&W(gg,"style",Ig)},i:g,o:g,d(g){g&&G(t),g&&G(c),g&&G(i),g&&G(b),g&&G(s),cg&&cg.d(),tg=!1,C(eg)}}}const ut=1;function rt(g,e,n){let C,c,i,A,s,d,u,a,o,{textTokens:G}=e,{timingTokens:Z=[]}=e,{data:m=null}=e,X=0,B=0,h=()=>{},V=0,p=0,W=0;const x=new webkitSpeechRecognition;x.continuous=!1,x.lang="en-GB",x.interimResults=!1,x.maxAlternatives=1,x.onresult=g=>{x.stop(),W<=p&&(W=g.timeStamp);const I=g.results.item(0),{transcript:t,confidence:e}=I.item(0);if(n(7,f=null),o&&"completed"===t.toLowerCase())return void h();if(W-p<500)return void n(7,f={transcript:t,decision:"SHORT"});const C=Ct(t),i=void 0===a?1e3:tt.get(C,a)/a.length,l=void 0===A?1e3:tt.get(C,A)/A.length,b=e||1,s=i*b,d=i/b,u=l*b,r=l/b;if(Math.max(s,u)>Math.min(d,r))if(void 0!==i&&(void 0===l||i<l)){if(void 0!==d&&d<.5){const g=Z[Z.length-1];g.timings.start=p-V,g.timings.end=W-V,n(7,f={transcript:t,decision:"PREVIOUS"})}}else void 0!==r&&r<.5&&(n(15,Z=[...Z,{...c,timings:{start:p-V,end:W-V},type:"TIMING"}]),n(0,X++,X),n(7,f={transcript:t,decision:"CURRENT"}));null===f&&n(7,f={transcript:t,decision:"UNCLEAR",start:p-V,end:W-V})};let F=!1,R=!1;x.onerror=g=>{console.log("Speech recognition error: ",g),x.stop()},x.onstart=g=>{0===V&&(V=g.timeStamp)},x.onend=()=>{n(5,F=!1),n(6,R=!1),x.start()},x.onaudiostart=()=>{n(5,F=!0)},x.onaudioend=()=>{n(5,F=!1)},x.onspeechstart=g=>{p=g.timeStamp,n(6,R=!0)},x.onspeechend=g=>{W=g.timeStamp,n(6,R=!1)},w(()=>x.start()),navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!1,noiseSuppression:!1},video:!1}).then(g=>{const I=new MediaRecorder(g,{mimeType:"audio/webm;codecs=pcm"});I.start(),n(4,h=()=>I.stop()),I.ondataavailable=g=>{n(16,m=g.data),x.onend=()=>{},x.stop()}}).catch(g=>{console.log(g.message),"Permission denied"===g.message?(x.onerror=()=>{},alert(`Audio error: '${g.message}'. Audio permission is required because that's the whole point of the app. Click on the i in the address bar to allow then reload the page`)):alert(`Audio error: '${g.message}'.`)});let y,f=null;const Y=function(g,e={}){const n=Wg(g);let C,c=g;function i(i,l){if(null==g)return n.set(g=i),Promise.resolve();c=i;let A=C,s=!1,{delay:d=0,duration:u=400,easing:a=I,interpolate:o=it}=t(t({},e),l);if(0===u)return A&&(A.abort(),A=null),n.set(g=c),Promise.resolve();const G=b()+d;let Z;return C=r(I=>{if(I<G)return!0;s||(Z=o(g,i),"function"==typeof u&&(u=u(g,i)),s=!0),A&&(A.abort(),A=null);const t=I-G;return t>u?(n.set(g=i),!1):(n.set(g=Z(a(t/u))),!0)}),C.promise}return{set:i,update:(I,t)=>i(I(c,g),t),subscribe:n.subscribe}}(y);let k,v;l(g,Y,g=>n(11,C=g));const H={CURRENT:"I think that was the new line.",PREVIOUS:"I think that was the old line.",UNCLEAR:"I can't tell which line that is. Try again or use the buttons below.",SHORT:"I didn't notice you start talking. Try waiting a second longer between lines."};let N;return g.$$set=g=>{"textTokens"in g&&n(17,G=g.textTokens),"timingTokens"in g&&n(15,Z=g.timingTokens),"data"in g&&n(16,m=g.data)},g.$$.update=()=>{131073&g.$$.dirty[0]&&n(20,c=G[X]),1048576&g.$$.dirty[0]&&n(21,i=void 0===c?void 0:c.script),2097152&g.$$.dirty[0]&&(A=void 0===i?void 0:Ct(i)),1&g.$$.dirty[0]&&n(23,s=X?X-1:void 0),8519680&g.$$.dirty[0]&&n(24,d=void 0===s?void 0:G[s]),16777216&g.$$.dirty[0]&&n(1,u=void 0===d?void 0:d.script),2&g.$$.dirty[0]&&(a=void 0===u?void 0:Ct(u)),5&g.$$.dirty[0]&&n(2,B=Math.max(B,X)),2097152&g.$$.dirty[0]&&n(3,o=void 0===i),131073&g.$$.dirty[0]&&n(30,y=100*X/G.length),1073741824&g.$$.dirty[0]&&Y.set(y),9&g.$$.dirty[0]&&n(8,k=0===X?"To begin, say:":o?"Or if you're done, say:":"Or say the next line to move on:"),2097160&g.$$.dirty[0]&&n(9,v=o?"Completed":i||" "),128&g.$$.dirty[0]&&n(10,N=f?H[f.decision]:"NONE")},[X,u,B,o,h,F,R,f,k,v,N,C,Y,function(){const{start:g,end:I,transcript:t}=f,e=Z[Z.length-1];e.timings.start=g,e.timings.end=I,n(7,f={transcript:t,decision:"PREVIOUS"})},function(){const{start:g,end:I,transcript:t}=f;n(15,Z=[...Z,{...c,timings:{start:g,end:I},type:"TIMING"}]),n(7,f={transcript:t,decision:"CURRENT"}),n(0,X++,X)},Z,m,G,()=>n(0,X--,X),()=>n(0,X++,X)]}class at extends mg{constructor(g){super(),Zg(this,g,rt,dt,i,{textTokens:17,timingTokens:15,data:16},[-1,-1])}}function ot(I){let t,e,n=I[5]+"";return{c(){t=Z("h2"),e=m(n)},m(g,I){o(g,t,I),a(t,e)},p(g,I){2&I&&n!==(n=g[5]+"")&&x(e,n)},i:g,o:g,d(g){g&&G(t)}}}function Gt(g){let I,t,e,n={ctx:g,current:null,token:null,hasCatch:!0,pending:Vt,then:mt,catch:Zt,value:3,error:5,blocks:[,,,]};return bg(t=Rg(g[0],g[2]),n),{c(){I=B(),n.block.c()},m(g,t){o(g,I,t),n.block.m(g,n.anchor=t),n.mount=()=>I.parentNode,n.anchor=I,e=!0},p(I,e){if(g=I,n.ctx=g,3&e&&t!==(t=Rg(g[0],g[2]))&&bg(t,n));else{const I=g.slice();I[3]=I[5]=n.resolved,n.block.p(I,e)}},i(g){e||(cg(n.block),e=!0)},o(g){for(let g=0;g<3;g+=1){ig(n.blocks[g])}e=!1},d(g){g&&G(I),n.block.d(g),n.token=null,n=null}}}function Zt(I){let t,e,n=I[5]+"";return{c(){t=Z("h2"),e=m(n)},m(g,I){o(g,t,I),a(t,e)},p(g,I){3&I&&n!==(n=g[5]+"")&&x(e,n)},i:g,o:g,d(g){g&&G(t)}}}function mt(g){let I,t,e,n={ctx:g,current:null,token:null,hasCatch:!0,pending:ht,then:Bt,catch:Xt,value:4,error:5,blocks:[,,,]};return bg(t=Promise.all([Ug(g[1]),Qg(g[3])]),n),{c(){I=B(),n.block.c()},m(g,t){o(g,I,t),n.block.m(g,n.anchor=t),n.mount=()=>I.parentNode,n.anchor=I,e=!0},p(I,e){if(g=I,n.ctx=g,3&e&&t!==(t=Promise.all([Ug(g[1]),Qg(g[3])]))&&bg(t,n));else{const I=g.slice();I[4]=I[5]=n.resolved,n.block.p(I,e)}},i(g){e||(cg(n.block),e=!0)},o(g){for(let g=0;g<3;g+=1){ig(n.blocks[g])}e=!1},d(g){g&&G(I),n.block.d(g),n.token=null,n=null}}}function Xt(I){let t,e,n=I[5]+"";return{c(){t=Z("h2"),e=m(n)},m(g,I){o(g,t,I),a(t,e)},p(g,I){3&I&&n!==(n=g[5]+"")&&x(e,n)},i:g,o:g,d(g){g&&G(t)}}}function Bt(g){let I,t;return I=new MI({props:{tokens:g[3],buffer:g[2]}}),{c(){rg(I.$$.fragment)},m(g,e){ag(I,g,e),t=!0},p(g,t){const e={};3&t&&(e.tokens=g[3]),2&t&&(e.buffer=g[2]),I.$set(e)},i(g){t||(cg(I.$$.fragment,g),t=!0)},o(g){ig(I.$$.fragment,g),t=!1},d(g){og(I,g)}}}function ht(I){let t;return{c(){t=Z("h2"),t.textContent="Saving..."},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function Vt(I){let t;return{c(){t=Z("h2"),t.textContent="Processing Timings..."},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function pt(I){let t;return{c(){t=Z("h2"),t.textContent="Processing Microphone Audio..."},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function Wt(g){let I,t,e,n={ctx:g,current:null,token:null,hasCatch:!0,pending:pt,then:Gt,catch:ot,value:2,error:5,blocks:[,,,]};return bg(t=Ng(g[1]),n),{c(){I=B(),n.block.c()},m(g,t){o(g,I,t),n.block.m(g,n.anchor=t),n.mount=()=>I.parentNode,n.anchor=I,e=!0},p(I,[e]){if(g=I,n.ctx=g,2&e&&t!==(t=Ng(g[1]))&&bg(t,n));else{const I=g.slice();I[2]=I[5]=n.resolved,n.block.p(I,e)}},i(g){e||(cg(n.block),e=!0)},o(g){for(let g=0;g<3;g+=1){ig(n.blocks[g])}e=!1},d(g){g&&G(I),n.block.d(g),n.token=null,n=null}}}function xt(g,I,t){let{processingTokens:e}=I,{data:n}=I;return Ug(n),g.$$set=g=>{"processingTokens"in g&&t(0,e=g.processingTokens),"data"in g&&t(1,n=g.data)},[e,n]}class Ft extends mg{constructor(g){super(),Zg(this,g,xt,Wt,i,{processingTokens:0,data:1})}}var Rt=hg((function(g,I){g.exports=function(){function g(g,I){for(var t=0;t<I.length;t++){var e=I[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(g,e.key,e)}}function I(g,I){(null==I||I>g.length)&&(I=g.length);for(var t=0,e=new Array(I);t<I;t++)e[t]=g[t];return e}function t(g,t){var e;if("undefined"==typeof Symbol||null==g[Symbol.iterator]){if(Array.isArray(g)||(e=function(g,t){if(g){if("string"==typeof g)return I(g,t);var e=Object.prototype.toString.call(g).slice(8,-1);return"Object"===e&&g.constructor&&(e=g.constructor.name),"Map"===e||"Set"===e?Array.from(g):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?I(g,t):void 0}}(g))||t&&g&&"number"==typeof g.length){e&&(g=e);var n=0;return function(){return n>=g.length?{done:!0}:{done:!1,value:g[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(e=g[Symbol.iterator]()).next.bind(e)}var e=function(g,I){return g(I={exports:{}},I.exports),I.exports}((function(g){function I(){return{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1}}g.exports={defaults:{baseUrl:null,breaks:!1,gfm:!0,headerIds:!0,headerPrefix:"",highlight:null,langPrefix:"language-",mangle:!0,pedantic:!1,renderer:null,sanitize:!1,sanitizer:null,silent:!1,smartLists:!1,smartypants:!1,tokenizer:null,walkTokens:null,xhtml:!1},getDefaults:I,changeDefaults:function(I){g.exports.defaults=I}}})),n=(e.defaults,e.getDefaults,e.changeDefaults,/[&<>"']/),C=/[&<>"']/g,c=/[<>"']|&(?!#?\w+;)/,i=/[<>"']|&(?!#?\w+;)/g,l={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},A=function(g){return l[g]},b=/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi;function s(g){return g.replace(b,(function(g,I){return"colon"===(I=I.toLowerCase())?":":"#"===I.charAt(0)?"x"===I.charAt(1)?String.fromCharCode(parseInt(I.substring(2),16)):String.fromCharCode(+I.substring(1)):""}))}var d=/(^|[^\[])\^/g,u=/[^\w:]/g,r=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i,a={},o=/^[^:]+:\/*[^/]*$/,G=/^([^:]+:)[\s\S]*$/,Z=/^([^:]+:\/*[^/]*)[\s\S]*$/;function m(g,I){a[" "+g]||(o.test(g)?a[" "+g]=g+"/":a[" "+g]=X(g,"/",!0));var t=-1===(g=a[" "+g]).indexOf(":");return"//"===I.substring(0,2)?t?I:g.replace(G,"$1")+I:"/"===I.charAt(0)?t?I:g.replace(Z,"$1")+I:g+I}function X(g,I,t){var e=g.length;if(0===e)return"";for(var n=0;n<e;){var C=g.charAt(e-n-1);if(C!==I||t){if(C===I||!t)break;n++}else n++}return g.substr(0,e-n)}var B=function(g,I){if(I){if(n.test(g))return g.replace(C,A)}else if(c.test(g))return g.replace(i,A);return g},h=s,V=function(g,I){g=g.source||g,I=I||"";var t={replace:function(I,e){return e=(e=e.source||e).replace(d,"$1"),g=g.replace(I,e),t},getRegex:function(){return new RegExp(g,I)}};return t},p=function(g,I,t){if(g){var e;try{e=decodeURIComponent(s(t)).replace(u,"").toLowerCase()}catch(g){return null}if(0===e.indexOf("javascript:")||0===e.indexOf("vbscript:")||0===e.indexOf("data:"))return null}I&&!r.test(t)&&(t=m(I,t));try{t=encodeURI(t).replace(/%25/g,"%")}catch(g){return null}return t},W={exec:function(){}},x=function(g){for(var I,t,e=1;e<arguments.length;e++)for(t in I=arguments[e])Object.prototype.hasOwnProperty.call(I,t)&&(g[t]=I[t]);return g},F=function(g,I){var t=g.replace(/\|/g,(function(g,I,t){for(var e=!1,n=I;--n>=0&&"\\"===t[n];)e=!e;return e?"|":" |"})).split(/ \|/),e=0;if(t.length>I)t.splice(I);else for(;t.length<I;)t.push("");for(;e<t.length;e++)t[e]=t[e].trim().replace(/\\\|/g,"|");return t},R=X,y=function(g,I){if(-1===g.indexOf(I[1]))return-1;for(var t=g.length,e=0,n=0;n<t;n++)if("\\"===g[n])n++;else if(g[n]===I[0])e++;else if(g[n]===I[1]&&--e<0)return n;return-1},f=function(g){g&&g.sanitize&&!g.silent&&console.warn("marked(): sanitize and sanitizer parameters are deprecated since version 0.7.0, should not be used and will be removed in the future. Read more here: https://marked.js.org/#/USING_ADVANCED.md#options")},Y=function(g,I){if(I<1)return"";for(var t="";I>1;)1&I&&(t+=g),I>>=1,g+=g;return t+g},k=e.defaults,v=R,H=F,N=B,S=y;function U(g,I,t){var e=I.href,n=I.title?N(I.title):null,C=g[1].replace(/\\([\[\]])/g,"$1");return"!"!==g[0].charAt(0)?{type:"link",raw:t,href:e,title:n,text:C}:{type:"image",raw:t,href:e,title:n,text:N(C)}}var Q=function(){function g(g){this.options=g||k}var I=g.prototype;return I.space=function(g){var I=this.rules.block.newline.exec(g);if(I)return I[0].length>1?{type:"space",raw:I[0]}:{raw:"\n"}},I.code=function(g,I){var t=this.rules.block.code.exec(g);if(t){var e=I[I.length-1];if(e&&"paragraph"===e.type)return{raw:t[0],text:t[0].trimRight()};var n=t[0].replace(/^ {4}/gm,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?n:v(n,"\n")}}},I.fences=function(g){var I=this.rules.block.fences.exec(g);if(I){var t=I[0],e=function(g,I){var t=g.match(/^(\s+)(?:```)/);if(null===t)return I;var e=t[1];return I.split("\n").map((function(g){var I=g.match(/^\s+/);return null===I?g:I[0].length>=e.length?g.slice(e.length):g})).join("\n")}(t,I[3]||"");return{type:"code",raw:t,lang:I[2]?I[2].trim():I[2],text:e}}},I.heading=function(g){var I=this.rules.block.heading.exec(g);if(I)return{type:"heading",raw:I[0],depth:I[1].length,text:I[2]}},I.nptable=function(g){var I=this.rules.block.nptable.exec(g);if(I){var t={type:"table",header:H(I[1].replace(/^ *| *\| *$/g,"")),align:I[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:I[3]?I[3].replace(/\n$/,"").split("\n"):[],raw:I[0]};if(t.header.length===t.align.length){var e,n=t.align.length;for(e=0;e<n;e++)/^ *-+: *$/.test(t.align[e])?t.align[e]="right":/^ *:-+: *$/.test(t.align[e])?t.align[e]="center":/^ *:-+ *$/.test(t.align[e])?t.align[e]="left":t.align[e]=null;for(n=t.cells.length,e=0;e<n;e++)t.cells[e]=H(t.cells[e],t.header.length);return t}}},I.hr=function(g){var I=this.rules.block.hr.exec(g);if(I)return{type:"hr",raw:I[0]}},I.blockquote=function(g){var I=this.rules.block.blockquote.exec(g);if(I){var t=I[0].replace(/^ *> ?/gm,"");return{type:"blockquote",raw:I[0],text:t}}},I.list=function(g){var I=this.rules.block.list.exec(g);if(I){for(var t,e,n,C,c,i,l,A=I[0],b=I[2],s=b.length>1,d=")"===b[b.length-1],u={type:"list",raw:A,ordered:s,start:s?+b.slice(0,-1):"",loose:!1,items:[]},r=I[0].match(this.rules.block.item),a=!1,o=r.length,G=0;G<o;G++)A=t=r[G],e=t.length,~(t=t.replace(/^ *([*+-]|\d+[.)]) ?/,"")).indexOf("\n ")&&(e-=t.length,t=this.options.pedantic?t.replace(/^ {1,4}/gm,""):t.replace(new RegExp("^ {1,"+e+"}","gm"),"")),G!==o-1&&(n=this.rules.block.bullet.exec(r[G+1])[0],(s?1===n.length||!d&&")"===n[n.length-1]:n.length>1||this.options.smartLists&&n!==b)&&(C=r.slice(G+1).join("\n"),u.raw=u.raw.substring(0,u.raw.length-C.length),G=o-1)),c=a||/\n\n(?!\s*$)/.test(t),G!==o-1&&(a="\n"===t.charAt(t.length-1),c||(c=a)),c&&(u.loose=!0),l=void 0,(i=/^\[[ xX]\] /.test(t))&&(l=" "!==t[1],t=t.replace(/^\[[ xX]\] +/,"")),u.items.push({type:"list_item",raw:A,task:i,checked:l,loose:c,text:t});return u}},I.html=function(g){var I=this.rules.block.html.exec(g);if(I)return{type:this.options.sanitize?"paragraph":"html",raw:I[0],pre:!this.options.sanitizer&&("pre"===I[1]||"script"===I[1]||"style"===I[1]),text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(I[0]):N(I[0]):I[0]}},I.def=function(g){var I=this.rules.block.def.exec(g);if(I)return I[3]&&(I[3]=I[3].substring(1,I[3].length-1)),{tag:I[1].toLowerCase().replace(/\s+/g," "),raw:I[0],href:I[2],title:I[3]}},I.table=function(g){var I=this.rules.block.table.exec(g);if(I){var t={type:"table",header:H(I[1].replace(/^ *| *\| *$/g,"")),align:I[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:I[3]?I[3].replace(/\n$/,"").split("\n"):[]};if(t.header.length===t.align.length){t.raw=I[0];var e,n=t.align.length;for(e=0;e<n;e++)/^ *-+: *$/.test(t.align[e])?t.align[e]="right":/^ *:-+: *$/.test(t.align[e])?t.align[e]="center":/^ *:-+ *$/.test(t.align[e])?t.align[e]="left":t.align[e]=null;for(n=t.cells.length,e=0;e<n;e++)t.cells[e]=H(t.cells[e].replace(/^ *\| *| *\| *$/g,""),t.header.length);return t}}},I.lheading=function(g){var I=this.rules.block.lheading.exec(g);if(I)return{type:"heading",raw:I[0],depth:"="===I[2].charAt(0)?1:2,text:I[1]}},I.paragraph=function(g){var I=this.rules.block.paragraph.exec(g);if(I)return{type:"paragraph",raw:I[0],text:"\n"===I[1].charAt(I[1].length-1)?I[1].slice(0,-1):I[1]}},I.text=function(g,I){var t=this.rules.block.text.exec(g);if(t){var e=I[I.length-1];return e&&"text"===e.type?{raw:t[0],text:t[0]}:{type:"text",raw:t[0],text:t[0]}}},I.escape=function(g){var I=this.rules.inline.escape.exec(g);if(I)return{type:"escape",raw:I[0],text:N(I[1])}},I.tag=function(g,I,t){var e=this.rules.inline.tag.exec(g);if(e)return!I&&/^<a /i.test(e[0])?I=!0:I&&/^<\/a>/i.test(e[0])&&(I=!1),!t&&/^<(pre|code|kbd|script)(\s|>)/i.test(e[0])?t=!0:t&&/^<\/(pre|code|kbd|script)(\s|>)/i.test(e[0])&&(t=!1),{type:this.options.sanitize?"text":"html",raw:e[0],inLink:I,inRawBlock:t,text:this.options.sanitize?this.options.sanitizer?this.options.sanitizer(e[0]):N(e[0]):e[0]}},I.link=function(g){var I=this.rules.inline.link.exec(g);if(I){var t=S(I[2],"()");if(t>-1){var e=(0===I[0].indexOf("!")?5:4)+I[1].length+t;I[2]=I[2].substring(0,t),I[0]=I[0].substring(0,e).trim(),I[3]=""}var n=I[2],C="";if(this.options.pedantic){var c=/^([^'"]*[^\s])\s+(['"])(.*)\2/.exec(n);c?(n=c[1],C=c[3]):C=""}else C=I[3]?I[3].slice(1,-1):"";return U(I,{href:(n=n.trim().replace(/^<([\s\S]*)>$/,"$1"))?n.replace(this.rules.inline._escapes,"$1"):n,title:C?C.replace(this.rules.inline._escapes,"$1"):C},I[0])}},I.reflink=function(g,I){var t;if((t=this.rules.inline.reflink.exec(g))||(t=this.rules.inline.nolink.exec(g))){var e=(t[2]||t[1]).replace(/\s+/g," ");if(!(e=I[e.toLowerCase()])||!e.href){var n=t[0].charAt(0);return{type:"text",raw:n,text:n}}return U(t,e,t[0])}},I.strong=function(g,I,t){void 0===t&&(t="");var e=this.rules.inline.strong.start.exec(g);if(e&&(!e[1]||e[1]&&(""===t||this.rules.inline.punctuation.exec(t)))){I=I.slice(-1*g.length);var n,C="**"===e[0]?this.rules.inline.strong.endAst:this.rules.inline.strong.endUnd;for(C.lastIndex=0;null!=(e=C.exec(I));)if(n=this.rules.inline.strong.middle.exec(I.slice(0,e.index+3)))return{type:"strong",raw:g.slice(0,n[0].length),text:g.slice(2,n[0].length-2)}}},I.em=function(g,I,t){void 0===t&&(t="");var e=this.rules.inline.em.start.exec(g);if(e&&(!e[1]||e[1]&&(""===t||this.rules.inline.punctuation.exec(t)))){I=I.slice(-1*g.length);var n,C="*"===e[0]?this.rules.inline.em.endAst:this.rules.inline.em.endUnd;for(C.lastIndex=0;null!=(e=C.exec(I));)if(n=this.rules.inline.em.middle.exec(I.slice(0,e.index+2)))return{type:"em",raw:g.slice(0,n[0].length),text:g.slice(1,n[0].length-1)}}},I.codespan=function(g){var I=this.rules.inline.code.exec(g);if(I){var t=I[2].replace(/\n/g," "),e=/[^ ]/.test(t),n=t.startsWith(" ")&&t.endsWith(" ");return e&&n&&(t=t.substring(1,t.length-1)),t=N(t,!0),{type:"codespan",raw:I[0],text:t}}},I.br=function(g){var I=this.rules.inline.br.exec(g);if(I)return{type:"br",raw:I[0]}},I.del=function(g){var I=this.rules.inline.del.exec(g);if(I)return{type:"del",raw:I[0],text:I[1]}},I.autolink=function(g,I){var t,e,n=this.rules.inline.autolink.exec(g);if(n)return e="@"===n[2]?"mailto:"+(t=N(this.options.mangle?I(n[1]):n[1])):t=N(n[1]),{type:"link",raw:n[0],text:t,href:e,tokens:[{type:"text",raw:t,text:t}]}},I.url=function(g,I){var t;if(t=this.rules.inline.url.exec(g)){var e,n;if("@"===t[2])n="mailto:"+(e=N(this.options.mangle?I(t[0]):t[0]));else{var C;do{C=t[0],t[0]=this.rules.inline._backpedal.exec(t[0])[0]}while(C!==t[0]);e=N(t[0]),n="www."===t[1]?"http://"+e:e}return{type:"link",raw:t[0],text:e,href:n,tokens:[{type:"text",raw:e,text:e}]}}},I.inlineText=function(g,I,t){var e,n=this.rules.inline.text.exec(g);if(n)return e=I?this.options.sanitize?this.options.sanitizer?this.options.sanitizer(n[0]):N(n[0]):n[0]:N(this.options.smartypants?t(n[0]):n[0]),{type:"text",raw:n[0],text:e}},g}(),J=W,w=V,L=x,z={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:/^ {0,3}(`{3,}(?=[^`\n]*\n)|~{3,})([^\n]*)\n(?:|([\s\S]*?)\n)(?: {0,3}\1[~`]* *(?:\n+|$)|$)/,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ {0,3}(#{1,6}) +([^\n]*?)(?: +#+)? *(?:\n+|$)/,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( {0,3})(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:"^ {0,3}(?:<(script|pre|style)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:\\n{2,}|$)|<(?!script|pre|style)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$)|</(?!script|pre|style)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:\\n{2,}|$))",def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,nptable:J,table:J,lheading:/^([^\n]+)\n {0,3}(=+|-+) *(?:\n+|$)/,_paragraph:/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html)[^\n]+)*)/,text:/^[^\n]+/,_label:/(?!\s*\])(?:\\[\[\]]|[^\[\]])+/,_title:/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/};z.def=w(z.def).replace("label",z._label).replace("title",z._title).getRegex(),z.bullet=/(?:[*+-]|\d{1,9}[.)])/,z.item=/^( *)(bull) ?[^\n]*(?:\n(?!\1bull ?)[^\n]*)*/,z.item=w(z.item,"gm").replace(/bull/g,z.bullet).getRegex(),z.list=w(z.list).replace(/bull/g,z.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+z.def.source+")").getRegex(),z._tag="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|section|source|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",z._comment=/<!--(?!-?>)[\s\S]*?(?:-->|$)/,z.html=w(z.html,"i").replace("comment",z._comment).replace("tag",z._tag).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),z.paragraph=w(z._paragraph).replace("hr",z.hr).replace("heading"," {0,3}#{1,6} ").replace("|lheading","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",z._tag).getRegex(),z.blockquote=w(z.blockquote).replace("paragraph",z.paragraph).getRegex(),z.normal=L({},z),z.gfm=L({},z.normal,{nptable:"^ *([^|\\n ].*\\|.*)\\n {0,3}([-:]+ *\\|[-| :]*)(?:\\n((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)",table:"^ *\\|(.+)\\n {0,3}\\|?( *[-:]+[-| :]*)(?:\\n *((?:(?!\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)"}),z.gfm.nptable=w(z.gfm.nptable).replace("hr",z.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",z._tag).getRegex(),z.gfm.table=w(z.gfm.table).replace("hr",z.hr).replace("heading"," {0,3}#{1,6} ").replace("blockquote"," {0,3}>").replace("code"," {4}[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|!--)").replace("tag",z._tag).getRegex(),z.pedantic=L({},z.normal,{html:w("^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:\"[^\"]*\"|'[^']*'|\\s[^'\"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))").replace("comment",z._comment).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *(?:#+ *)?(?:\n+|$)/,fences:J,paragraph:w(z.normal._paragraph).replace("hr",z.hr).replace("heading"," *#{1,6} *[^\n]").replace("lheading",z.lheading).replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").getRegex()});var T={escape:/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:J,tag:"^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>",link:/^!?\[(label)\]\(\s*(href)(?:\s+(title))?\s*\)/,reflink:/^!?\[(label)\]\[(?!\s*\])((?:\\[\[\]]?|[^\[\]\\])+)\]/,nolink:/^!?\[(?!\s*\])((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\](?:\[\])?/,reflinkSearch:"reflink|nolink(?!\\()",strong:{start:/^(?:(\*\*(?=[*punctuation]))|\*\*)(?![\s])|__/,middle:/^\*\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*\*$|^__(?![\s])((?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?)__$/,endAst:/[^punctuation\s]\*\*(?!\*)|[punctuation]\*\*(?!\*)(?:(?=[punctuation_\s]|$))/,endUnd:/[^\s]__(?!_)(?:(?=[punctuation*\s])|$)/},em:{start:/^(?:(\*(?=[punctuation]))|\*)(?![*\s])|_/,middle:/^\*(?:(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)|\*(?:(?!overlapSkip)(?:[^*]|\\\*)|overlapSkip)*?\*)+?\*$|^_(?![_\s])(?:(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)|_(?:(?!overlapSkip)(?:[^_]|\\_)|overlapSkip)*?_)+?_$/,endAst:/[^punctuation\s]\*(?!\*)|[punctuation]\*(?!\*)(?:(?=[punctuation_\s]|$))/,endUnd:/[^\s]_(?!_)(?:(?=[punctuation*\s])|$)/},code:/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,br:/^( {2,}|\\)\n(?!\s*$)/,del:J,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*]|\b_|$)|[^ ](?= {2,}\n)))/,punctuation:/^([\s*punctuation])/,_punctuation:"!\"#$%&'()+\\-.,/:;<=>?@\\[\\]`^{|}~"};T.punctuation=w(T.punctuation).replace(/punctuation/g,T._punctuation).getRegex(),T._blockSkip="\\[[^\\]]*?\\]\\([^\\)]*?\\)|`[^`]*?`|<[^>]*?>",T._overlapSkip="__[^_]*?__|\\*\\*\\[^\\*\\]*?\\*\\*",T._comment=w(z._comment).replace("(?:--\x3e|$)","--\x3e").getRegex(),T.em.start=w(T.em.start).replace(/punctuation/g,T._punctuation).getRegex(),T.em.middle=w(T.em.middle).replace(/punctuation/g,T._punctuation).replace(/overlapSkip/g,T._overlapSkip).getRegex(),T.em.endAst=w(T.em.endAst,"g").replace(/punctuation/g,T._punctuation).getRegex(),T.em.endUnd=w(T.em.endUnd,"g").replace(/punctuation/g,T._punctuation).getRegex(),T.strong.start=w(T.strong.start).replace(/punctuation/g,T._punctuation).getRegex(),T.strong.middle=w(T.strong.middle).replace(/punctuation/g,T._punctuation).replace(/overlapSkip/g,T._overlapSkip).getRegex(),T.strong.endAst=w(T.strong.endAst,"g").replace(/punctuation/g,T._punctuation).getRegex(),T.strong.endUnd=w(T.strong.endUnd,"g").replace(/punctuation/g,T._punctuation).getRegex(),T.blockSkip=w(T._blockSkip,"g").getRegex(),T.overlapSkip=w(T._overlapSkip,"g").getRegex(),T._escapes=/\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/g,T._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,T._email=/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,T.autolink=w(T.autolink).replace("scheme",T._scheme).replace("email",T._email).getRegex(),T._attribute=/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/,T.tag=w(T.tag).replace("comment",T._comment).replace("attribute",T._attribute).getRegex(),T._label=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,T._href=/<(?:\\[<>]?|[^\s<>\\])*>|[^\s\x00-\x1f]*/,T._title=/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/,T.link=w(T.link).replace("label",T._label).replace("href",T._href).replace("title",T._title).getRegex(),T.reflink=w(T.reflink).replace("label",T._label).getRegex(),T.reflinkSearch=w(T.reflinkSearch,"g").replace("reflink",T.reflink).replace("nolink",T.nolink).getRegex(),T.normal=L({},T),T.pedantic=L({},T.normal,{strong:{start:/^__|\*\*/,middle:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,endAst:/\*\*(?!\*)/g,endUnd:/__(?!_)/g},em:{start:/^_|\*/,middle:/^()\*(?=\S)([\s\S]*?\S)\*(?!\*)|^_(?=\S)([\s\S]*?\S)_(?!_)/,endAst:/\*(?!\*)/g,endUnd:/_(?!_)/g},link:w(/^!?\[(label)\]\((.*?)\)/).replace("label",T._label).getRegex(),reflink:w(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",T._label).getRegex()}),T.gfm=L({},T.normal,{escape:w(T.escape).replace("])","~|])").getRegex(),_extended_email:/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/,url:/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~+(?=\S)([\s\S]*?\S)~+/,text:/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*~]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@))/}),T.gfm.url=w(T.gfm.url,"i").replace("email",T.gfm._extended_email).getRegex(),T.breaks=L({},T.gfm,{br:w(T.br).replace("{2,}","*").getRegex(),text:w(T.gfm.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()});var K={block:z,inline:T},E=e.defaults,j=K.block,M=K.inline,P=Y;function D(g){return g.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…")}function O(g){var I,t,e="",n=g.length;for(I=0;I<n;I++)t=g.charCodeAt(I),Math.random()>.5&&(t="x"+t.toString(16)),e+="&#"+t+";";return e}var $=function(){function I(g){this.tokens=[],this.tokens.links=Object.create(null),this.options=g||E,this.options.tokenizer=this.options.tokenizer||new Q,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options;var I={block:j.normal,inline:M.normal};this.options.pedantic?(I.block=j.pedantic,I.inline=M.pedantic):this.options.gfm&&(I.block=j.gfm,this.options.breaks?I.inline=M.breaks:I.inline=M.gfm),this.tokenizer.rules=I}I.lex=function(g,t){return new I(t).lex(g)},I.lexInline=function(g,t){return new I(t).inlineTokens(g)};var t,e,n,C=I.prototype;return C.lex=function(g){return g=g.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    "),this.blockTokens(g,this.tokens,!0),this.inline(this.tokens),this.tokens},C.blockTokens=function(g,I,t){var e,n,C,c;for(void 0===I&&(I=[]),void 0===t&&(t=!0),g=g.replace(/^ +$/gm,"");g;)if(e=this.tokenizer.space(g))g=g.substring(e.raw.length),e.type&&I.push(e);else if(e=this.tokenizer.code(g,I))g=g.substring(e.raw.length),e.type?I.push(e):((c=I[I.length-1]).raw+="\n"+e.raw,c.text+="\n"+e.text);else if(e=this.tokenizer.fences(g))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.heading(g))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.nptable(g))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.hr(g))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.blockquote(g))g=g.substring(e.raw.length),e.tokens=this.blockTokens(e.text,[],t),I.push(e);else if(e=this.tokenizer.list(g)){for(g=g.substring(e.raw.length),C=e.items.length,n=0;n<C;n++)e.items[n].tokens=this.blockTokens(e.items[n].text,[],!1);I.push(e)}else if(e=this.tokenizer.html(g))g=g.substring(e.raw.length),I.push(e);else if(t&&(e=this.tokenizer.def(g)))g=g.substring(e.raw.length),this.tokens.links[e.tag]||(this.tokens.links[e.tag]={href:e.href,title:e.title});else if(e=this.tokenizer.table(g))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.lheading(g))g=g.substring(e.raw.length),I.push(e);else if(t&&(e=this.tokenizer.paragraph(g)))g=g.substring(e.raw.length),I.push(e);else if(e=this.tokenizer.text(g,I))g=g.substring(e.raw.length),e.type?I.push(e):((c=I[I.length-1]).raw+="\n"+e.raw,c.text+="\n"+e.text);else if(g){var i="Infinite loop on byte: "+g.charCodeAt(0);if(this.options.silent){console.error(i);break}throw new Error(i)}return I},C.inline=function(g){var I,t,e,n,C,c,i=g.length;for(I=0;I<i;I++)switch((c=g[I]).type){case"paragraph":case"text":case"heading":c.tokens=[],this.inlineTokens(c.text,c.tokens);break;case"table":for(c.tokens={header:[],cells:[]},n=c.header.length,t=0;t<n;t++)c.tokens.header[t]=[],this.inlineTokens(c.header[t],c.tokens.header[t]);for(n=c.cells.length,t=0;t<n;t++)for(C=c.cells[t],c.tokens.cells[t]=[],e=0;e<C.length;e++)c.tokens.cells[t][e]=[],this.inlineTokens(C[e],c.tokens.cells[t][e]);break;case"blockquote":this.inline(c.tokens);break;case"list":for(n=c.items.length,t=0;t<n;t++)this.inline(c.items[t].tokens)}return g},C.inlineTokens=function(g,I,t,e,n){var C;void 0===I&&(I=[]),void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n="");var c,i=g;if(this.tokens.links){var l=Object.keys(this.tokens.links);if(l.length>0)for(;null!=(c=this.tokenizer.rules.inline.reflinkSearch.exec(i));)l.includes(c[0].slice(c[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,c.index)+"["+P("a",c[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;null!=(c=this.tokenizer.rules.inline.blockSkip.exec(i));)i=i.slice(0,c.index)+"["+P("a",c[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);for(;g;)if(C=this.tokenizer.escape(g))g=g.substring(C.raw.length),I.push(C);else if(C=this.tokenizer.tag(g,t,e))g=g.substring(C.raw.length),t=C.inLink,e=C.inRawBlock,I.push(C);else if(C=this.tokenizer.link(g))g=g.substring(C.raw.length),"link"===C.type&&(C.tokens=this.inlineTokens(C.text,[],!0,e)),I.push(C);else if(C=this.tokenizer.reflink(g,this.tokens.links))g=g.substring(C.raw.length),"link"===C.type&&(C.tokens=this.inlineTokens(C.text,[],!0,e)),I.push(C);else if(C=this.tokenizer.strong(g,i,n))g=g.substring(C.raw.length),C.tokens=this.inlineTokens(C.text,[],t,e),I.push(C);else if(C=this.tokenizer.em(g,i,n))g=g.substring(C.raw.length),C.tokens=this.inlineTokens(C.text,[],t,e),I.push(C);else if(C=this.tokenizer.codespan(g))g=g.substring(C.raw.length),I.push(C);else if(C=this.tokenizer.br(g))g=g.substring(C.raw.length),I.push(C);else if(C=this.tokenizer.del(g))g=g.substring(C.raw.length),C.tokens=this.inlineTokens(C.text,[],t,e),I.push(C);else if(C=this.tokenizer.autolink(g,O))g=g.substring(C.raw.length),I.push(C);else if(t||!(C=this.tokenizer.url(g,O))){if(C=this.tokenizer.inlineText(g,e,D))g=g.substring(C.raw.length),n=C.raw.slice(-1),I.push(C);else if(g){var A="Infinite loop on byte: "+g.charCodeAt(0);if(this.options.silent){console.error(A);break}throw new Error(A)}}else g=g.substring(C.raw.length),I.push(C);return I},t=I,n=[{key:"rules",get:function(){return{block:j,inline:M}}}],(e=null)&&g(t.prototype,e),n&&g(t,n),I}(),_=e.defaults,q=p,gg=B,Ig=function(){function g(g){this.options=g||_}var I=g.prototype;return I.code=function(g,I,t){var e=(I||"").match(/\S*/)[0];if(this.options.highlight){var n=this.options.highlight(g,e);null!=n&&n!==g&&(t=!0,g=n)}return e?'<pre><code class="'+this.options.langPrefix+gg(e,!0)+'">'+(t?g:gg(g,!0))+"</code></pre>\n":"<pre><code>"+(t?g:gg(g,!0))+"</code></pre>\n"},I.blockquote=function(g){return"<blockquote>\n"+g+"</blockquote>\n"},I.html=function(g){return g},I.heading=function(g,I,t,e){return this.options.headerIds?"<h"+I+' id="'+this.options.headerPrefix+e.slug(t)+'">'+g+"</h"+I+">\n":"<h"+I+">"+g+"</h"+I+">\n"},I.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},I.list=function(g,I,t){var e=I?"ol":"ul";return"<"+e+(I&&1!==t?' start="'+t+'"':"")+">\n"+g+"</"+e+">\n"},I.listitem=function(g){return"<li>"+g+"</li>\n"},I.checkbox=function(g){return"<input "+(g?'checked="" ':"")+'disabled="" type="checkbox"'+(this.options.xhtml?" /":"")+"> "},I.paragraph=function(g){return"<p>"+g+"</p>\n"},I.table=function(g,I){return I&&(I="<tbody>"+I+"</tbody>"),"<table>\n<thead>\n"+g+"</thead>\n"+I+"</table>\n"},I.tablerow=function(g){return"<tr>\n"+g+"</tr>\n"},I.tablecell=function(g,I){var t=I.header?"th":"td";return(I.align?"<"+t+' align="'+I.align+'">':"<"+t+">")+g+"</"+t+">\n"},I.strong=function(g){return"<strong>"+g+"</strong>"},I.em=function(g){return"<em>"+g+"</em>"},I.codespan=function(g){return"<code>"+g+"</code>"},I.br=function(){return this.options.xhtml?"<br/>":"<br>"},I.del=function(g){return"<del>"+g+"</del>"},I.link=function(g,I,t){if(null===(g=q(this.options.sanitize,this.options.baseUrl,g)))return t;var e='<a href="'+gg(g)+'"';return I&&(e+=' title="'+I+'"'),e+=">"+t+"</a>"},I.image=function(g,I,t){if(null===(g=q(this.options.sanitize,this.options.baseUrl,g)))return t;var e='<img src="'+g+'" alt="'+t+'"';return I&&(e+=' title="'+I+'"'),e+=this.options.xhtml?"/>":">"},I.text=function(g){return g},g}(),tg=function(){function g(){}var I=g.prototype;return I.strong=function(g){return g},I.em=function(g){return g},I.codespan=function(g){return g},I.del=function(g){return g},I.html=function(g){return g},I.text=function(g){return g},I.link=function(g,I,t){return""+t},I.image=function(g,I,t){return""+t},I.br=function(){return""},g}(),eg=function(){function g(){this.seen={}}var I=g.prototype;return I.serialize=function(g){return g.toLowerCase().trim().replace(/<[!\/a-z].*?>/gi,"").replace(/[\u2000-\u206F\u2E00-\u2E7F\\'!"#$%&()*+,./:;<=>?@[\]^`{|}~]/g,"").replace(/\s/g,"-")},I.getNextSafeSlug=function(g,I){var t=g,e=0;if(this.seen.hasOwnProperty(t)){e=this.seen[g];do{t=g+"-"+ ++e}while(this.seen.hasOwnProperty(t))}return I||(this.seen[g]=e,this.seen[t]=0),t},I.slug=function(g,I){void 0===I&&(I={});var t=this.serialize(g);return this.getNextSafeSlug(t,I.dryrun)},g}(),ng=e.defaults,Cg=h,cg=function(){function g(g){this.options=g||ng,this.options.renderer=this.options.renderer||new Ig,this.renderer=this.options.renderer,this.renderer.options=this.options,this.textRenderer=new tg,this.slugger=new eg}g.parse=function(I,t){return new g(t).parse(I)},g.parseInline=function(I,t){return new g(t).parseInline(I)};var I=g.prototype;return I.parse=function(g,I){void 0===I&&(I=!0);var t,e,n,C,c,i,l,A,b,s,d,u,r,a,o,G,Z,m,X="",B=g.length;for(t=0;t<B;t++)switch((s=g[t]).type){case"space":continue;case"hr":X+=this.renderer.hr();continue;case"heading":X+=this.renderer.heading(this.parseInline(s.tokens),s.depth,Cg(this.parseInline(s.tokens,this.textRenderer)),this.slugger);continue;case"code":X+=this.renderer.code(s.text,s.lang,s.escaped);continue;case"table":for(A="",l="",C=s.header.length,e=0;e<C;e++)l+=this.renderer.tablecell(this.parseInline(s.tokens.header[e]),{header:!0,align:s.align[e]});for(A+=this.renderer.tablerow(l),b="",C=s.cells.length,e=0;e<C;e++){for(l="",c=(i=s.tokens.cells[e]).length,n=0;n<c;n++)l+=this.renderer.tablecell(this.parseInline(i[n]),{header:!1,align:s.align[n]});b+=this.renderer.tablerow(l)}X+=this.renderer.table(A,b);continue;case"blockquote":b=this.parse(s.tokens),X+=this.renderer.blockquote(b);continue;case"list":for(d=s.ordered,u=s.start,r=s.loose,C=s.items.length,b="",e=0;e<C;e++)G=(o=s.items[e]).checked,Z=o.task,a="",o.task&&(m=this.renderer.checkbox(G),r?o.tokens.length>0&&"text"===o.tokens[0].type?(o.tokens[0].text=m+" "+o.tokens[0].text,o.tokens[0].tokens&&o.tokens[0].tokens.length>0&&"text"===o.tokens[0].tokens[0].type&&(o.tokens[0].tokens[0].text=m+" "+o.tokens[0].tokens[0].text)):o.tokens.unshift({type:"text",text:m}):a+=m),a+=this.parse(o.tokens,r),b+=this.renderer.listitem(a,Z,G);X+=this.renderer.list(b,d,u);continue;case"html":X+=this.renderer.html(s.text);continue;case"paragraph":X+=this.renderer.paragraph(this.parseInline(s.tokens));continue;case"text":for(b=s.tokens?this.parseInline(s.tokens):s.text;t+1<B&&"text"===g[t+1].type;)b+="\n"+((s=g[++t]).tokens?this.parseInline(s.tokens):s.text);X+=I?this.renderer.paragraph(b):b;continue;default:var h='Token with "'+s.type+'" type was not found.';if(this.options.silent)return void console.error(h);throw new Error(h)}return X},I.parseInline=function(g,I){I=I||this.renderer;var t,e,n="",C=g.length;for(t=0;t<C;t++)switch((e=g[t]).type){case"escape":n+=I.text(e.text);break;case"html":n+=I.html(e.text);break;case"link":n+=I.link(e.href,e.title,this.parseInline(e.tokens,I));break;case"image":n+=I.image(e.href,e.title,e.text);break;case"strong":n+=I.strong(this.parseInline(e.tokens,I));break;case"em":n+=I.em(this.parseInline(e.tokens,I));break;case"codespan":n+=I.codespan(e.text);break;case"br":n+=I.br();break;case"del":n+=I.del(this.parseInline(e.tokens,I));break;case"text":n+=I.text(e.text);break;default:var c='Token with "'+e.type+'" type was not found.';if(this.options.silent)return void console.error(c);throw new Error(c)}return n},g}(),ig=x,lg=f,Ag=B,bg=e.getDefaults,sg=e.changeDefaults,dg=e.defaults;function ug(g,I,t){if(null==g)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof g)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(g)+", string expected");if("function"==typeof I&&(t=I,I=null),I=ig({},ug.defaults,I||{}),lg(I),t){var e,n=I.highlight;try{e=$.lex(g,I)}catch(g){return t(g)}var C=function(g){var C;if(!g)try{C=cg.parse(e,I)}catch(I){g=I}return I.highlight=n,g?t(g):t(null,C)};if(!n||n.length<3)return C();if(delete I.highlight,!e.length)return C();var c=0;return ug.walkTokens(e,(function(g){"code"===g.type&&(c++,setTimeout((function(){n(g.text,g.lang,(function(I,t){if(I)return C(I);null!=t&&t!==g.text&&(g.text=t,g.escaped=!0),0==--c&&C()}))}),0))})),void(0===c&&C())}try{var i=$.lex(g,I);return I.walkTokens&&ug.walkTokens(i,I.walkTokens),cg.parse(i,I)}catch(g){if(g.message+="\nPlease report this to https://github.com/markedjs/marked.",I.silent)return"<p>An error occurred:</p><pre>"+Ag(g.message+"",!0)+"</pre>";throw g}}return ug.options=ug.setOptions=function(g){return ig(ug.defaults,g),sg(ug.defaults),ug},ug.getDefaults=bg,ug.defaults=dg,ug.use=function(g){var I=ig({},g);if(g.renderer&&function(){var t=ug.defaults.renderer||new Ig,e=function(I){var e=t[I];t[I]=function(){for(var n=arguments.length,C=new Array(n),c=0;c<n;c++)C[c]=arguments[c];var i=g.renderer[I].apply(t,C);return!1===i&&(i=e.apply(t,C)),i}};for(var n in g.renderer)e(n);I.renderer=t}(),g.tokenizer&&function(){var t=ug.defaults.tokenizer||new Q,e=function(I){var e=t[I];t[I]=function(){for(var n=arguments.length,C=new Array(n),c=0;c<n;c++)C[c]=arguments[c];var i=g.tokenizer[I].apply(t,C);return!1===i&&(i=e.apply(t,C)),i}};for(var n in g.tokenizer)e(n);I.tokenizer=t}(),g.walkTokens){var t=ug.defaults.walkTokens;I.walkTokens=function(I){g.walkTokens(I),t&&t(I)}}ug.setOptions(I)},ug.walkTokens=function(g,I){for(var e,n=t(g);!(e=n()).done;){var C=e.value;switch(I(C),C.type){case"table":for(var c,i=t(C.tokens.header);!(c=i()).done;){var l=c.value;ug.walkTokens(l,I)}for(var A,b=t(C.tokens.cells);!(A=b()).done;)for(var s,d=t(A.value);!(s=d()).done;){var u=s.value;ug.walkTokens(u,I)}break;case"list":ug.walkTokens(C.items,I);break;default:C.tokens&&ug.walkTokens(C.tokens,I)}}},ug.parseInline=function(g,I){if(null==g)throw new Error("marked.parseInline(): input parameter is undefined or null");if("string"!=typeof g)throw new Error("marked.parseInline(): input parameter is of type "+Object.prototype.toString.call(g)+", string expected");I=ig({},ug.defaults,I||{}),lg(I);try{var t=$.lexInline(g,I);return I.walkTokens&&ug.walkTokens(t,I.walkTokens),cg.parseInline(t,I)}catch(g){if(g.message+="\nPlease report this to https://github.com/markedjs/marked.",I.silent)return"<p>An error occurred:</p><pre>"+Ag(g.message+"",!0)+"</pre>";throw g}},ug.Parser=cg,ug.parser=cg.parse,ug.Renderer=Ig,ug.TextRenderer=tg,ug.Lexer=$,ug.lexer=$.lex,ug.Tokenizer=Q,ug.Slugger=eg,ug.parse=ug,ug}()})),yt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),ft=new Uint8Array(16);function Yt(){if(!yt)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return yt(ft)}var kt=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function vt(g){return"string"==typeof g&&kt.test(g)}for(var Ht=[],Nt=0;Nt<256;++Nt)Ht.push((Nt+256).toString(16).substr(1));function St(g,I,t){var e=(g=g||{}).random||(g.rng||Yt)();if(e[6]=15&e[6]|64,e[8]=63&e[8]|128,I){t=t||0;for(var n=0;n<16;++n)I[t+n]=e[n];return I}return function(g){var I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(Ht[g[I+0]]+Ht[g[I+1]]+Ht[g[I+2]]+Ht[g[I+3]]+"-"+Ht[g[I+4]]+Ht[g[I+5]]+"-"+Ht[g[I+6]]+Ht[g[I+7]]+"-"+Ht[g[I+8]]+Ht[g[I+9]]+"-"+Ht[g[I+10]]+Ht[g[I+11]]+Ht[g[I+12]]+Ht[g[I+13]]+Ht[g[I+14]]+Ht[g[I+15]]).toLowerCase();if(!vt(t))throw TypeError("Stringified UUID is invalid");return t}(e)}function Ut(g){const{cleaned:I,replacements:t}=function(g){const I=Array.from(g.matchAll(/\{\{.*\}\}/g)),t=[],e={};let n=0;I.forEach(I=>{const C=I.index;if(void 0===C)return;t.push(g.slice(n,C));const c=St().replace(/-/g,".");e[c]=I[0],t.push(c),n=C+I[0].length}),t.push(g.slice(n));return{cleaned:t.join(""),replacements:e}}(g),e=Rt.lexer(I,{gfm:!0});console.log(JSON.stringify(e));const n=e.flatMap(Qt).map(g=>{if(void 0===g.text)return{raw:g.raw,text:[]};const I=g.text.split(/([.?!]+\s+)|\n+/g).filter(g=>void 0!==g).filter((g,I)=>I%2==0).map(g=>g.trim()).filter(g=>g.length);let e=g.raw;for(const g in t){const I=t[g];e=e.replace(g,I)}return{raw:e,text:I}}).flatMap(wt);n.forEach((g,I)=>g.idx=I);for(let g of n)if("PARAGRAPH"===g.type){g.duration=.1;break}return n}function Qt(g){return"heading"===g.type||"codespan"===g.type||"text"===g.type||"strong"===g.type||"em"===g.type||"escape"===g.type||"link"===g.type||"list_item"===g.type||"image"===g.type?g:"code"===g.type?{raw:g.raw,text:"pause now if you want to look at the code"}:"table"===g.type?{raw:g.raw,text:"pause now if you want to look at the table"}:"paragraph"===g.type||"blockquote"===g.type?Jt(g):"list"===g.type?function(g){const I=g.raw,t=g.items.map(Qt).map(g=>g.text).join("\n");return{raw:I,text:t}}(g):{raw:g.raw}}function Jt(g){return{raw:g.raw,text:g.tokens.map(Qt).map(g=>g.text).join("")}}function wt(g){const I=[];return 0===g.text.length?I.push({idx:-1,type:"NOTHING",raw:g.raw}):(I.push({idx:-1,type:"PARAGRAPH",duration:1,raw:g.raw}),g.text.forEach((t,e)=>{I.push({idx:-1,type:"TEXT",script:t}),e<g.text.length-1&&I.push({idx:-1,type:"PAUSE",duration:.3})})),I}function Lt(I){let t,e,n,c,i,l;return{c(){t=Z("div"),e=Z("textarea"),n=X(),c=Z("button"),c.textContent="Submit",W(e,"placeholder","Paste your script in here (supports markdown)"),W(e,"class","svelte-14gj6bi"),W(t,"class","column svelte-14gj6bi")},m(g,C){o(g,t,C),a(t,e),F(e,I[0]),a(t,n),a(t,c),i||(l=[h(e,"input",I[3]),h(c,"click",I[1])],i=!0)},p(g,[I]){1&I&&F(e,g[0])},i:g,o:g,d(g){g&&G(t),i=!1,C(l)}}}function zt(g,I,t){let e="";let{tokens:n}=I;return g.$$set=g=>{"tokens"in g&&t(2,n=g.tokens)},[e,function(){t(2,n=Ut(e))},n,function(){e=this.value,t(0,e)}]}class Tt extends mg{constructor(g){super(),Zg(this,g,zt,Lt,i,{tokens:2})}}function Kt(g){let I,t;return I=new Ft({props:{processingTokens:g[4],data:g[3]}}),{c(){rg(I.$$.fragment)},m(g,e){ag(I,g,e),t=!0},p(g,t){const e={};16&t&&(e.processingTokens=g[4]),8&t&&(e.data=g[3]),I.$set(e)},i(g){t||(cg(I.$$.fragment,g),t=!0)},o(g){ig(I.$$.fragment,g),t=!1},d(g){og(I,g)}}}function Et(g){let I,t,e,n;function C(I){g[6].call(null,I)}function c(I){g[7].call(null,I)}let i={textTokens:g[1]};return void 0!==g[2]&&(i.timingTokens=g[2]),void 0!==g[3]&&(i.data=g[3]),I=new at({props:i}),T.push(()=>ug(I,"timingTokens",C)),T.push(()=>ug(I,"data",c)),{c(){rg(I.$$.fragment)},m(g,t){ag(I,g,t),n=!0},p(g,n){const C={};2&n&&(C.textTokens=g[1]),!t&&4&n&&(t=!0,C.timingTokens=g[2],D(()=>t=!1)),!e&&8&n&&(e=!0,C.data=g[3],D(()=>e=!1)),I.$set(C)},i(g){n||(cg(I.$$.fragment,g),n=!0)},o(g){ig(I.$$.fragment,g),n=!1},d(g){og(I,g)}}}function jt(g){let I,t,e;function n(I){g[5].call(null,I)}let C={};return void 0!==g[0]&&(C.tokens=g[0]),I=new Tt({props:C}),T.push(()=>ug(I,"tokens",n)),{c(){rg(I.$$.fragment)},m(g,t){ag(I,g,t),e=!0},p(g,e){const n={};!t&&1&e&&(t=!0,n.tokens=g[0],D(()=>t=!1)),I.$set(n)},i(g){e||(cg(I.$$.fragment,g),e=!0)},o(g){ig(I.$$.fragment,g),e=!1},d(g){og(I,g)}}}function Mt(g){let I,t,e,n;const C=[jt,Et,Kt],c=[];function i(g,I){return g[0].length?null===g[3]?1:2:0}return I=i(g),t=c[I]=C[I](g),{c(){t.c(),e=B()},m(g,t){c[I].m(g,t),o(g,e,t),n=!0},p(g,[n]){let l=I;I=i(g),I===l?c[I].p(g,n):(ng(),ig(c[l],1,1,()=>{c[l]=null}),Cg(),t=c[I],t||(t=c[I]=C[I](g),t.c()),cg(t,1),t.m(e.parentNode,e))},i(g){n||(cg(t),n=!0)},o(g){ig(t),n=!1},d(g){c[I].d(g),g&&G(e)}}}function Pt(g,I,t){let e,n,C,c=[],i=[],l=null;return g.$$.update=()=>{1&g.$$.dirty&&t(1,e=c.filter(g=>"TEXT"===g.type)),1&g.$$.dirty&&t(8,n=c.filter(g=>"TEXT"!==g.type)),260&g.$$.dirty&&t(4,C=[...i,...n].sort((g,I)=>g.idx-I.idx))},[c,e,i,l,C,function(g){c=g,t(0,c)},function(g){i=g,t(2,i)},function(g){l=g,t(3,l)}]}class Dt extends mg{constructor(g){super(),Zg(this,g,Pt,Mt,i,{})}}var Ot=hg((function(g,I){g.exports=function(g){var I={};function t(e){if(I[e])return I[e].exports;var n=I[e]={i:e,l:!1,exports:{}};return g[e].call(n.exports,n,n.exports,t),n.l=!0,n.exports}return t.m=g,t.c=I,t.d=function(g,I,e){t.o(g,I)||Object.defineProperty(g,I,{enumerable:!0,get:e})},t.r=function(g){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(g,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(g,"__esModule",{value:!0})},t.t=function(g,I){if(1&I&&(g=t(g)),8&I)return g;if(4&I&&"object"==typeof g&&g&&g.__esModule)return g;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:g}),2&I&&"string"!=typeof g)for(var n in g)t.d(e,n,function(I){return g[I]}.bind(null,n));return e},t.n=function(g){var I=g&&g.__esModule?function(){return g.default}:function(){return g};return t.d(I,"a",I),I},t.o=function(g,I){return Object.prototype.hasOwnProperty.call(g,I)},t.p="",t(t.s=90)}({17:function(g,I,t){I.__esModule=!0,I.default=void 0;var e=t(18),n=function(){function g(){}return g.getFirstMatch=function(g,I){var t=I.match(g);return t&&t.length>0&&t[1]||""},g.getSecondMatch=function(g,I){var t=I.match(g);return t&&t.length>1&&t[2]||""},g.matchAndReturnConst=function(g,I,t){if(g.test(I))return t},g.getWindowsVersionName=function(g){switch(g){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},g.getMacOSVersionName=function(g){var I=g.split(".").splice(0,2).map((function(g){return parseInt(g,10)||0}));if(I.push(0),10===I[0])switch(I[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},g.getAndroidVersionName=function(g){var I=g.split(".").splice(0,2).map((function(g){return parseInt(g,10)||0}));if(I.push(0),!(1===I[0]&&I[1]<5))return 1===I[0]&&I[1]<6?"Cupcake":1===I[0]&&I[1]>=6?"Donut":2===I[0]&&I[1]<2?"Eclair":2===I[0]&&2===I[1]?"Froyo":2===I[0]&&I[1]>2?"Gingerbread":3===I[0]?"Honeycomb":4===I[0]&&I[1]<1?"Ice Cream Sandwich":4===I[0]&&I[1]<4?"Jelly Bean":4===I[0]&&I[1]>=4?"KitKat":5===I[0]?"Lollipop":6===I[0]?"Marshmallow":7===I[0]?"Nougat":8===I[0]?"Oreo":9===I[0]?"Pie":void 0},g.getVersionPrecision=function(g){return g.split(".").length},g.compareVersions=function(I,t,e){void 0===e&&(e=!1);var n=g.getVersionPrecision(I),C=g.getVersionPrecision(t),c=Math.max(n,C),i=0,l=g.map([I,t],(function(I){var t=c-g.getVersionPrecision(I),e=I+new Array(t+1).join(".0");return g.map(e.split("."),(function(g){return new Array(20-g.length).join("0")+g})).reverse()}));for(e&&(i=c-Math.min(n,C)),c-=1;c>=i;){if(l[0][c]>l[1][c])return 1;if(l[0][c]===l[1][c]){if(c===i)return 0;c-=1}else if(l[0][c]<l[1][c])return-1}},g.map=function(g,I){var t,e=[];if(Array.prototype.map)return Array.prototype.map.call(g,I);for(t=0;t<g.length;t+=1)e.push(I(g[t]));return e},g.find=function(g,I){var t,e;if(Array.prototype.find)return Array.prototype.find.call(g,I);for(t=0,e=g.length;t<e;t+=1){var n=g[t];if(I(n,t))return n}},g.assign=function(g){for(var I,t,e=g,n=arguments.length,C=new Array(n>1?n-1:0),c=1;c<n;c++)C[c-1]=arguments[c];if(Object.assign)return Object.assign.apply(Object,[g].concat(C));var i=function(){var g=C[I];"object"==typeof g&&null!==g&&Object.keys(g).forEach((function(I){e[I]=g[I]}))};for(I=0,t=C.length;I<t;I+=1)i();return g},g.getBrowserAlias=function(g){return e.BROWSER_ALIASES_MAP[g]},g.getBrowserTypeByAlias=function(g){return e.BROWSER_MAP[g]||""},g}();I.default=n,g.exports=I.default},18:function(g,I,t){I.__esModule=!0,I.ENGINE_MAP=I.OS_MAP=I.PLATFORMS_MAP=I.BROWSER_MAP=I.BROWSER_ALIASES_MAP=void 0,I.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},I.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},I.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},I.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},I.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(g,I,t){I.__esModule=!0,I.default=void 0;var e,n=(e=t(91))&&e.__esModule?e:{default:e},C=t(18);function c(g,I){for(var t=0;t<I.length;t++){var e=I[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(g,e.key,e)}}var i=function(){function g(){}var I,t;return g.getParser=function(g,I){if(void 0===I&&(I=!1),"string"!=typeof g)throw new Error("UserAgent should be a string");return new n.default(g,I)},g.parse=function(g){return new n.default(g).getResult()},I=g,(t=[{key:"BROWSER_MAP",get:function(){return C.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return C.ENGINE_MAP}},{key:"OS_MAP",get:function(){return C.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return C.PLATFORMS_MAP}}])&&c(I,t),g}();I.default=i,g.exports=I.default},91:function(g,I,t){I.__esModule=!0,I.default=void 0;var e=l(t(92)),n=l(t(93)),C=l(t(94)),c=l(t(95)),i=l(t(17));function l(g){return g&&g.__esModule?g:{default:g}}var A=function(){function g(g,I){if(void 0===I&&(I=!1),null==g||""===g)throw new Error("UserAgent parameter can't be empty");this._ua=g,this.parsedResult={},!0!==I&&this.parse()}var I=g.prototype;return I.getUA=function(){return this._ua},I.test=function(g){return g.test(this._ua)},I.parseBrowser=function(){var g=this;this.parsedResult.browser={};var I=i.default.find(e.default,(function(I){if("function"==typeof I.test)return I.test(g);if(I.test instanceof Array)return I.test.some((function(I){return g.test(I)}));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.browser=I.describe(this.getUA())),this.parsedResult.browser},I.getBrowser=function(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()},I.getBrowserName=function(g){return g?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},I.getBrowserVersion=function(){return this.getBrowser().version},I.getOS=function(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()},I.parseOS=function(){var g=this;this.parsedResult.os={};var I=i.default.find(n.default,(function(I){if("function"==typeof I.test)return I.test(g);if(I.test instanceof Array)return I.test.some((function(I){return g.test(I)}));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.os=I.describe(this.getUA())),this.parsedResult.os},I.getOSName=function(g){var I=this.getOS().name;return g?String(I).toLowerCase()||"":I||""},I.getOSVersion=function(){return this.getOS().version},I.getPlatform=function(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()},I.getPlatformType=function(g){void 0===g&&(g=!1);var I=this.getPlatform().type;return g?String(I).toLowerCase()||"":I||""},I.parsePlatform=function(){var g=this;this.parsedResult.platform={};var I=i.default.find(C.default,(function(I){if("function"==typeof I.test)return I.test(g);if(I.test instanceof Array)return I.test.some((function(I){return g.test(I)}));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.platform=I.describe(this.getUA())),this.parsedResult.platform},I.getEngine=function(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()},I.getEngineName=function(g){return g?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},I.parseEngine=function(){var g=this;this.parsedResult.engine={};var I=i.default.find(c.default,(function(I){if("function"==typeof I.test)return I.test(g);if(I.test instanceof Array)return I.test.some((function(I){return g.test(I)}));throw new Error("Browser's test function is not valid")}));return I&&(this.parsedResult.engine=I.describe(this.getUA())),this.parsedResult.engine},I.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},I.getResult=function(){return i.default.assign({},this.parsedResult)},I.satisfies=function(g){var I=this,t={},e=0,n={},C=0;if(Object.keys(g).forEach((function(I){var c=g[I];"string"==typeof c?(n[I]=c,C+=1):"object"==typeof c&&(t[I]=c,e+=1)})),e>0){var c=Object.keys(t),l=i.default.find(c,(function(g){return I.isOS(g)}));if(l){var A=this.satisfies(t[l]);if(void 0!==A)return A}var b=i.default.find(c,(function(g){return I.isPlatform(g)}));if(b){var s=this.satisfies(t[b]);if(void 0!==s)return s}}if(C>0){var d=Object.keys(n),u=i.default.find(d,(function(g){return I.isBrowser(g,!0)}));if(void 0!==u)return this.compareVersion(n[u])}},I.isBrowser=function(g,I){void 0===I&&(I=!1);var t=this.getBrowserName().toLowerCase(),e=g.toLowerCase(),n=i.default.getBrowserTypeByAlias(e);return I&&n&&(e=n.toLowerCase()),e===t},I.compareVersion=function(g){var I=[0],t=g,e=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===g[0]||"<"===g[0]?(t=g.substr(1),"="===g[1]?(e=!0,t=g.substr(2)):I=[],">"===g[0]?I.push(1):I.push(-1)):"="===g[0]?t=g.substr(1):"~"===g[0]&&(e=!0,t=g.substr(1)),I.indexOf(i.default.compareVersions(n,t,e))>-1},I.isOS=function(g){return this.getOSName(!0)===String(g).toLowerCase()},I.isPlatform=function(g){return this.getPlatformType(!0)===String(g).toLowerCase()},I.isEngine=function(g){return this.getEngineName(!0)===String(g).toLowerCase()},I.is=function(g,I){return void 0===I&&(I=!1),this.isBrowser(g,I)||this.isOS(g)||this.isPlatform(g)},I.some=function(g){var I=this;return void 0===g&&(g=[]),g.some((function(g){return I.is(g)}))},g}();I.default=A,g.exports=I.default},92:function(g,I,t){I.__esModule=!0,I.default=void 0;var e,n=(e=t(17))&&e.__esModule?e:{default:e},C=/version\/(\d+(\.?_?\d+)+)/i,c=[{test:[/googlebot/i],describe:function(g){var I={name:"Googlebot"},t=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/opera/i],describe:function(g){var I={name:"Opera"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/opr\/|opios/i],describe:function(g){var I={name:"Opera"},t=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/SamsungBrowser/i],describe:function(g){var I={name:"Samsung Internet for Android"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/Whale/i],describe:function(g){var I={name:"NAVER Whale Browser"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/MZBrowser/i],describe:function(g){var I={name:"MZ Browser"},t=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/focus/i],describe:function(g){var I={name:"Focus"},t=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/swing/i],describe:function(g){var I={name:"Swing"},t=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/coast/i],describe:function(g){var I={name:"Opera Coast"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(g){var I={name:"Opera Touch"},t=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/yabrowser/i],describe:function(g){var I={name:"Yandex Browser"},t=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/ucbrowser/i],describe:function(g){var I={name:"UC Browser"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/Maxthon|mxios/i],describe:function(g){var I={name:"Maxthon"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/epiphany/i],describe:function(g){var I={name:"Epiphany"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/puffin/i],describe:function(g){var I={name:"Puffin"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/sleipnir/i],describe:function(g){var I={name:"Sleipnir"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/k-meleon/i],describe:function(g){var I={name:"K-Meleon"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/micromessenger/i],describe:function(g){var I={name:"WeChat"},t=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/qqbrowser/i],describe:function(g){var I={name:/qqbrowserlite/i.test(g)?"QQ Browser Lite":"QQ Browser"},t=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/msie|trident/i],describe:function(g){var I={name:"Internet Explorer"},t=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/\sedg\//i],describe:function(g){var I={name:"Microsoft Edge"},t=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/edg([ea]|ios)/i],describe:function(g){var I={name:"Microsoft Edge"},t=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/vivaldi/i],describe:function(g){var I={name:"Vivaldi"},t=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/seamonkey/i],describe:function(g){var I={name:"SeaMonkey"},t=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/sailfish/i],describe:function(g){var I={name:"Sailfish"},t=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,g);return t&&(I.version=t),I}},{test:[/silk/i],describe:function(g){var I={name:"Amazon Silk"},t=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/phantom/i],describe:function(g){var I={name:"PhantomJS"},t=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/slimerjs/i],describe:function(g){var I={name:"SlimerJS"},t=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(g){var I={name:"BlackBerry"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/(web|hpw)[o0]s/i],describe:function(g){var I={name:"WebOS Browser"},t=n.default.getFirstMatch(C,g)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/bada/i],describe:function(g){var I={name:"Bada"},t=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/tizen/i],describe:function(g){var I={name:"Tizen"},t=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/qupzilla/i],describe:function(g){var I={name:"QupZilla"},t=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/firefox|iceweasel|fxios/i],describe:function(g){var I={name:"Firefox"},t=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/electron/i],describe:function(g){var I={name:"Electron"},t=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/MiuiBrowser/i],describe:function(g){var I={name:"Miui"},t=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/chromium/i],describe:function(g){var I={name:"Chromium"},t=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,g)||n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/chrome|crios|crmo/i],describe:function(g){var I={name:"Chrome"},t=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/GSA/i],describe:function(g){var I={name:"Google Search"},t=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:function(g){var I=!g.test(/like android/i),t=g.test(/android/i);return I&&t},describe:function(g){var I={name:"Android Browser"},t=n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/playstation 4/i],describe:function(g){var I={name:"PlayStation 4"},t=n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/safari|applewebkit/i],describe:function(g){var I={name:"Safari"},t=n.default.getFirstMatch(C,g);return t&&(I.version=t),I}},{test:[/.*/i],describe:function(g){var I=-1!==g.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(I,g),version:n.default.getSecondMatch(I,g)}}}];I.default=c,g.exports=I.default},93:function(g,I,t){I.__esModule=!0,I.default=void 0;var e,n=(e=t(17))&&e.__esModule?e:{default:e},C=t(18),c=[{test:[/Roku\/DVP/],describe:function(g){var I=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,g);return{name:C.OS_MAP.Roku,version:I}}},{test:[/windows phone/i],describe:function(g){var I=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,g);return{name:C.OS_MAP.WindowsPhone,version:I}}},{test:[/windows /i],describe:function(g){var I=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,g),t=n.default.getWindowsVersionName(I);return{name:C.OS_MAP.Windows,version:I,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(g){var I={name:C.OS_MAP.iOS},t=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,g);return t&&(I.version=t),I}},{test:[/macintosh/i],describe:function(g){var I=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,g).replace(/[_\s]/g,"."),t=n.default.getMacOSVersionName(I),e={name:C.OS_MAP.MacOS,version:I};return t&&(e.versionName=t),e}},{test:[/(ipod|iphone|ipad)/i],describe:function(g){var I=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,g).replace(/[_\s]/g,".");return{name:C.OS_MAP.iOS,version:I}}},{test:function(g){var I=!g.test(/like android/i),t=g.test(/android/i);return I&&t},describe:function(g){var I=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,g),t=n.default.getAndroidVersionName(I),e={name:C.OS_MAP.Android,version:I};return t&&(e.versionName=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(g){var I=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,g),t={name:C.OS_MAP.WebOS};return I&&I.length&&(t.version=I),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(g){var I=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,g)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,g)||n.default.getFirstMatch(/\bbb(\d+)/i,g);return{name:C.OS_MAP.BlackBerry,version:I}}},{test:[/bada/i],describe:function(g){var I=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,g);return{name:C.OS_MAP.Bada,version:I}}},{test:[/tizen/i],describe:function(g){var I=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,g);return{name:C.OS_MAP.Tizen,version:I}}},{test:[/linux/i],describe:function(){return{name:C.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:C.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(g){var I=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,g);return{name:C.OS_MAP.PlayStation4,version:I}}}];I.default=c,g.exports=I.default},94:function(g,I,t){I.__esModule=!0,I.default=void 0;var e,n=(e=t(17))&&e.__esModule?e:{default:e},C=t(18),c=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(g){var I=n.default.getFirstMatch(/(can-l01)/i,g)&&"Nova",t={type:C.PLATFORMS_MAP.mobile,vendor:"Huawei"};return I&&(t.model=I),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:C.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:C.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:C.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:C.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:C.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:C.PLATFORMS_MAP.tablet}}},{test:function(g){var I=g.test(/ipod|iphone/i),t=g.test(/like (ipod|iphone)/i);return I&&!t},describe:function(g){var I=n.default.getFirstMatch(/(ipod|iphone)/i,g);return{type:C.PLATFORMS_MAP.mobile,vendor:"Apple",model:I}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:C.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:C.PLATFORMS_MAP.mobile}}},{test:function(g){return"blackberry"===g.getBrowserName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(g){return"bada"===g.getBrowserName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.mobile}}},{test:function(g){return"windows phone"===g.getBrowserName()},describe:function(){return{type:C.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(g){var I=Number(String(g.getOSVersion()).split(".")[0]);return"android"===g.getOSName(!0)&&I>=3},describe:function(){return{type:C.PLATFORMS_MAP.tablet}}},{test:function(g){return"android"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.mobile}}},{test:function(g){return"macos"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(g){return"windows"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.desktop}}},{test:function(g){return"linux"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.desktop}}},{test:function(g){return"playstation 4"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.tv}}},{test:function(g){return"roku"===g.getOSName(!0)},describe:function(){return{type:C.PLATFORMS_MAP.tv}}}];I.default=c,g.exports=I.default},95:function(g,I,t){I.__esModule=!0,I.default=void 0;var e,n=(e=t(17))&&e.__esModule?e:{default:e},C=t(18),c=[{test:function(g){return"microsoft edge"===g.getBrowserName(!0)},describe:function(g){if(/\sedg\//i.test(g))return{name:C.ENGINE_MAP.Blink};var I=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,g);return{name:C.ENGINE_MAP.EdgeHTML,version:I}}},{test:[/trident/i],describe:function(g){var I={name:C.ENGINE_MAP.Trident},t=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:function(g){return g.test(/presto/i)},describe:function(g){var I={name:C.ENGINE_MAP.Presto},t=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:function(g){var I=g.test(/gecko/i),t=g.test(/like gecko/i);return I&&!t},describe:function(g){var I={name:C.ENGINE_MAP.Gecko},t=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:C.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(g){var I={name:C.ENGINE_MAP.WebKit},t=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,g);return t&&(I.version=t),I}}];I.default=c,g.exports=I.default}})}));function $t(I){let t;return{c(){t=Z("div"),t.innerHTML='<h2 class="svelte-1wfazca">Record a narration in 3 easy steps!</h2> \n  <ol><li><h3>Enter the script</h3> \n      <ul><li>Plain Text / CommonMark / GitHub Flavored Markdown</li> \n        <li>Supports links, images, tables, code blocks, and more!</li></ul></li> \n    <li><h3>Record the script</h3> \n      <ul><li>Read each line as it&#39;s shown to you</li> \n        <li>Don&#39;t like your delivery? Just say the last line again!</li> \n        <li>Got distracted and said something not in the script? It&#39;ll get cut!</li> \n        <li>5 second pause? 10 minute pause? It&#39;ll get cut!</li> \n        <li><strong>No manual input required</strong>, everything works with speech recognition</li></ul></li> \n    <li><h3>Edit the recording</h3> \n      <ul><li>Listen to the auto-edited recording</li> \n        <li>Adjust the start and end of each clip</li> \n        <li>Auto-saves, so leave and come back later!</li> \n        <li>Grab the script annotated with audio timestamps</li> \n        <li><strong>Download your edited audio as a high quality .wav file</strong></li></ul></li></ol>'},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}class _t extends mg{constructor(g){super(),Zg(this,g,null,$t,i,{})}}function qt(I){let t,e,n,C,c,i,l,A,b,s,d,u;return{c(){t=Z("h2"),t.textContent="Unsupported Browser",e=X(),n=Z("p"),C=m("You are using "),c=Z("strong"),c.textContent=`${I[1].getBrowserName()}  ${I[1].getBrowserVersion()}`,i=m(".\n      Only "),l=Z("a"),l.textContent="Google Chrome 69+",A=m(" is supported."),b=X(),s=Z("p"),s.textContent="Not in the sense that we haven't tested it, but in the sense that it legitimately won't work.\n      The entire app is built around the Web Speech Recognition API which only exists in Chrome.\n      Trust me, I'm a Firefox user and normally ignore these.",d=X(),u=Z("h2"),u.textContent="Sorry!",W(t,"class","unsupported svelte-12jawdp"),W(l,"href","https://www.google.com/chrome/"),W(n,"class","explanation svelte-12jawdp"),W(s,"class","explanation svelte-12jawdp")},m(g,I){o(g,t,I),o(g,e,I),o(g,n,I),a(n,C),a(n,c),a(n,i),a(n,l),a(n,A),o(g,b,I),o(g,s,I),o(g,d,I),o(g,u,I)},p:g,i:g,o:g,d(g){g&&G(t),g&&G(e),g&&G(n),g&&G(b),g&&G(s),g&&G(d),g&&G(u)}}}function ge(g){let I,t,e,n;const C=[ee,te,Ie],c=[];function i(g,I){return null===g[0]?0:g[0]?1:2}return I=i(g),t=c[I]=C[I](g),{c(){t.c(),e=B()},m(g,t){c[I].m(g,t),o(g,e,t),n=!0},p(g,n){let l=I;I=i(g),I===l?c[I].p(g,n):(ng(),ig(c[l],1,1,()=>{c[l]=null}),Cg(),t=c[I],t||(t=c[I]=C[I](g),t.c()),cg(t,1),t.m(e.parentNode,e))},i(g){n||(cg(t),n=!0)},o(g){ig(t),n=!1},d(g){c[I].d(g),g&&G(e)}}}function Ie(I){let t,e;return t=new Dt({}),{c(){rg(t.$$.fragment)},m(g,I){ag(t,g,I),e=!0},p:g,i(g){e||(cg(t.$$.fragment,g),e=!0)},o(g){ig(t.$$.fragment,g),e=!1},d(g){og(t,g)}}}function te(I){let t,e;return t=new _I({}),{c(){rg(t.$$.fragment)},m(g,I){ag(t,g,I),e=!0},p:g,i(g){e||(cg(t.$$.fragment,g),e=!0)},o(g){ig(t.$$.fragment,g),e=!1},d(g){og(t,g)}}}function ee(g){let I,t,e,n={ctx:g,current:null,token:null,hasCatch:!0,pending:le,then:Ce,catch:ne,value:7,error:8,blocks:[,,,]};return bg(t=wg(),n),{c(){I=B(),n.block.c()},m(g,t){o(g,I,t),n.block.m(g,n.anchor=t),n.mount=()=>I.parentNode,n.anchor=I,e=!0},p(I,t){{const e=(g=I).slice();e[7]=e[8]=n.resolved,n.block.p(e,t)}},i(g){e||(cg(n.block),e=!0)},o(g){for(let g=0;g<3;g+=1){ig(n.blocks[g])}e=!1},d(g){g&&G(I),n.block.d(g),n.token=null,n=null}}}function ne(I){let t,e=I[8]+"";return{c(){t=m(e)},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function Ce(g){let I,t,e,n;I=new _t({});let C=function(g,I){return g[7]?ie:ce}(g)(g);return{c(){rg(I.$$.fragment),t=X(),C.c(),e=B()},m(g,c){ag(I,g,c),o(g,t,c),C.m(g,c),o(g,e,c),n=!0},p(g,I){C.p(g,I)},i(g){n||(cg(I.$$.fragment,g),n=!0)},o(g){ig(I.$$.fragment,g),n=!1},d(g){og(I,g),g&&G(t),C.d(g),g&&G(e)}}}function ce(I){let t,e,n,C;return{c(){t=Z("div"),e=Z("button"),e.textContent="Start",W(t,"class","buttonRow")},m(g,c){o(g,t,c),a(t,e),n||(C=h(e,"click",I[6]),n=!0)},p:g,d(g){g&&G(t),n=!1,C()}}}function ie(I){let t,e,n,c,i,l,A,b;return{c(){t=Z("h2"),t.textContent="Saved data found",e=X(),n=Z("div"),c=Z("button"),c.textContent="Start Again",i=X(),l=Z("button"),l.textContent="Load from Save",W(n,"class","buttonRow")},m(g,C){o(g,t,C),o(g,e,C),o(g,n,C),a(n,c),a(n,i),a(n,l),A||(b=[h(c,"click",I[4]),h(l,"click",I[5])],A=!0)},p:g,d(g){g&&G(t),g&&G(e),g&&G(n),A=!1,C(b)}}}function le(I){let t;return{c(){t=Z("h2"),t.textContent="Checking for save data"},m(g,I){o(g,t,I)},p:g,i:g,o:g,d(g){g&&G(t)}}}function Ae(g){let I,t,e,n,C,c,i,l,A,b,s,d;const u=[ge,qt],r=[];return l=function(g,I){return g[2]?0:1}(g),A=r[l]=u[l](g),{c(){I=Z("span"),I.innerHTML='<a href="https://github.com/stevenwaterman/narration.studio">View the Source on GitHub</a>',t=X(),e=Z("span"),e.innerHTML='<a href="https://www.stevenwaterman.uk">by Steven Waterman</a>',n=X(),C=Z("div"),c=Z("h1"),c.textContent="Narration.studio",i=X(),A.c(),W(I,"class","github svelte-12jawdp"),W(e,"class","plug svelte-12jawdp"),W(c,"class","svelte-12jawdp"),Y(c,"clickable",null!==g[0]),W(C,"class","column svelte-12jawdp")},m(A,u){o(A,I,u),o(A,t,u),o(A,e,u),o(A,n,u),o(A,C,u),a(C,c),a(C,i),r[l].m(C,null),b=!0,s||(d=h(c,"click",g[3]),s=!0)},p(g,[I]){1&I&&Y(c,"clickable",null!==g[0]),A.p(g,I)},i(g){b||(cg(A),b=!0)},o(g){ig(A),b=!1},d(g){g&&G(I),g&&G(t),g&&G(e),g&&G(n),g&&G(C),r[l].d(),s=!1,d()}}}function be(g,I,t){const e=Ot.getParser(window.navigator.userAgent),n=e.satisfies({chrome:">=69",edge:">=79"})||!1;let C=null;return[C,e,n,()=>{t(0,C=null)},()=>t(0,C=!1),()=>t(0,C=!0),()=>t(0,C=!1)]}return new class extends mg{constructor(g){super(),Zg(this,g,be,Ae,i,{})}}({target:document.body})}();
